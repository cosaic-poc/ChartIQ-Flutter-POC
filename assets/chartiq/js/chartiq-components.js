"use strict";(self.webpackChunksample_template_webpack=self.webpackChunksample_template_webpack||[]).push([[160],{824:(t,e,i)=>{i.d(e,{mu:()=>q,g:()=>x,hf:()=>C,tT:()=>k,lv:()=>I,bK:()=>w,T5:()=>S,Jv:()=>E,Zk:()=>T,xv:()=>U,HN:()=>zt,lc:()=>P,vI:()=>z,oK:()=>L,wd:()=>A,WZ:()=>D,pN:()=>M,ZC:()=>N,LN:()=>Lt,hZ:()=>At,gc:()=>O,l3:()=>H,xD:()=>F,nP:()=>Q,cu:()=>V,j1:()=>_,R_:()=>j,JA:()=>B,yn:()=>R,Pb:()=>W,W7:()=>K,_m:()=>G,P5:()=>Y,Jh:()=>X,Ed:()=>Z,GI:()=>J,ec:()=>tt,VG:()=>Dt,cH:()=>et,DG:()=>it,Gv:()=>nt,KX:()=>st,AR:()=>ot,Iv:()=>at,M7:()=>rt,bR:()=>ct,HX:()=>lt,sN:()=>ht,$L:()=>dt,Kk:()=>ut,n$:()=>pt,kg:()=>mt,It:()=>gt,Vf:()=>ft,q2:()=>vt,Xf:()=>bt,Vm:()=>yt,rd:()=>qt,B7:()=>xt,np:()=>Ct,OQ:()=>kt,ZN:()=>It,Sj:()=>wt,Yw:()=>St,uI:()=>Et,tk:()=>Tt,P8:()=>Ut,Bt:()=>Pt});var n=i(73);n.Pz.UI=n.Pz.UI||{},n.Pz.UI.keyboardClaims=n.Pz.UI.keyboardClaims||new Set,n.Pz.UI.shadowComponents=n.Pz.UI.shadowComponents||new Map,n.Pz.UI.stxtap=function(t,e,i){t&&(n.Pz.installTapEvent(t),"string"==typeof i&&(t=t.querySelector(i)),t&&(t.selectFC&&t.removeEventListener("stxtap",t.selectFC),e&&t.addEventListener("stxtap",e)))},n.Pz.UI.addResizeListener=function(t,e){n.Pz.UI.getUIManager(t).registerForResize(t),t.resizeHandle=n.Pz.resizeObserver(t,e,null)},n.Pz.UI.removeResizeListener=function(t){n.Pz.UI.getUIManager(t).unregisterForResize(t),n.Pz.resizeObserver(t,null,t.resizeHandle)},n.Pz.UI.containerExecute=function(t,e,i){var n=i;i&&n.constructor!==Array&&(n=Array.prototype.slice.call(arguments,2));for(var s=t.parentElement;s;){if(s[e]&&s[e].constructor==Function)return s[e].apply(s,n);s=s.parentElement||s.getRootNode().host}return null},n.Pz.UI.animatePrice=function(t,e,i,n){t[0]&&(t=t[0]),t.timeoutHandle&&(clearTimeout(t.timeoutHandle),t.timeoutHandle=null),t.classList.remove("cq-stable","cq-up","cq-down"),e>i?t.classList.add("cq-up"):e<i&&t.classList.add("cq-down"),n&&(t.timeoutHandle=setTimeout((function(){t.classList.add("cq-stable").classList.remove("cq-up","cq-down")}),0))},n.Pz.UI.makeFromTemplate=function(t,e){"string"==typeof t&&(t=document.querySelector(t)),t[0]&&n.Pz.UI.$(t)[0]==t[0]&&(t=t[0]);var i,s=t.content;s.childNodes.length?i=document.importNode(s,!0):(s=document.createElement("DIV"),Array.from(t.children).forEach(function(t){return function(e){t.appendChild(e.cloneNode(!0))}}(s)),i=s.cloneNode(!0));var o=Array.from(i.children);return e&&o.forEach(function(e){return function(i){!0===e?t.parentElement.appendChild(i):e[0]?e[0].appendChild(i):e.appendChild(i)}}(e)),n.Pz.UI.$(o)},n.Pz.UI.splitMethod=function(t){if(!t)return null;var e=t.indexOf("("),i=t.lastIndexOf(")");if(-1==e||-1==i)return console.log("malformed stxtap attribute: "+t),null;var n,s=null,o=t.substring(0,e),a=o.indexOf(".");-1==a?n=o:(s=o.substring(0,a),n=t.substring(a+1,e));var r=t.substring(e+1,i).match(/('[^']+'|[^,]+)/g),c=new RegExp("^[0-9]+([,.][0-9]+)?$","g"),l=new RegExp("^\\d+$"),h=[];if(r)for(var d=0;d<r.length;d++){for(var u=r[d];" "==u.charAt(0);)u=u.substring(1);if(-1!=u.indexOf('"')||-1!=u.indexOf("'"))h.push(u.substring(1,u.length-1));else if("true"==u)h.push(!0);else if("false"==u)h.push(!1);else if("null"==u)h.push(null);else if(l.test(u))h.push(parseInt(u,10));else if(c.test(u))h.push(parseFloat(u));else{for(var p=u.split("."),m=window,g=0;g<p.length;g++)m=m[p[g]];h.push(m)}}return{helperName:s,functionName:n,args:h}},n.Pz.UI.observeProperty=function(t,e,i){if(e&&t&&i){t in e||(e[t]=void 0),n.Pz.UI.observables||(n.Pz.UI.observables={});var s,o=n.Pz.UI.observables;o[t]||(o[t]=[]);for(var a=0;a<o[t].length;a++){var r=o[t][a];r.obj==e&&(s=r)}s||(s={obj:e,value:e[t],listeners:[]},o[t].push(s)),s.listeners.push(i),i({obj:e,property:t,value:s.value}),Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){return s.value},set:function(i){if(s.value!==i){s.value=i;for(var n={obj:e,property:t,value:i},o=0;o<s.listeners.length;o++)s.listeners[o](n)}}})}},n.Pz.UI.unobserveProperty=function(t,e,i){if(t&&e&&n.Pz.UI.observables){var s=n.Pz.UI.observables[t];if(s){for(var o=s.length-1;o>=0;o--){var a=s[o];if(a.obj==e){if(i)for(var r=a.listeners,c=r.length-1;c>=0;c--)r[c]===i&&r.splice(c,1);i&&a.listeners.length||(Object.defineProperty(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a.value}),s.splice(o,1))}}s.length||delete n.Pz.UI.observables[t]}}},n.Pz.UI.getMyContext=function(t,e){for(e&&(t=n.Pz.UI.closestContextContainer(t)||t);t;){if(t.context)return t.context;if(t.CIQ&&t.CIQ.UI)return t.CIQ.UI.context;t=t.parentElement||t.getRootNode().host}return null},n.Pz.UI.contextsForEach=function(t,e){((e||{}).ownerDocument||document).querySelectorAll("cq-context,*[cq-context]").forEach((function(e){e.CIQ&&e.CIQ.UI&&e.CIQ.UI.context&&t.apply(e.CIQ.UI.context)}))},n.Pz.UI.release=!1,n.Pz.UI.bypassBindings=!1,n.Pz.UI.begin=function(t){n.Pz.UI.release=!0,setTimeout((function(){a.nextTick(),t&&t()}),0)},n.Pz.UI.activatePluginUI=function(t,e){const{uiContext:i={},container:s}=t,o=i.topNode||s.closest("cq-context")||s,a=e.toLowerCase()+"-feature";o.setAttribute(a,""),n.Pz.UI.shadowComponents.forEach(((t,e)=>{t===o&&e.setAttribute(a,"")}))},n.Pz.UI._webcomponents={list:{}},n.Pz.UI.addComponentDefinition=function(t,e){const i=!!n.Pz.UI.registerComponentsImmediately;n.Pz.ensureDefaults(n.Pz.UI._webcomponents,{registered:i}),n.Pz.UI._webcomponents.list[t]={tag:t,classDefinition:e,registered:i},i&&customElements.define(t,e)},n.Pz.UI.registerComponents=function({except:t=[]}={}){const{exceptions:e={}}=n.Pz.UI._webcomponents;t.forEach((t=>e[t]=!0)),n.Pz.UI._webcomponents.exceptions=e;const{list:i}=n.Pz.UI._webcomponents;Object.keys(i).filter((e=>!t.includes[e])).forEach((t=>{const n=i[t];!n||n.registered||e[t]||(customElements.define(t,n.classDefinition),n.registered=!0)}))},n.Pz.UI.ensureComponentsRegistered=function(){n.Pz.UI.registerComponents()},n.Pz.UI.components=function(t){return Object.values(n.Pz.UI._webcomponents.list).filter((({tag:e,classDefinition:i})=>!t||t===e||t===i.name||t===i))},n.Pz.UI.componentMarkup=function(t,e){const i=this.components(t);if(void 0===e){if(!i.length)return;const e=i.map(s);return t?e[0]:e}const[n]=i;if(n&&n.classDefinition.markup)return n.classDefinition.markup=e,s(n);function s(t){const{tag:e,registered:i,classDefinition:{markup:n,name:s}}=t;return{tag:e,name:s,registered:i,markup:n}}},n.Pz.UI.markupDependencies=function(){const t=n.Pz.UI.componentMarkup(),e={};t.forEach((t=>{if(t.markup)for(let i in n.Pz.UI._webcomponents.list){const s=n.Pz.UI._webcomponents.list[i];t.markup.indexOf("</"+s.tag+">")>-1&&(e[t.tag]||(e[t.tag]=[]),e[t.tag].push(s.tag))}}));const i={};for(let t in e)e[t].forEach((t=>{i[t]=(i[t]||0)+1}));return{dependencies:e,timesNeeded:i}},n.Pz.UI.addInheritance=function(t,e){for(var i in e.prototype)try{t.prototype[i]=e.prototype[i]}catch(t){}};var s={};n.Pz.UI.supportedInputType=function(t){if(!s[t]){var e=document.createElement("input");e.setAttribute("type",t),s[t]=e.type}return s[t]},n.Pz.UI.flattenInheritance=function(t,e){Object.getOwnPropertyNames(e.prototype).forEach((i=>{if(-1===["constructor","connectedCallback","disconnectedCallback","attributeChangedCallback","adoptedCallback"].indexOf(i)){const n=Object.getOwnPropertyDescriptor(e.prototype,i);n&&Object.defineProperty(t,i,n)}}))},n.Pz.UI.Context=function(t,e,i){this.params=i||{},this.stx=t,t&&(t.uiContext=this),this.node=n.Pz.UI.$(e),this.topNode=this.node[0],n.Pz.isMobile&&e.setAttribute("ciq-mobile","");const s=n.Pz.UI.Context.assembleContext(e);this.advertised={};const o=e.CIQ.UI.context=this,a=new Map;s.Components.forEach((t=>{const e=t.closest("cq-context, *[cq-context]")||t.getRootNode();a.has(e)||a.set(e,[]),a.set(e,a.get(e).concat([t.tagName]))})),a.forEach(((t,e)=>{e.querySelectorAll(t.join(",")).forEach((function(t){t.context||t.setContextPrivate(o)}))}))},n.Pz.UI.closestContextContainer=function(t,{isWrapper:e,includeSelf:i}={}){const s=e?"cq-context-wrapper":"cq-context,*[cq-context]";return i&&t.matches(s)?t:t&&t!=document&&t!=window&&(t.closest(s)||n.Pz.UI.closestContextContainer(t.getRootNode().host,{isWrapper:e}))};var o=n.Pz.UI.Context;o.assembleContext=function(t){return t.CIQ||(t.CIQ={}),t.CIQ.UI||(t.CIQ.UI={}),t.CIQ.UI.Components||(t.CIQ.UI.Components=[]),t.CIQ.UI},o.prototype.changeSymbol=function(t,e){console.log("Please implement CIQ.UI.Context.prototype.changeSymbol")},o.prototype.setLookupDriver=function(t){this.lookupDriver=t,t.deprecated&&console.warn("Using deprecated Lookup Driver, please see documentation: CIQ.ChartEngine.Driver.Lookup")},o.prototype.advertiseAs=function(t,e){this.advertised[e]=t},o.prototype.getAdvertised=function(t){return this.advertised[t]},o.prototype.setLoader=function(t){this.loader=t},o.prototype.isModal=function(){return""!==this.stx.openDialog},o.prototype.isLegendKeyboardActive=function(){const{topNode:t}=this,e=(n.Pz.UI.closestContextContainer(t)||t).querySelectorAll("cq-study-legend.ciq-active, cq-menu.cq-comparison-new.stxMenuActive");return!!Array.from(e).find((t=>{if(t.classList.contains("ciq-active")&&t.keyboardNavigation||t.classList.contains("stxMenuActive")&&t.parentElement.keyboardNavigation)return!0}))};class a extends HTMLElement{constructor(){super(),this.node=n.Pz.UI.$(this),this.eventListeners=[],this.constructor.observedAttributes&&this.constructor.observedAttributes.forEach((t=>{Object.defineProperty(this,t,{get:()=>this[`_${t}`],set:e=>{if(this[`_${t}`]===e)return;let i=this[`_${t}`];this[`_${t}`]=e,"object"==typeof i&&(i=JSON.stringify(i)),"object"==typeof e&&(e=JSON.stringify(e)),this.hasAttribute(t)?this.getAttribute(t)!==e&&this.setAttribute(t,e):this.attributeChangedCallback(t,i,e)}})}))}connectedCallback(){this.attached||(a.buildReverseBindings(this),this.attached=!0)}adoptedCallback(){n.Pz.UI.flattenInheritance(this,a)}disconnectedCallback(){if(!this.doNotDisconnect){if(this.attached=!1,this.context){for(var t=0;t<this.eventListeners.length;t++)this.context.stx.removeEventListener(this.eventListeners[t]);this.eventListeners=[]}this.copyStylesheetListener&&this.ownerDocument.head.removeEventListener(this.copyStylesheetListener),n.Pz.UI.shadowComponents.delete(this)}}attributeChangedCallback(t,e,i){e!==i&&(this[t]=i,this.handlePropertyChange(t,e,i))}addDefaultMarkup(t,e){const i=t||this;if((t=>0===t.children.length)(i)&&(i.constructor.markup||e)){const t=+new Date,s=e||i.constructor.markup;if(i.ownerDocument!==document){const t=document.createElement("template");t.innerHTML=s,document.body.append(t),i.append(document.importNode(t.content,!0)),t.remove()}else i.innerHTML=s;if(a.buildReverseBindings(i),n.Pz.debug){const e=+new Date-t;a.createMarkupTime=e+(a.createMarkupTime||0),console.log("Building markup "+this.constructor.name+" "+(this.getAttribute("cq-name")||"")+" built in="+e,"total="+a.createMarkupTime)}if(n.Pz.I18N&&n.Pz.I18N.localized){const t=n.Pz.getFromNS(this,"context.stx.preferences.language");n.Pz.I18N.translateUI(t,i)}}this.shadowRoot&&[...i.children].forEach((t=>this.shadowRoot.append(t)))}emitCustomEvent({emitter:t,actualType:e,listenType:i="click",detail:s={}}){t.dispatchEvent(new CustomEvent(i,{bubbles:!0,cancelable:!0,composed:!0,detail:n.Pz.extend({emitter:t,actualType:e},s)}))}channelWrite(t,e,i){const{obj:s,prop:o}=n.Pz.UI.BaseComponent.getChannel(t,i,this);s&&(s[o]=e)}channelMergeObject(t,e,i){const{obj:s,prop:o}=n.Pz.UI.BaseComponent.getChannel(t,i,this);s&&(s[o]=Object.assign({},s[o],e))}channelRead(t,e){const{obj:i,prop:s}=n.Pz.UI.BaseComponent.getChannel(t,e,this);if(i)return i&&i[s]}channelSubscribe(t,e,i){const{obj:s,prop:o}=n.Pz.UI.BaseComponent.getChannel(t,i,this);if(!s)return;function a({value:t}){e(t)}n.Pz.UI.observeProperty(o,s,a);const r=()=>{n.Pz.UI.unobserveProperty(o,s,a)};return(i||this.stx).addEventListener("destroy",r),r}qs(t,e){return"thisChart"===e&&(e=this.getContextContainer()),(e||document).querySelector(t)}qsa(t,e,i){if("thisChart"===e&&(e=this.getContextContainer()),!i)return[...(e||document).querySelectorAll(t)];const n=[],s=e=>{const i=e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_ELEMENT);let o=i.currentNode;for(o.matches||(o=i.nextNode());o;)o!==e&&o.matches(t)&&n.push(o),o.shadowRoot&&s(o.shadowRoot),o=i.nextNode()};return s(e||document),n}getContextContainer(t){return t?n.Pz.UI.closestContextContainer(t,{includeSelf:!0}):(this.contextContainer||(this.contextContainer=n.Pz.UI.closestContextContainer(this,{includeSelf:!0})),this.contextContainer)}getChartContainer(t){return a.selfOrParentElement(t||this,"ciq-chart")}static getHelper(t,e,i){if(!t)return;if(!e&&!(e=t.getAttribute(i)||t[i]))return null;let s;const o=e.indexOf("("),a=e.substring(0,o),r=e.indexOf(".");if(-1==o||-1!=a.indexOf(".")){const i=-1===r?e:e.substring(0,r);let{context:o}=t;if(!o){if(!t.isConnected)return null;o=t.context=n.Pz.UI.getMyContext(t)}if(!o){const e=n.Pz.UI.closestContextContainer(t);return e?(e.bindingInitiated&&console.log("No context attached to "+t.tagName+". A context is required when binding to a helper."),null):(console.log(t.tagName+" is not inside cq-context element. A context element is required when binding to a helper."),null)}s=n.Pz.UI.getMyContext(t,!0).getAdvertised(i)}else{const i=e.substring(0,o),s=n.Pz.climbUpDomTree(t.parentElement,null,!0);for(let t of s)if("function"==typeof t[i])return t}return s}static activate(t,e,i,s){var o=s?"stxsetget":"stxtap",r=n.Pz.UI.splitMethod(t.getAttribute(o));if(r){var c=r.helperName,l=r.functionName;s&&(l="set"+l);var h=[{node:t,e,params:i}].concat(r.args);if(c){var d=a.getHelper(t,null,o);if(!d[l])return void console.log("Method '"+l+"' not found in helper",d);d[l].apply(d,h)}else{var u=n.Pz.climbUpDomTree(t.parentElement,null,!0);for(var p of u)"function"==typeof p[l]&&p[l].apply(p,h)}}}makeTap(t,e){a.makeTap(t,e)}static makeTap(t,e){n.Pz.UI.stxtap(t,e),t.selectFC=e}static bindNode(t,e){var i,s=t.getAttribute("stxbind"),o=t.getAttribute("stxtap"),r=t.getAttribute("stxsetget");if(t.bindingFC&&(i=a.getHelper(t,t.bindingFC,"stxbind"))&&i.removeObservers&&i.removeObservers(t),s){if(!(i=a.getHelper(t,s,"stxbind")))return!1;!function(e){var i,n=s.indexOf("(");i=s.substring(s.indexOf(".")+1),-1!==n&&(i=s.substring(0,n)),e&&e[i](t)}(i)}function c(t){return function(i){a.activate(t,i,e,!1)}}if(t.bindingFC=s,"INPUT"!=t.tagName||"text"!==t.type&&"number"!==t.type?a.makeTap(t,o&&c(t)):a.inputEntry(t,o&&c(t)),!s){if(t.bindingFC&&(i=a.getHelper(t,t.bindingFC,"stxsetget"))&&i.removeObservers&&i.removeObservers(t),r){if(!(i=a.getHelper(t,r,"stxsetget")))return!1;!function(i){function s(){return function(i){a.activate(t,i,e,!0)}}if(r){var o=n.Pz.UI.splitMethod(r);if(!o)return void console.log("Syntax error "+r);var c=[t].concat(o.args).concat(e),l="get"+o.functionName;i&&i[l]&&i[l].apply(i,c)}"text"===t.type||"number"===t.type?a.inputEntry(t,r&&s()):a.makeTap(t,r&&s())}(i)}t.bindingFC=r}return!0}static scheduleForBinding(t,e){a.scheduledBindings.push({node:t,parentTag:e}),a.timeout&&clearTimeout(a.timeout),a.timeout=setTimeout(a.nextTick,0)}inputEntry(t,e){a.inputEntry(t,e),t.inputFC=e}static inputEntry(t,e){t.inputFC&&t.removeEventListener("keypress",t.inputFC),t.addEventListener("keypress",(function(t){switch(t.which){case 13:case 9:e()}}))}setupShadow(t){const e=this;e.setAttribute("interactable","");const i=i=>{[...i].reverse().forEach((i=>{if("LINK"===i.tagName){const n=document.createElement("link"),{type:s,media:o,href:a}=i;Object.assign(n,{rel:"stylesheet",type:s,media:o,href:a}),n.onload=()=>{e.stylesheetLoaded=!0,e.refresh&&setTimeout(e.refresh.bind(e))},n.setAttribute("copied",""),t.insertBefore(n,t.firstChild)}else if("STYLE"===i.tagName){const e=i.cloneNode(!0);e.setAttribute("copied",""),t.insertBefore(e,t.firstChild)}}))};t.querySelectorAll("link[copied], style[copied]").forEach((t=>t.remove())),i(e.ownerDocument.head.querySelectorAll("link:not([no-wc-import]), style:not([no-wc-import])")),e.copyStylesheetListener||(e.copyStylesheetListener=e.ownerDocument.head.addEventListener("stylesheetload",(t=>{i([t.detail.link])})));const s=n.Pz.UI.closestContextContainer(e);n.Pz.UI.shadowComponents.set(e,s),e.getAttributeNames().filter((t=>/-feature$/.test(t))).forEach((t=>e.removeAttribute(t))),s.getAttributeNames().filter((t=>/-feature$/.test(t))).forEach((t=>e.setAttribute(t,s.getAttribute(t)))),s.currentTheme&&e.classList.add(s.currentTheme),s.classList.contains("full-screen")&&e.classList.add("full-screen")}addClaim(t){n.Pz.UI.keyboardClaims.add(t)}removeClaim(t){n.Pz.UI.keyboardClaims.delete(t)}static buildReverseBindings(t){if(!n.Pz.UI.bypassBindings){var e,i=function(t){if(t.hasAttribute("stxbind")||t.hasAttribute("stxtap")||t.hasAttribute("stxsetget"))return NodeFilter.FILTER_ACCEPT},s=t.ownerDocument.createNodeIterator(t,NodeFilter.SHOW_ELEMENT,n.Pz.isIE?i:{acceptNode:i});for(e=s.nextNode();e;)e.handlesBindings||a.scheduleForBinding(e,t),e=s.nextNode()}}static nextTick(){if(!n.Pz.UI.release)return;clearTimeout(a.timeout);const{scheduledBindings:t}=a;t.reverse().forEach((t=>{const{node:e}=t;e.ciqAlreadyBound&&e.getAttribute("stxbind")===e.bindingFC||(e.ciqAlreadyBound=a.bindNode(e,{parent:t.parentTag}))})),a.scheduledBindings=t.filter((t=>!t.node.ciqAlreadyBound))}static selfOrParentElement(t,e){let i=t;for(;i;){if(i.classList.contains(e)||null!==i.getAttribute(e)||i.nodeName.toLowerCase()===e)return i;i=i.parentElement}}static toPropAndObject(t,e){const i=t.split(".");return{prop:i.pop(),obj:i.reduce(((t,e)=>void 0!==t[e]?t[e]:t[e]={}),e)}}static getChannel(t,e,i){if(!t)return console.warn("Missing channel path"),{};if(!e&&!i)return console.warn("Chart engine not provided while retrieving ",t),{};e||i.stx||(i.container||(i.container=n.Pz.UI.getMyContext(i)),i.stx=i.container.stx);const{obj:s,prop:o}=a.toPropAndObject(t,e||i.stx);return{obj:s,prop:o}}findFocused(t){return Array.from(t||[]).filter((t=>t.matches("[cq-focused]")||t===document.activeElement))}findKeyboardActive(t){return Array.from(t).filter((t=>t.matches("[cq-keyboard-active]")))}focusNextItem(t,e,i){if(!t.length)return;const s=this.findFocused(t);let o=-1;if(s.length)for(o=0;o<t.length&&t[o]!==s[0];o++);const a=o;if(e)do{if(o--,o<0){if(!i)break;o=t.length-1}if(o==a)break}while(!n.Pz.trulyVisible(t[o])||"false"===t[o].getAttribute("keyboard-selectable"));else do{if(o++,o>=t.length){if(!i)break;o=0}if(o==a)break}while(!n.Pz.trulyVisible(t[o])||"false"===t[o].getAttribute("keyboard-selectable"));return o>-1&&o<t.length&&t[o]!==s[0]?(this.removeFocused(t),this.focusItem(t[o]),t[o]):void 0}focusItem(t){this.scrollToElement&&this.scrollToElement(t),t.setAttribute("cq-focused","true"),this.activeElementName=t.getAttribute("name"),this.highlightItem(t),"INPUT"!=t.tagName&&"TEXTAREA"!=t.tagName||this.clickItem(t)}removeFocused(t){t||(t=this.qsa("[cq-focused]",this,!0)),t.forEach((t=>{t.removeAttribute("cq-focused"),t.blur()}))}highlightItem(t,e){if(!t||!this.keyboardNavigation||!this.keyboardNavigation.highlightPosition)return;const i=this.keyboardNavigation;clearTimeout(this.highlightDelayTimeout),this.highlightDelayTimeout=setTimeout((()=>{const{x:e,y:n,width:s,height:o}=t.getBoundingClientRect();i.highlightPosition({element:t,position:{x:e,y:n,width:s,height:o}})}),e||0)}highlightFocusedItem(t){let e=this.findFocused(t);e.length&&this.highlightItem(e[0])}clickItem(t,e,i){if(t)return t.focus(),t.setAttribute("cq-keyboard-active","true"),i&&(t.keyboardOriginationElement=i),t.selectFC?t.selectFC.call(t,e):t.dispatchEvent(new Event("click",{bubbles:!0,cancelable:!0,composed:!0})),!0}deactivateItem(t){t.blur(),t.removeAttribute("cq-keyboard-active")}clickFocusedItem(t,e){let i=this.findFocused(t);i.length&&this.clickItem(i[0],e)}}a.scheduledBindings=[],n.Pz.UI.BaseComponent=a;class r extends a{constructor(){super(),this.injections=[]}connectedCallback(){this.attached||(this.setContextHolder(),super.connectedCallback())}adoptedCallback(){super.adoptedCallback(),n.Pz.UI.flattenInheritance(this,r)}disconnectedCallback(){const t=n.Pz.UI.closestContextContainer(this,{isWrapper:!0});if(!(this.doNotDisconnect||this.parentElement&&this.parentElement.doNotDisconnect||t&&t.doNotDisconnect)){if(this.attached=!1,this.context){var e;for(e=0;e<this.injections.length;e++)this.context.stx.removeInjection(this.injections[e]);for(this.injections=[],e=0;e<this.eventListeners.length;e++)this.context.stx.removeEventListener(this.eventListeners[e]);this.eventListeners=[]}this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.marker&&this.marker.remove(),this.marker=null,n.Pz.UI.shadowComponents.delete(this)}}setContextHolder(){let t=n.Pz.UI.closestContextContainer(this);if(!t){const e=n.Pz.climbUpDomTree(this,"cq-dialog",!0)[0];e&&(t=e.firstElementChild.context)}if(t){var e=t.topNode||t,i=o.assembleContext(e);i.Components.push(this),i.context&&this.setContextPrivate(i.context)}else console.log("No cq-context found for "+this.tagName)}setContext(t){}setContextPrivate(t){var e,i;this.context=t,this.uiManager=n.Pz.UI.getUIManager(t.topNode),this.matches("cq-marker,[cq-marker]")&&!this.convertedToMarker&&(this.convertedToMarker=!0,n.Pz.I18N&&n.Pz.I18N.localized&&n.Pz.I18N.translateUI(t.stx.preferences.language,this),this.marker=new n.Pz.Marker({stx:t.stx,node:this,xPositioner:"none",yPositioner:"none",label:"component",permanent:!0})),this.timeout=setTimeout((e=this,i=t,function(){e.setContext(i),e.timeout=null}))}addInjection(t,e,i){this.injections.push(this.context.stx[t](e,i))}}n.Pz.UI.ContextTag=r,customElements.define("cq-marker",r);class c extends r{constructor(){super()}connectedCallback(){this.attached||(this.onpointerover=function(){this.modalBegin()},this.onpointerout=function(){this.modalEnd()},super.connectedCallback())}adoptedCallback(){super.adoptedCallback(),n.Pz.UI.flattenInheritance(this,c)}modalBegin(){this.context&&this.context.stx.modalBegin()}modalEnd(){this.context&&(this.uiManager.activeMenuStack.length||this.context.stx.modalEnd())}}n.Pz.UI.ModalTag=c;class l extends a{constructor(){super()}adoptedCallback(){super.adoptedCallback(),n.Pz.UI.flattenInheritance(this,l)}close(){var t=this.closest("cq-dialog");t&&t.close(),Array.from(this.querySelectorAll("cq-swatch")).forEach((function(t){t.colorPicker&&t.colorPicker.close()}))}naturalTabElements(t){return t||(t=this),Array.from(t.querySelectorAll("input, button, select, [tabindex='0']"))}open(t){t&&t.context&&this.setContext(t.context);var e=this.tagName.toLowerCase(),i=this.closest("cq-dialog,cq-menu");i.addActiveAttribute(e),i.open(t)}setContext(t){this.node.find("[stxtap],[stxbind],[stxsetget]").each((function(){this.context=t})),this.context=t}}function h(t,e){var i=e.stx,s=n.Pz.UI.$(t||e.topNode);if(this.node=s[0],this.context=e,this.editing=null,this.drawingContext=e.topNode.querySelector("cq-drawing-context")||this.node.ownerDocument.querySelector("cq-drawing-context"),this.cvpController=s.find("cq-cvp-controller"),this.toolbar=s.find("cq-toolbar"),this.toolbar.length||(this.toolbar=s.find("cq-drawing-settings")),!this.toolbar.length){const t=this.node.parentElement.closest("cq-context");t&&(this.toolbar=n.Pz.UI.$(t).find("cq-drawing-settings"))}var o=this;Array.from(this.toolbar).forEach((function(t){var e=function(t,e){return function(){e.editing&&(e.editing.name===t.currentVectorParameters.vectorType?(e.editing.copyConfig(),t.draw(),t.changeOccurred("vector")):e.endEdit(null,"tool"))}}(i,o);t.addEventListener("change",e),i.addEventListener("destroy",(function(){t.removeEventListener("change",e)}))})),this.count=i.drawingObjects.length,e.advertiseAs(this,"DrawingEdit"),i.addEventListener("drawing",function(t){return function(e){var i=e.drawings.length;t.count!==i&&(t.endEdit(null,"count"),t.count=i)}}(this)),i.addEventListener("drawingEdit",function(t){return function(e){!0===e.forceEdit?(t.endEdit(null,"edit"),t.showToolbar(e.drawing),t.beginEdit(e.drawing)):!0===e.forceText?t.text(e.drawing):t.showContext(e)}}(this)),s.find("cq-toolbar .ciq-drawing-edit-only").each((function(t,e){e.querySelector(".ciq-btn")&&["mouseenter","mouseleave"].forEach((function(t){e.addEventListener(t,function(t,e){return function(i){var n="mouseenter"===i.type;e.editing&&e.editing.highlighted!==n&&(e.editing.highlighted=n,t.draw())}}(i,o))}))}))}n.Pz.UI.DialogContentTag=l,n.Pz.UI.defaultSwatchColors=["#8ec648","#00afed","#ee652e","#912a8e","#fff126","#e9088c","#ea1d2c","#00a553","#00a99c","#0056a4","#f4932f","#0073ba","#66308f","#323390"],n.Pz.UI.pickSwatchColor=function(t,e){if(!t.context)return;if(!e)return;const{stx:i}=t.context,{chart:s,crossSection:o}=i,{usedColors:a=new Set}=t;let r=e.style.backgroundColor;if(o)for(const t in o.curves){let e=o.curves[t];a.add(n.Pz.convertToNativeColor(e.color))}else for(const t in s.series){var c=s.series[t];c.parameters.isComparison&&(a.add(n.Pz.convertToNativeColor(c.parameters.color)),a.add(n.Pz.colorToHex(c.parameters.color)))}if(t.usedColors||(t.usedColors=a),""===r||a.has(r))for(var l=0;l<t.swatchColors.length;l++){const i=t.swatchColors[l];if(!a.has(i))return e.style.backgroundColor=i,void(e.value=i)}},n.Pz.UI.Helper=function(t,e){this.node=t,this.context=e},n.Pz.UI.Helper.prototype.addInjection=function(t,e,i){this.injections=this.injections||[],this.injections.push(this.context.stx[t](e,i))},n.Pz.UI.Helper.prototype.addObserver=function({node:t,base:e,path:i,listener:s}){const o=e instanceof n.Pz.ChartEngine,{obj:a,member:r}=n.Pz.deriveFromObjectChain(e,i);n.Pz.UI.observeProperty(r,a,s),this.observers=this.observers||[],this.observers.push({node:t,base:e,path:i,listener:s,isEngine:o}),o&&e.addEventListener("destroy",(()=>n.Pz.UI.unobserveProperty(r,a,s)))},n.Pz.UI.Helper.prototype.removeObservers=function(t){this.observers&&(this.observers.filter((e=>e.node===t)).forEach((t=>{const{obj:e,member:i}=n.Pz.deriveFromObjectChain(t.base,t.path);n.Pz.UI.unobserveProperty(i,e,t.listener)})),this.observers=this.observers.filter((e=>e.node!==t)))},n.Pz.UI.Helper.prototype.changeContext=function(t){this.stx&&(this.stx=t.stx),this.context&&(this.context=t),this.implementation&&this.implementation.stx&&(this.implementation.stx=t.stx),(this.observers||[]).forEach((e=>{const{path:i,listener:s,isEngine:o}=e;!function(t,e,i){let{obj:s,member:o}=n.Pz.deriveFromObjectChain(t,e);n.Pz.UI.unobserveProperty(o,s,i)}(e.base,i,s),function(t,e,i){let{obj:s,member:o}=n.Pz.deriveFromObjectChain(t,e);n.Pz.UI.observeProperty(o,s,i)}(o?t.stx:t,i,s)})),this.stx&&(this.stx=t.stx),this.context&&(this.context=t)},n.Pz.UI.Helper.prototype.destroy=function(){if(this.injections)for(var t=0;t<this.injections.length;t++)this.context.stx.removeInjection(this.injections[t]);this.injections=[],(this.observers||[]).forEach((({base:t,path:e,listener:i})=>{const{obj:s,member:o}=n.Pz.deriveFromObjectChain(t,e);n.Pz.UI.unobserveProperty(o,s,i)})),this.observers=[]},n.Pz.UI.HeadsUp=function(t,e,i){this.params=i||{},void 0===this.params.autoStart&&(this.params.autoStart=!0),this.node=t,t.remove(),this.context=e,this.injections=[],this.maxVolume={lastCheckDate:null,value:0},this.params.autoStart&&this.begin()},n.Pz.inheritsFrom(n.Pz.UI.HeadsUp,n.Pz.UI.Helper),n.Pz.UI.HeadsUp.prototype.begin=function(){var t;this.injections.length||n.Pz.Marker&&(n.Pz.Marker.HeadsUp||(n.Pz.Marker.HeadsUp=function(t,e){this.className||(this.className="CIQ.Marker.HeadsUp"),n.Pz.Marker.call(this,t),this.prevTick=null,this.showClass=e},n.Pz.inheritsFrom(n.Pz.Marker.HeadsUp,n.Pz.Marker,!1),n.Pz.Marker.HeadsUp.placementFunction=function(t){function e(t,e,i,n){return Math.round(i-t.pixelFromPrice(n,e))}var i=t.panel,s=i.chart,o=t.stx,a=o.chart.highLowBars;t.showClass||(t.showClass="stx-show");for(var r=0;r<t.arr.length;++r){var c=t.arr[r],l=c.node,h=l.classList;if(i.hidden||!o.insideChart)return void h.remove(t.showClass);if(c.params.x<0||c.params.x>=s.dataSet.length)return void h.remove(t.showClass);if(o.currentVectorParameters.vectorType)return void h.remove(t.showClass);var d=s.dataSet[c.params.x],u=o.pixelFromTick(c.params.x);if(!d||u<s.left||u>s.right)return void h.remove(t.showClass);if(!d[o.chart.defaultPlotField]&&0!==d[o.chart.defaultPlotField])return void h.remove(t.showClass);h.add(t.showClass);var p,m=n.Pz.elementDimensions(l);c.clientWidth||(c.clientWidth=m.width),c.clientHeight||(c.clientHeight=m.height),c.clientWidth>u?(h.remove("stx-left"),h.add("stx-right"),Object.assign(c.node.style,{left:u+"px",right:"auto"})):(h.add("stx-left"),h.remove("stx-right"),Object.assign(c.node.style,{right:o.chart.canvasWidth-u+"px",left:"auto"}));var g=c.params.chartContainer?o.chart.canvasHeight:i.bottom;g-(p=e(o,i,g,a?o.getBarBounds(d)[i.yAxis.flipped?"low":"high"]:d[o.chart.defaultPlotField]))-c.clientHeight<0?(h.add("stx-below"),p=(a?e(o,i,g,o.getBarBounds(d).low):p)-c.clientHeight):h.remove("stx-below");var f=p+"px";c.node.style.bottom!=f&&(c.node.style.bottom=f)}}),this.params.followMouse?(this.node.style.top="auto",t={stx:this.context.stx,label:"headsup",xPositioner:"bar",chartContainer:!0,x:0,node:this.node},this.marker=new n.Pz.Marker.HeadsUp(t,this.params.showClass),this.addInjection("append","handleMouseOut",function(t){return function(){t.followMouse(-1)}}(this))):this.params.staticNode||(Object.assign(this.node.style,{top:"",left:""}),t={stx:this.context.stx,label:"headsup",xPositioner:"none",chartContainer:!1,node:this.node},n.Pz.extend(t,this.params),this.marker=new n.Pz.Marker(t)),this.calculateMaxVolume(),this.addInjection("prepend","headsUpHR",function(t){return function(){t.position()}}(this)),this.addInjection("append","createXAxis",function(t){return function(){t.position()}}(this)),this.addInjection("append","createDataSet",function(t){return function(e,i,n){t.calculateMaxVolume(n.appending)}}(this)))},n.Pz.UI.HeadsUp.prototype.end=function(){this.marker&&this.marker.remove(),this.destroy(),this.marker=null},n.Pz.UI.HeadsUp.prototype.calculateMaxVolume=function(t){t||(this.maxVolume={lastCheckDate:null,value:0});var e=this.context.stx.chart.dataSet;if(e&&e.length){for(var i=e.length-1;i>=0;i--){var n=e[i];if(n.DT<this.maxVolume.lastCheckDate)break;n.Volume>this.maxVolume.value&&(this.maxVolume.value=n.Volume)}this.maxVolume.lastCheckDate=e[e.length-1].DT}},n.Pz.UI.HeadsUp.prototype.position=function(){var t=this.context.stx,e=t.barFromPixel(t.cx);this.tick=t.tickFromPixel(t.cx);var i=t.chart.xaxis[e],s=t.chart.defaultPlotField,o=t.chart.highLowBars;s&&!o||(s="Close");var a=this.node,r=this;function c(e){var i=t.layout.chartScale,n=t.chart.panel,s=t.chart.yAxis;return(s.originalPriceFormatter&&s.originalPriceFormatter.func?s.originalPriceFormatter.func(t,n,e):s.priceFormatter&&"percent"!=i&&"relative"!=i?s.priceFormatter(t,n,e):t.formatYAxisPrice(e,n)).replace(/(\.[0-9]*[1-9])0+$|\.0*$/,"$1")}(this.tick!=this.prevTick||i&&+i.DT==+t.chart.endPoints.end)&&(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((function(){var e=n.Pz.UI.$(a);function o(t){return n.Pz.isValidNumber(parseFloat(t))?t:"N/A"}if(r.timeout=null,e.find("cq-hu-price").text("N/A"),e.find("cq-hu-open").text("N/A"),e.find("cq-hu-close").text("N/A"),e.find("cq-hu-high").text("N/A"),e.find("cq-hu-low").text("N/A"),e.find("cq-hu-date").text("N/A"),e.find("cq-hu-volume").text("N/A"),e.find("cq-volume-rollup").text(""),i&&i.data){var l=n.Pz.clone(i.data);void 0===l.Open&&(l.Open=l.Close),void 0===l.High&&(l.High=Math.max(l.Open,l.Close)),void 0===l.Low&&(l.Low=Math.min(l.Open,l.Close)),e.find("cq-hu-open").text(c(o(l.Open))),e.find("cq-hu-price").text(c(o(l[s]))),e.find("cq-hu-close").text(c(o(l.Close))),e.find("cq-hu-high").text(c(o(l.High))),e.find("cq-hu-low").text(c(o(l.Low)));var h=n.Pz.condenseInt(l.Volume),d=h.charAt(h.length-1);d>"9"&&(h=h.substring(0,h.length-1),e.find("cq-volume-rollup").text(d.toUpperCase())),e.find("cq-hu-volume").text(h);var u=l.displayDate;u||(u=l.DT),t.internationalizer?n.Pz.ChartEngine.isDailyInterval(t.layout.interval)?e.find("cq-hu-date").text(t.internationalizer.yearMonthDay.format(u)):e.find("cq-hu-date").text(t.internationalizer.yearMonthDay.format(u)+" "+t.internationalizer.hourMinute.format(u)):n.Pz.ChartEngine.isDailyInterval(t.layout.interval)?e.find("cq-hu-date").text(n.Pz.mmddyyyy(n.Pz.yyyymmddhhmm(u))):e.find("cq-hu-date").text(n.Pz.mmddhhmm(n.Pz.yyyymmddhhmmssmmm(u)));var p=e.find("cq-volume-visual");if(p.length){var m=r.maxVolume.value?l.Volume/r.maxVolume.value:0;p.css({width:Math.round(100*m)+"%"})}}}),0)),this.prevTick=this.tick,this.params.followMouse&&(t.openDialog&&(this.tick=-1),this.followMouse(this.tick))},n.Pz.UI.HeadsUp.prototype.followMouse=function(t){this.marker.params.x=t;this.marker.render()},n.Pz.UI.DrawingEdit=h,n.Pz.inheritsFrom(h,n.Pz.UI.Helper),h.prototype.showContext=function(t){t.context=this.context,t.x=n.Pz.ChartEngine.crosshairX,t.y=n.Pz.ChartEngine.crosshairY,this.count=this.context.stx.drawingObjects.length,this.drawingContext&&this.drawingContext.open&&this.drawingContext.open(t)},h.prototype.getToolActivator=function(t){var e=this.toolbar.find('cq-item[cq-tool="'+t+'"]');return e.length||(e=this.toolbar.find("cq-item[stxtap=\"tool('"+t+"')\"]")),{node:e[0]}},h.prototype.showToolbar=function(t){var e=this.getToolActivator(t.name);this.node;this.toolbar.each((function(){var i=t.lineWidth,s=t.pattern,o=t.parameters&&t instanceof n.Pz.Drawing.fibonacci;o&&(i=t.parameters.fibs[0].parameters.lineWidth,s=t.parameters.fibs[0].parameters.pattern),this.tool(e,t.name),this.sync(Object.assign({},t,{lineWidth:i,pattern:s,annotation:{font:t.font?n.Pz.clone(t.font):{}},currentColor:t.color})),this.dirty(!1),o&&(this.context.stx.currentVectorParameters.fibonacci=n.Pz.clone(t.parameters)),"measurementline"==t.name&&(this.context.stx.currentVectorParameters.measurementline=n.Pz.clone(t.parameters)),"volumeprofile"===t.name&&(this.context.stx.currentVectorParameters.volumeProfile.priceBuckets=t.priceBuckets)}))},h.prototype.beginEdit=function(t){this.editing=t,this.beforeEdit=t.serialize(),this.toolbar.attr("cq-drawing-edit",t.name);var e=new CustomEvent("drawing-edit-begin",{bubbles:!0,cancelable:!0,detail:{drawing:t,tool:t.name}});this.node.dispatchEvent(e)},h.prototype.endEdit=function(t,e){const i=function(t,e){const i=this.context.stx;let n=null,s=null;if(this.editing){s=this.editing.name,n=new CustomEvent("drawing-edit-end",{bubbles:!0,cancelable:!0,detail:{action:e,drawing:this.editing,tool:s}});const t=i.drawingObjects.indexOf(this.editing),o=i.exportDrawings();t>-1&&this.beforeEdit&&(o[t]=this.beforeEdit,i.undoStamp(o,i.exportDrawings())),"close"===e&&this.editing.highlighted&&(this.editing.highlighted=!1,i.draw())}this.editing=null,this.beforeEdit=null,this.toolbar.attr("cq-drawing-edit","none"),"close"===e&&(s&&(t=this.getToolActivator(s),this.toolbar.each((function(){this.tool(t,s)}))),i.changeVectorType(s)),n&&this.node.dispatchEvent(n)},{multiChartContainer:n}=this.node;(n?n.getCharts().map((t=>t.uiContext.getAdvertised("DrawingEdit"))):[this]).forEach((n=>{i.call(n,t,e)}))},h.prototype.edit=function(){if(this.drawingContext){const t=this.drawingContext.drawing,e=n.Pz.UI.getMyContext(t.stx.container).topNode,i=e.ownerDocument.querySelector("cq-drawing-context").parentNode;let s=e.querySelector("cq-drawing-settings");!s&&e.multiChartContainer&&(s=e.multiChartContainer.querySelector("cq-drawing-settings"));const o={left:i.offsetLeft,top:i.offsetTop};if(this.drawingContext.close(),this.node&&this.node.multiChartContainer){const e=this.node.multiChartContainer.context.getAdvertised("DrawingEdit");this.endEdit(null,"edit"),e.showToolbar(t,o),this.beginEdit(t)}else this.endEdit(null,"edit"),this.showToolbar(t,o),this.beginEdit(t);s&&!/break.*sm\b/.test(this.context.topNode.className)&&s.detach(o.left,o.top)}},h.prototype.text=function(t){let e=this.drawingContext;if(e){e.close();let i=t instanceof n.Pz.Drawing?t:e.drawing;this.endEdit(null,"text"),i.edit&&i.edit(null,!0)}},h.prototype.clone=function(){var t=this.context.stx;if(this.endEdit(null,"clone"),this.drawingContext){this.drawingContext.close();var e=this.drawingContext.drawing,i=new n.Pz.Drawing[e.name],s=e.serialize();i.reconstruct(t,s),"measurementline"==e.name&&(e.repositioner={action:"move",p0:i.p0,p1:i.p1,tick:i.p1[0],value:i.p1[1]}),i.repositioner=e.repositioner,i.highlighted=!0,e.highlighted=!1,this.count+=1,t.addDrawing(i),t.activateRepositioning(i)}},h.prototype.reorderLayer=function(t,e){var i=this.context.stx;if(this.endEdit(null,"reorderLayer"),this.drawingContext){this.drawingContext.close();var n=i.drawingObjects.length-1,s=i.drawingObjects.indexOf(this.drawingContext.drawing),o=NaN;if(-1===s)return;switch(e){case"up":s<n&&(o=s+1);break;case"down":s>0&&(o=s-1);break;case"top":s<n&&(o=n);break;case"bottom":s>0&&(o=0)}if(o!=o)return;var a=i.exportDrawings();i.drawingObjects.splice(s,1),i.drawingObjects.splice(o,0,this.drawingContext.drawing),i.undoStamp(a,i.exportDrawings()),i.draw(),i.changeOccurred("vector")}},h.prototype.remove=function(){var t=this.context.stx;if(this.endEdit(null,"remove"),this.drawingContext){if(this.drawingContext.drawing.permanent)return;var e=t.exportDrawings();this.count-=1,t.removeDrawing(this.drawingContext.drawing),t.undoStamp(e,t.exportDrawings()),this.drawingContext.close()}},n.Pz.UI.StudyEdit=function(t,e){const i=this instanceof n.Pz.UI.StudyEdit?this:Object.create(n.Pz.UI.StudyEdit.prototype);i.context=e,i.node=t||e.topNode,i.contextDialog=[];for(var s=i.node.ownerDocument.querySelectorAll("cq-study-context"),o=0;o<s.length;o++)i.contextDialog.push(s[o]);return e.advertiseAs(i,"StudyEdit"),i.initialize(),i},n.Pz.inheritsFrom(n.Pz.UI.StudyEdit,n.Pz.UI.Helper),n.Pz.UI.StudyEdit.prototype.remove=function(){n.Pz.Studies.removeStudy(this.params.stx,this.params.sd),this.contextDialog.forEach((function(t){t.close&&t.close()}))},n.Pz.UI.StudyEdit.prototype.edit=function(){this.contextDialog.forEach((function(t){t.close&&t.close()})),this.editPanel(this.params)},n.Pz.UI.StudyEdit.prototype.editPanel=function(t){const{stx:e,config:i}=this.context;t.context=this.context,t.x=null,t.y=null;const{channelWrite:s}=n.Pz.UI.BaseComponent.prototype;if(i){s((i.channels||{}).dialog||"channel.dialog",{type:"study",params:t},e)}else t.context.topNode.ownerDocument.querySelector("cq-study-dialog").open(t)},n.Pz.UI.StudyEdit.prototype.editOverlay=function(t){this.params=t,t.context=this.context,t.forceEdit?this.editPanel(t):this.contextDialog.forEach((function(e){t.x=n.Pz.ChartEngine.crosshairX,t.y=n.Pz.ChartEngine.crosshairY,e.open&&e.open(t)}))},n.Pz.UI.StudyEdit.prototype.initialize=function(){var t=this.context.stx,e=this;function i(t){return function(){t.apply(e,arguments)}}t.addEventListener("studyOverlayEdit",i(e.editOverlay)),t.addEventListener("studyPanelEdit",i(e.editPanel))},n.Pz.UI.Layout=function(t,e){const i=this instanceof n.Pz.UI.Layout?this:Object.create(n.Pz.UI.Layout.prototype);return i.params=e||{},i.params.activeClassName||(i.params.activeClassName="ciq-active"),i.context=t,t.advertiseAs(i,"Layout"),i},n.Pz.inheritsFrom(n.Pz.UI.Layout,n.Pz.UI.Helper),n.Pz.UI.Layout.prototype.setCheckedState=function(t,e){t.classList[e?"add":"remove"](this.params.activeClassName),t.ariaChecked=e?"true":"false"},n.Pz.UI.Layout.prototype.getChartType=function(t,e){const{stx:i}=this.context;"string"!=typeof e&&(e=t.dataset.value||"");const n=i=>{const n=i.obj;n.aggregationType&&"ohlc"!=n.aggregationType?this.setCheckedState(t,e===n.aggregationType):this.setCheckedState(t,e===n.chartType)};this.addObserver({node:t,base:i,path:"layout.chartType",listener:n}),this.addObserver({node:t,base:i,path:"layout.aggregationType",listener:n})},n.Pz.UI.Layout.prototype.setChartType=function(t,e){"string"!=typeof e&&(e=t.node.dataset.value||""),!{heikinashi:!0,kagi:!0,linebreak:!0,pandf:!0,rangebars:!0,renko:!0}[e]?this.context.stx.setChartType(e):this.context.stx.setAggregationType(e)},n.Pz.UI.Layout.prototype.getChartScale=function(t,e){this.addObserver({node:t,base:this.context.stx,path:"layout.chartScale",listener:i=>{this.setCheckedState(t,i.value==e)}})},n.Pz.UI.Layout.prototype.setChartScale=function(t,e){var i=this.context.stx,n=i.layout.chartScale;n==e?i.setChartScale(null):n&&"linear"!=n||i.setChartScale(e)},n.Pz.UI.Layout.prototype.getFlippedChart=function(t){this.addObserver({node:t,base:this.context.stx,path:"layout.flipped",listener:e=>{this.setCheckedState(t,e.value)}})},n.Pz.UI.Layout.prototype.setFlippedChart=function(t){var e=this.context.stx;e.flipChart(!e.layout.flipped)},n.Pz.UI.Layout.prototype.getExtendedHours=function(t){this.addObserver({node:t,base:this.context.stx,path:"layout.extended",listener:e=>{this.setCheckedState(t,e.value)}})},n.Pz.UI.Layout.prototype.setExtendedHours=function(t){var e=this.context.stx;if(e.layout.extended=!e.layout.extended,e.changeOccurred("layout"),!e.layout.extended||e.chart.market.market_def&&e.chart.market.sessions.length||n.Pz.alert("There are no Extended Hours for this instrument."),e.extendedHours){var i=this.context.loader;i&&i.show(),e.extendedHours.set(e.layout.extended,null,(function(){i&&i.hide()}))}},n.Pz.UI.Layout.prototype.getAnimation=function(t){this.addObserver({node:t,base:this.context.stx,path:"layout.animation",listener:e=>{this.setCheckedState(t,e.value)}})},n.Pz.UI.Layout.prototype.setAnimation=function(t){const{stx:e}=this.context;e.layout.animation=!e.layout.animation,e.changeOccurred("layout")},n.Pz.UI.Layout.prototype.getRangeSlider=function(t){this.addObserver({node:t,base:this.context.stx,path:"layout.rangeSlider",listener:e=>{this.setCheckedState(t,e.value)}})},n.Pz.UI.Layout.prototype.setRangeSlider=function(t){var e=this.context.stx;e.layout.rangeSlider=!e.layout.rangeSlider,e.slider&&e.slider.display(e.layout.rangeSlider),e.changeOccurred("layout")},n.Pz.UI.Layout.prototype.getOutliers=function(t){this.addObserver({node:t,base:this.context.stx,path:"layout.outliers",listener:e=>{this.setCheckedState(t,e.value)}})},n.Pz.UI.Layout.prototype.setOutliers=function(t){var e=this.context.stx;e.layout.outliers=!e.layout.outliers,e.draw(),e.changeOccurred("layout")},n.Pz.UI.Layout.prototype.getHeadsUp=function(t,e){this.addObserver({node:t,base:this.context.stx,path:"layout.headsUp",listener:i=>{const n="crosshair"===e?!i.value.static&&i.obj.crosshair:i.value[e];this.setCheckedState(t,n),["static","dynamic"].includes(e)&&(this[e]||(this[e]=!0,this.context.topNode.querySelectorAll(".ciq-chart-area").forEach((t=>{t.append(document.createElement("cq-hu-"+e))}))))}})},n.Pz.UI.Layout.prototype.setHeadsUp=function({node:t},e){const{stx:i}=this.context,{layout:n}=i;let{headsUp:s}=n;switch(s=s&&"object"==typeof s?Object.assign({},s):{},e){case"crosshair":s.static=!1,n.crosshair=!0;break;case"dynamic":s.dynamic=!0,s.floating=!1;break;case"floating":s.dynamic=!1,s.floating=!0;break;case"static":s.static=!0,n.crosshair=!0}n.headsUp=s,i.draw(),i.changeOccurred("layout")},n.Pz.UI.Layout.prototype.getAggregationType=function(t,e){this.addObserver({node:t,base:this.context.stx,path:"layout.aggregationType",listener:i=>{this.setCheckedState(t,i.value==e)}})},n.Pz.UI.Layout.prototype.setAggregationType=function(t,e){this.context.stx.layout.aggregationType==e?this.context.stx.setAggregationType(null):this.context.stx.setAggregationType(e)},n.Pz.UI.Layout.prototype.getAggregationEdit=function(t,e){const{stx:i}=this.context;this.addObserver({node:t,base:i,path:"layout."+n.Pz.deriveFromObjectChain(i.layout,e).member,listener:e=>{t.value=i.chart.defaultChartStyleConfig[t.name]||e.value}})},n.Pz.UI.Layout.prototype.setAggregationEdit=function(t,e){var i=this.context.stx;function s(){i.changeOccurred("layout"),i.createDataSet(),i.draw()}if("auto"===e){"kagi"===i.layout.aggregationType?i.layout.kagi=null:"renko"===i.layout.aggregationType?i.layout.renko=null:"linebreak"===i.layout.aggregationType?i.layout.priceLines=null:"rangebars"===i.layout.aggregationType?i.layout.rangebars=null:"pandf"===i.layout.aggregationType&&(i.layout.pandf||(i.layout.pandf={box:null,reversal:null}),i.layout.pandf.box=null,i.layout.pandf.reversal=null),s();const e=t.params.parent;if(!e)return;Array.from(e.querySelectorAll(".ciq"+i.layout.aggregationType+" input")).forEach((function(t){var e=t.name;"box"!=e&&"reversal"!=e||(e="pandf."+e);var s=n.Pz.deriveFromObjectChain(i.layout,e);s&&!s.obj[s.member]&&i.chart.defaultChartStyleConfig[t.name]&&(t.value=i.chart.defaultChartStyleConfig[t.name])}))}else{var o=n.Pz.deriveFromObjectChain(i.layout,e);o.obj[o.member]=t.node.value,s()}},n.Pz.UI.Layout.prototype.showAggregationEdit=function(t,e){const{context:i}=this;if(i.config){const{channelWrite:t}=n.Pz.UI.BaseComponent.prototype;t((i.config.channels||{}).dialog||"channel.dialog",{type:"aggregation",params:{context:i,aggregationType:e}},i.stx)}else{t.ownerDocument.querySelector("cq-aggregation-dialog").open({context:this.context,aggregationType:e})}},n.Pz.UI.Layout.prototype.clearStudies=function(t){if(n.Pz.Studies){var e=this.context.stx;for(var i in e.layout.studies){var s=e.layout.studies[i];s.customLegend||s.permanent||s.signalData||n.Pz.Studies.removeStudy(e,s)}e.draw()}},n.Pz.UI.Layout.prototype.setPeriodicity=function(t,e,i,n){var s=this;s.context.loader&&s.context.loader.show(),s.context.stx.setPeriodicity({period:e,interval:i,timeUnit:n},(function(){s.context.loader&&s.context.loader.hide()}))},n.Pz.UI.Layout.prototype.showPeriodicity=function(t,e){var i="",{period:s,interval:o,timeUnit:a}=t.getPeriodicity();i=s*=o,"day"==a?i+="D":"week"==a?i+="W":"month"==a?i+="M":"second"==a?i+="s":"millisecond"==a?i+="ms":s>=60&&s%15==0?i=s/60+"H":"tick"==a?i=(s>1?s:"")+"T":i+="m",n.Pz.makeTranslatableElement(e.selector,t,i)},n.Pz.UI.Layout.prototype.periodicity=function(t){const{stx:e}=this.context,i=t.label||t,n=()=>{this.showPeriodicity(this.context.stx,{selector:i})};this.addObserver({node:t,base:e,path:"layout.interval",listener:n}),this.addObserver({node:t,base:e,path:"layout.periodicity",listener:n}),this.addObserver({node:t,base:e,path:"layout.timeUnit",listener:n})},n.Pz.UI.Layout.prototype.chartType=function(t){const{stx:e,stx:i}=this.context,s=t.closest("cq-menu")||t.getRootNode(),o=t.qsa(".icon",s,!0)[0],a=t.qsa("[label]",s,!0)[0],r=t.qsa("[cq-tooltip]",s,!0)[0],c=({obj:{chartType:i,aggregationType:s}})=>{const c="ohlc"===s?i:s;o&&(o.className=`icon generic ${o.classList.contains("hidden")?"hidden ":""}${c.replace(/_| /,"-")}`.trim());const l=c.split(" ").map((t=>n.Pz.capitalize(t))).join(" ");if(a&&n.Pz.makeTranslatableElement(a,e,l),r&&n.Pz.makeTranslatableElement(r,e,l),!a&&!o){const e=t.closest("cq-menu").querySelector(`*[data-value='${c}'] *[ciq-label]`),i=t.querySelector("*[ciq-menu-icon]"),s=t.querySelector("cq-tooltip"),o=n.Pz.getFromNS(this,"context.config.displayStyleIcons"),a=e?(e.closest("cq-item").querySelector("[ciq-menu-icon]")||{}).className:`ciq-icon-${c.replace(/_/,"-")}`;s&&(s.innerHTML=e?e.innerHTML:n.Pz.capitalize(c.replace(/-|_/," "))),o&&i&&(t.classList.add("ciq-menu-icon"),i.className=a)}};this.addObserver({node:t,base:i,path:"layout.chartType",listener:c}),this.addObserver({node:t,base:i,path:"layout.aggregationType",listener:c})},n.Pz.UI.Layout.prototype.setLanguage=function(t){const{config:e,stx:i}=this.context;if(e){const{channelWrite:t}=n.Pz.UI.BaseComponent.prototype;t((e.channels||{}).dialog||"channel.dialog",{type:"language",params:{context:i.uiContext}},i)}else t.node.ownerDocument.querySelector("cq-language-dialog").open()},n.Pz.UI.Layout.prototype.getLanguage=function(t){const{stx:e}=this.context;this.addObserver({node:t,base:e,path:"preferences.language",listener:i=>{n.Pz.I18N.languages||(n.Pz.I18N.languages={en:"English"});const s=t.querySelector("cq-language-name, [label]");if(s){const i=e.preferences.language||n.Pz.I18N.language;n.Pz.makeTranslatableElement(s,e,n.Pz.I18N.languages[i],i);const o=t.querySelector("cq-flag");o&&o.setAttribute("cq-lang",i)}}})},n.Pz.UI.Layout.prototype.addChart=function(t,e){const i=this.context.topNode;(n.Pz.UI.closestContextContainer(i.parentNode)||i).addChart(null,e)},n.Pz.UI.Layout.prototype.removeChart=function(t){const e=this.context.topNode;(n.Pz.UI.closestContextContainer(e.parentNode)||e).removeChart()};class d extends n.Pz.UI.Helper{constructor(t){super(),this.context=t,t.advertiseAs(this,"Channel")}write(t,e,i){a.prototype.channelWrite(`channel.${e}`,i,this.context.stx)}}n.Pz.UI.Channel=function(...t){return new d(...t)},n.Pz.UI.Layout.prototype.toggleHelp=function({node:t}){let{topNode:e,stx:i}=this.context;const s="ciq-show-help";if(e.classList.contains(s))return e.classList.remove(s),t.classList.remove(s),void n.Pz.UI.shadowComponents.forEach(((t,i)=>{t===e&&i.classList.remove(s)}));n.Pz.UI.BaseComponent.prototype.qsa("cq-help",e,!0).forEach((t=>t.verifyHelpContent())),e.classList.add(s),t.classList.add(s),n.Pz.UI.shadowComponents.forEach(((t,i)=>{t===e&&i.classList.add(s)})),n.Pz.Help.MessageShown||i.dispatch("notification",{message:n.Pz.Help.Message,displayTime:10,position:"bottom"})},n.Pz.UI.Markers=function(t,e){const i=this instanceof n.Pz.UI.Markers?this:Object.create(n.Pz.UI.Markers.prototype);return i.context=t,e||(e={}),i.menuItemSelector=e.menuItemSelector,i.activeClassName=e.activeClassName||"ciq-active",i.implementation=e.implementation,t.advertiseAs(i,"Markers"),i},n.Pz.inheritsFrom(n.Pz.UI.Markers,n.Pz.UI.Helper),n.Pz.UI.Markers.prototype.showMarkers=function(t,e,i){const{activeClassName:n,context:s,implementation:o}=this;let{topNode:a}=s;o&&a.parentElement&&(a=a.multiChartContainer||a,e&&(o.activeLabels.includes(e)?(o.hideMarkers(e),t.node.classList.remove(n)):(o.showMarkers(e,i),t.node.classList.add(n))))},n.Pz.UI.Keystroke=function(t,{keysToRepeat:e=[],node:i={}}={}){this.cb=t,this.shift=!1,this.ctrl=!1,this.cmd=!1,this.alt=!1,this.capsLock=!1,this.downValue="",this.keysToRepeat=e,this.recentKeys={},this.commandKeys={},this.initialize(i)},n.Pz.UI.Keystroke.noKeyCapture=!1,n.Pz.UI.Keystroke.prototype.androidWorkaroundKeyup=function(t){var e,i=t.target.value;e=i.length>this.downValue.length?i.charAt(i.length-1):"Delete",this.key=e,this.cb({key:e,e:t,keystroke:this})},n.Pz.UI.Keystroke.prototype.mapKey=function(t){return{Shift:"shift",Control:"ctrl",Alt:"alt",Meta:"cmd",Win:"cmd"}[t]||t},n.Pz.UI.Keystroke.prototype.keyup=function(t){if(this.implementAndroidWorkaround)return this.androidWorkaroundKeyup(t),void(this.implementAndroidWorkaround=!1);const{recentKeys:e}=this,{key:i,code:n}=t,s=this.mapKey(i),o=i!==s,a=(new Date).getTime();if(e[n]||(e[n]={}),e[n].keyup=a,o){if(!this.commandKeys[n])return;return this.commandKeys[n].pressed=!1,Object.values(this.commandKeys).some((({command:t,pressed:e})=>e&&t===s))||(this[s]=!1),this.cb({key:i,e:t,keystroke:this})}let r=[];Object.entries(this.commandKeys).forEach((([t,{command:i}])=>{let s=e[t]||{},o=e[n]||{};s.keydown<o.keydown&&o.keydown<s.keyup&&s.keyup+500>a&&(r.push(t),this[i]=!0)})),r.length&&setTimeout((()=>{r.forEach((t=>{e[t].keydown<a&&(this[this.commandKeys[t].command]=!1)}))})),this.keysToRepeat.includes(i)?this.key=null:(this.key=i,this.cb({key:i,e:t,keystroke:this}))},n.Pz.UI.Keystroke.prototype.keydown=function(t){if(this.noKeyCapture)return;if(229==t.which&&n.Pz.isAndroid)return void(this.implementAndroidWorkaround=!0);const{key:e,code:i}=t,s=this.mapKey(e),o=e!==s;if(this.recentKeys[i]||(this.recentKeys[i]={}),this.recentKeys[i].keydown=(new Date).getTime(),o&&(this.commandKeys[i]={command:s,pressed:!0}),"Tab"==e){const e=document.querySelector("[cq-keyboardnavigation-active]");if(e){const{uiManager:i}=n.Pz.UI.getMyContext(e);if(i){const e=i.topMenu();e&&e.hasAttribute("native-tabbing")||t.preventDefault()}}else if(t.target.hasAttribute("cq-exit")){let e=t.target.getAttribute("cq-exit");("head"==e&&!t.shiftKey||"foot"==e&&t.shiftKey)&&(t.target.setAttribute("cq-keyboardnavigation-active",""),t.preventDefault()),t.target.removeAttribute("cq-exit")}}this.key=e,o?this[s]=!0:"CapsLock"===e?this.capsLock=!this.capsLock:this.keysToRepeat.includes(e)&&(this.key=null,this.cb({key:e,e:t,keystroke:this}))},n.Pz.UI.Keystroke.prototype.keypress=function(t){if(!this.noKeyCapture){var e=t.which;e<32||e>222||(this.key=t.key)}},n.Pz.UI.Keystroke.prototype.initialize=function(t){var e=this,i=(t||{}).ownerDocument||document;["keyup","keydown","keypress"].forEach((function(t){i.addEventListener(t,(function(i){"keydown"===t&&(e.downValue=i.target.value),e[t](i)}))})),i.defaultView.addEventListener("blur",(function(t){e.ctrl=!1,e.cb({key:"Control",e:t,keystroke:e})}))},n.Pz.UI.KeystrokeHub=function(t,e,i){t=n.Pz.UI.$(t||e.topNode.ownerDocument)[0],this.infocus=!1;var s=this;[void 0,"#document","BODY"].indexOf(t.nodeName)>-1?this.infocus=!0:(t.addEventListener("mouseout",(function(){s.infocus=!1})),t.addEventListener("mouseover",(function(){s.infocus=!0}))),this.context=e,this.params=i||{},({hotkeyConfig:this.hotkeyConfig}=e.config||{}),this.uiManager=n.Pz.UI.getUIManager(e.topNode),this.uiManager.keystrokeHub=this,this.keystroke=new n.Pz.UI.Keystroke((function(){s.handler.apply(s,arguments)}),{keysToRepeat:this.hotkeyConfig.keysToRepeat,node:t}),this.tabOrder=[null],this.tabIndex=0,this.yNormalizationThreshold=this.context.topNode.getBoundingClientRect().height/25,this.tabElementSelectors=["cq-clickable.symbol-search","cq-lookup","cq-comparison[cq-marker]","cq-study-legend[chart-legend]","cq-menu.ciq-menu","cq-menu.dropdown",".ciq-toggles cq-toggle",".chart-control-group cq-toggle",".chartControls .chartSize span",".ciq-footer cq-toggle","cq-show-range div","cq-share-button","ciq-data-table-container button","[keyboard-navigation='true']"],this.tabActiveElement=null,this.tabActiveModals=[],this.keyControlElement=null,this.highlightElement=null;const{channelSubscribe:o}=n.Pz.UI.BaseComponent.prototype;o((this.context.config.channels||{}).keyboardNavigation||"channel.keyboardNavigation",(t=>{t&&"registerElements"===t.action&&this.setTabOrderElements()}),this.context.stx)},n.Pz.inheritsFrom(n.Pz.UI.KeystrokeHub,n.Pz.UI.Helper),n.Pz.UI.KeystrokeHub.defaultHotKeys=function(t,e,i={}){const{hotkeyConfig:s={},keystroke:o,context:a}=e,{hotkeys:r=[]}=s,{stx:c}=a,{code:l,keyCode:h,shiftKey:d}=i||{},u=l&&l.includes("Numpad");return"Unidentified"==t&&(t=String.fromCharCode(h)),o.shift=d,r.slice().reverse().reduce((function(t,{action:e,commands:i,options:n}){return t.concat(i.map((t=>({action:e,command:t,options:n}))))}),[]).map((function({action:t,command:e,options:i}){return{action:t,options:i,modifiers:(e="+"===e?["+"]:"++"===e.slice(-2)?e.slice(0,-2).split("+").concat("+"):e.split("+")).slice(0,-1),commandKey:e.slice(-1)[0],specificity:e.length}})).filter((function({modifiers:e,commandKey:i}){let n=(u?[l]:[l,t]).includes(i),s=!e.length||e.every((t=>o[o.mapKey(t)]));return n&&s})).sort((function(t,e){return e.specificity-t.specificity})).some((function({action:t,options:e}){return"string"==typeof t?n.Pz.UI.KeystrokeHub.executeHotkeyCommand({stx:c,action:t,options:e}):"function"==typeof t?!1!==t({stx:c,options:e}):void 0}))},n.Pz.UI.KeystrokeHub.addHotKeyHandler=function(t,e,i){const s=({value:i})=>{i&&setTimeout((()=>{const s=n.Pz.getFromNS(i.config,"hotkeyConfig.hotkeys",[]).find((({action:e})=>e===t));s&&(s.action=e)}))};n.Pz.UI.observeProperty("uiContext",i,s),i.addEventListener("destroy",(()=>n.Pz.UI.unobserveProperty("uiContext",i,s)))},n.Pz.UI.KeystrokeHub.executeHotkeyCommand=function({stx:t,action:e,options:i={}}){const{crosshair:s,candleWidth:o}=t.layout,{left:a,right:r,panel:c}=t.chart,l=t.height-t.xaxisHeight,{percent:h=0,bars:d=0}=i,{topNode:u}=t.uiContext,p=u.ownerDocument.body.keystrokeHub,m=({axis:e,direction:i=1}={})=>{const{cx:n,cy:s}=t;let c=0;if("x"===e&&(c=o*d),"y"===e&&(c=l*h),t.crossSection&&t.crossSection.crosshairBreakDistance&&(c=t.crossSection.crosshairBreakDistance),n||0===n||(t.cx=Math.round(t.width/2)),s||0===s||(t.cy=Math.round(l/2)),c){let n=t["c"+e]+c*i;n=Math.max(n,"x"===e?a+1:0),n=Math.min(n,"x"===e?r-1:l),t["c"+e]=Math.round(n)}t.mousemoveinner(t.resolveX(t.cx),t.resolveY(t.cy)),t.draw()},g=({direction:e=1,page:i}={})=>{const{dataSet:n,scroll:s,maxTicks:o}=t.chart;let a=i?o:d;a*=e,s+a>=n.length?t.chart.scroll=n.length:t.chart.scroll+=a,t.draw(),t.headsUpHR()},f=(e=1)=>{let i=l*h*e;t.chart.yAxis.scroll+=i,t.draw()},v=(e=1)=>{[...c.yaxisLHS,...c.yaxisRHS].forEach((t=>{let i=t.zoom+25*e;i<t.height&&(t.zoom=i)})),t.draw()};switch(e){case"up":s?m({axis:"y",direction:-1}):f();break;case"down":s?m({axis:"y"}):f(-1);break;case"right":s?m({axis:"x"}):g({direction:-1});break;case"left":s?m({axis:"x",direction:-1}):g();break;case"pageRight":g({direction:-1,page:!0});break;case"pageLeft":g({page:!0});break;case"zoomInXAxis":if(!t.allowZoom||t.activeDrawing&&!t.allowDrawingZoom)return;t.zoomIn();break;case"zoomOutXAxis":if(!t.allowZoom||t.activeDrawing&&!t.allowDrawingZoom)return;t.zoomOut();break;case"zoomInYAxis":v(-1);break;case"zoomOutYAxis":v();break;case"toggleCrosshairs":const e=u.querySelector('cq-toggle[cq-member="crosshair"]');e?e.dispatchEvent(new Event("stxtap")):t.layout.crosshair=!t.layout.crosshair,m();break;case"toggleContinuousZoom":t.continuousZoom&&t.continuousZoom.smartZoomToggle();break;case"symbolLookup":let i=(u.parentElement&&u.parentElement.closest("cq-context")||u).querySelector(".ciq-search cq-lookup cq-lookup-input input");if(i)i.focus();else{const e=n.Pz.UI.getMyContext(u);n.Pz.UI.BaseComponent.prototype.channelWrite("channel.dialog",{type:"lookup",params:{context:e}},t)}break;case"home":t.home(),t.headsUpHR();break;case"end":t.chart.scroll=t.chart.dataSet.length,t.draw(),t.headsUpHR();break;case"delete":if(n.Pz.ChartEngine.drawingLine)t.undo();else{if(!t.anyHighlighted)return!1;t.deleteHighlighted()}break;case"escape":if(n.Pz.ChartEngine.drawingLine)"continuous"==t.currentVectorParameters.vectorType&&n.Pz.ChartEngine.completeDrawing(t),t.undo();else if(t.repositioningAnchorSelector)n.Pz.Studies.cancelRepositionAnchor(t);else{const t=n.Pz.UI.getUIManager(u);if(p.tabActiveModals.length){if(p.tabActiveModals[0].processEsc&&p.tabActiveModals[0].processEsc(p))break;t&&t.closeMenu(p.tabActiveModals[0]),p.tabActiveModals[0]&&p.setKeyControlElement(p.tabActiveModals[0])}else t&&t.closeMenu()}break;case"keyboardNavigateDeselect":p.tabOrderDeselect();break;case"keyboardNavigateNext":if(p.tabActiveModals.length)return!1;p.tabIndexNext();break;case"keyboardNavigatePrevious":if(p.tabActiveModals.length)return!1;p.tabIndexNext(!0);break;case"keyboardNavigateClick":if(p.tabActiveModals.length)return!1;p.tabOrderClickSelected();break;default:return!1}return!0},n.Pz.UI.KeystrokeHub.prototype.resetTabNavigation=function(){const{topNode:t}=this.context;this.tabOrder=[null],this.tabIndex=0,this.yNormalizationThreshold=t.getBoundingClientRect().height/25,this.tabActiveElement=null,this.tabActiveModals=[],this.keyControlElement=null,this.highlightElement&&this.highlightElement.parentElement!==t?(this.highlightElement.remove(),t.append(this.highlightElement)):this.highlightHide();const e={pointerdown:()=>this.tabOrderDeselect(),pointermove:()=>t.classList.remove("disable-mouse-pointer")};for(const i in e)t.pointerHandlers&&t.removeEventListener(i,t.pointerHandlers[i]),t.addEventListener(i,e[i]);t.pointerHandlers=e,this.context.stx.append("resizeChart",(()=>{this.setTabOrderElements(),this.highlightAlign()})),this.setTabOrderElements()},n.Pz.UI.KeystrokeHub.prototype.setTabOrderElements=function(){let t=null;if(0!==this.tabIndex){let e=this.tabOrder[Math.abs(this.tabIndex)];e?t=e.element:this.tabIndex=0}this.tabOrder=[null];for(let t=0;t<this.tabElementSelectors.length;t++){const e=n.Pz.UI.BaseComponent.prototype.qsa(this.tabElementSelectors[t],this.context.topNode,!0);for(let t=0;t<e.length;t++){const i=e[t];"false"!==i.getAttribute("keyboard-navigation")&&(i.tabListenerAdded||(i.addEventListener("stxtap",function(t){let e=this.tabOrder.findIndex((e=>e&&e.element===t));return e!=this.tabIndex&&(this.tabOrderDeselect(),this.tabIndex=-e),!0}.bind(this,i)),i.tabListenerAdded=!0),this.tabOrder.push({element:i}))}}this.sortTabOrderElements(t)},n.Pz.UI.KeystrokeHub.prototype.sortTabOrderElements=function(t){const e=this.tabIndex<0;t||0===this.tabIndex||this.tabOrder[Math.abs(this.tabIndex)]&&(t=this.tabOrder[Math.abs(this.tabIndex)].element),this.tabOrder.forEach((t=>{if(!t)return;const{x:e,y:i,width:n,height:s}=t.element.getBoundingClientRect();t.position={x:e,y:i,width:n,height:s}})),this.tabOrder.sort(((t,e)=>{if(null!==t&&null!==e)return Math.floor(t.position.y/this.yNormalizationThreshold)-Math.floor(e.position.y/this.yNormalizationThreshold)||t.position.x-e.position.x})),t&&this.tabOrder.forEach(((i,n)=>{i&&i.element==t&&(this.tabIndex=e?-n:n)}))},n.Pz.UI.KeystrokeHub.prototype.setKeyControlElement=function(t,e){(this.keyControlElement||t)&&(this.disableKeyControlElement(this.keyControlElement,e),t&&(this.keyControlElement=t,this.keyControlElement.keyboardNavigation=this,"function"==typeof this.keyControlElement.onKeyboardSelection&&this.keyControlElement.onKeyboardSelection()))},n.Pz.UI.KeystrokeHub.prototype.disableKeyControlElement=function(t,e){t&&(e||"function"!=typeof t.onKeyboardDeselection||t.onKeyboardDeselection(),t.keyboardNavigation=null)},n.Pz.UI.KeystrokeHub.prototype.tabOrderDeselect=function(t){const{tabOrder:e,tabIndex:i}=this;i<=0||(e[i]&&this.disableKeyControlElement(e[i].element),t||(this.tabActiveElement=null,this.tabIndex=-this.tabIndex,this.highlightHide(),this.context.topNode.classList.remove("disable-mouse-pointer")))},n.Pz.UI.KeystrokeHub.prototype.tabOrderSelect=function(){this.tabActiveElement&&clearTimeout(this.tabActiveElement.element.highlightDelayTimeout);const{tabOrder:t,tabIndex:e}=this;e<=0?this.highlightHide():this.highlightPosition(t[e])},n.Pz.UI.KeystrokeHub.prototype.tabOrderClickSelected=function(){const{tabOrder:t,tabIndex:e}=this;t.length<=1||e<=0||(this.setKeyControlElement(t[e].element),t[e].element.dispatchEvent(new Event("stxtap")))},n.Pz.UI.KeystrokeHub.prototype.tabIndexNext=function(t){if(!this.context.stx.uiContext.topNode.hasAttribute("cq-keyboardnavigation-active"))return;if(this.tabOrder.length<=1)return;this.context.stx.uiContext.topNode.focus(),this.sortTabOrderElements(),this.tabIndex<0?this.tabIndex=Math.abs(this.tabIndex):this.tabOrderDeselect(!0),(this.tabIndex<1||this.tabIndex>=this.tabOrder.length)&&(this.tabIndex=t?this.tabOrder.length:1);let e=this.tabIndex,i=!1;do{if(!0===t?e--:e++,this.tabOrder[e]&&n.Pz.trulyVisible(this.tabOrder[e].element)&&"false"!==this.tabOrder[e].element.getAttribute("keyboard-selectable")){if(i)break;this.tabIndex=e,i=!0}}while(e<this.tabOrder.length&&e>0);(e>=this.tabOrder.length||e<=1)&&(e>=this.tabOrder.length?this.context.topNode.setAttribute("cq-exit","foot"):e<=1&&this.context.topNode.setAttribute("cq-exit","head"),this.context.topNode.removeAttribute("cq-keyboardnavigation-active")),this.tabOrderSelect(),this.uiManager.closeMenu()},n.Pz.UI.KeystrokeHub.prototype.addActiveModal=function(t){this.tabActiveModals.indexOf(t)>-1||(this.tabActiveModals.unshift(t),this.tabOrderDeselect(),t.hasAttribute("native-tabbing")||this.setKeyControlElement(t))},n.Pz.UI.KeystrokeHub.prototype.removeActiveModal=function(t){let{tabActiveModals:e}=this,i=e.indexOf(t);i>-1&&(e.splice(i,1),e[0]?this.setKeyControlElement(e[0]):this.setKeyControlElement())},n.Pz.UI.KeystrokeHub.prototype.highlightPosition=function(t){if(!t||!t.element||!t.position){const{tabOrder:e,tabIndex:i}=this;if(i<=0)return;t=e[i]}this.tabActiveElement=t,this.highlightAlign()},n.Pz.UI.KeystrokeHub.prototype.highlightAlign=function(){if(this.tabActiveElement){const t=this.tabActiveElement.element.getBoundingClientRect(),e=this.context.topNode.getBoundingClientRect();if(t.width<=0||t.height<=0)return void this.highlightHide();this.highlightCreate(),Object.assign(this.highlightElement.style,{top:t.top-e.top+"px",left:t.left-e.left+"px",width:t.width+"px",height:t.height+"px"})}},n.Pz.UI.KeystrokeHub.prototype.highlightCreate=function(){return this.highlightElement?this.highlightElement.classList.remove("disabled"):(this.highlightElement=document.createElement("div"),this.highlightElement.classList.add("cq-keyboard-selected-highlight"),this.context.topNode.appendChild(this.highlightElement)),this.context.topNode.classList.add("disable-mouse-pointer"),this.context.topNode.classList.add("cq-navigation-highlight-visible"),this.highlightElement},n.Pz.UI.KeystrokeHub.prototype.highlightHide=function(){this.highlightElement&&this.highlightElement.classList.add("disabled"),this.context.topNode.classList.remove("cq-navigation-highlight-visible")},n.Pz.UI.KeystrokeHub.prototype.setActiveContext=function(t){t.topNode.querySelector("cq-context")||(this.context=t)},n.Pz.UI.KeystrokeHub.prototype.processKeyStrokeClaims=function(t,e,i,s){for(let a of Array.from(n.Pz.UI.keyboardClaims).reverse())if(a.ownerDocument===i.target.ownerDocument){var o=a.keyStroke(t,e,i,s);if(o)return o.allowDefault||i.preventDefault(),!0}return!1},n.Pz.UI.KeystrokeHub.prototype.handler=function(t){const{stx:e}=this.context;if(e.editingAnnotation)return;const{e:i,key:s,keystroke:o}=t;if(!this.infocus&&"Tab"!==s)return;const a=i.composedPath()[0].tagName;switch(s){case"Shift":e.shift=o.shift;break;case"Control":case"Alt":e.ctrl=o.ctrl;break;case"Meta":case"Win":e.cmd=o.cmd;break;case"CapsLock":this.capsLock=!this.capsLock}const r="Escape"===i.key||"Esc"===i.key||"Tab"===i.key,c="INPUT"===a||"TEXTAREA"===a,l=this.uiManager.activeMenuStack.length;if(this.params.cb&&!this.context.isLegendKeyboardActive()&&(r||!c&&!l)&&this.params.cb(s,this,i))return i.preventDefault();n.Pz.ChartEngine.drawingLine||this.processKeyStrokeClaims(this,s,i,o)};class u extends HTMLElement{constructor(){super(),this.activeMenuStack=[],this.registeredForResize=[],this.keystrokeHub=null}connectedCallback(){var t=this;this.resize=function(){for(var e=t.registeredForResize,i=0;i<e.length;i++)"function"==typeof e[i].resize&&e[i].resize()};var e=this.document||document;e.body.addEventListener("stxtap",(function(i){i.ciqStamp>(e.lastTap||0)&&t.closeTopMenu()})),n.Pz.installTapEvent(e.body,{preventUnderlayClick:!1,preventClickEvent:!0,absorbDownEvent:!1}),e.defaultView.addEventListener("resize",this.resize),e.body.contains(this)&&(n.Pz.UI.registerComponentsImmediately=!0,n.Pz.UI.ensureComponentsRegistered())}disconnectedCallback(){(this.document||document).defaultView.removeEventListener("resize",this.resize)}closeMenu(t,e){var i=this.activeMenuStack,n=[];if(e=(e||"").split(",").map((t=>t.trim())).filter((t=>t)),t)for(n.push(t),t=t.parentElement;t;)t.matches("cq-menu")&&t.active&&n.push(t),t=t.parentElement;else n=i;for(var s=0;s<n.length;s++){const t=n[s];e.length&&!e.includes(t.tagName)||(t.keepOpen||t.hide&&t.hide())}this.activeMenuStack=i.filter((function(t){return t.active})),this.ifAllClosed()}closeTopMenu(){var t=this.activeMenuStack;if(t.length){var e=t[t.length-1],i=this;e.isDialog&&!e.active||(t.pop(),e.hide(),e.onClose&&e.onClose(),setTimeout((function(){i.ifAllClosed()}),0));var s=e.getAttribute("cq-close-top");s&&n.Pz.climbUpDomTree(e.parentElement,s).forEach((function(t){i.closeMenu(t)}))}}ifAllClosed(){this.activeMenuStack.length||Array.from((this.document||document).querySelectorAll("cq-context,*[cq-context]")).forEach((function(t){t.CIQ&&t.CIQ.UI&&t.CIQ.UI.context&&t.CIQ.UI.context.stx&&t.CIQ.UI.context.stx.modalEnd()}))}initializeMenuListeners(t){t.callbackListeners.menu=[]}lift(t){var e=t;if(e){var i=e.ownerDocument;e.remember={parentNode:e.parentNode,css:{position:e.style.position,display:e.style.display,left:e.style.left,top:e.style.top,height:e.style.height,width:e.style.width,opacity:e.style.opacity}};var n=e.getBoundingClientRect(),s=e.scrollHeight;e.doNotDisconnect=!0,e.remove(),e.reduceMenuHeight=5,Object.assign(e.style,{position:"absolute",display:"block",left:n.left+"px",top:n.top+"px",height:s+"px",opacity:1}),i.body.appendChild(e),delete e.doNotDisconnect,void 0!==e.resize&&e.resize(),Array.from(e.querySelectorAll("cq-scroll")).forEach((function(t){t.resize()}))}}openMenu(t,e){setTimeout((function(){var e=t.querySelector("input:first-child");e&&e.focus()}),0),this.activeMenuStack.push(t),t.show(e),t.ownerDocument.querySelectorAll("cq-context,*[cq-context]").forEach((function(e){const i=n.Pz.getFromNS(e,"CIQ.UI.context.stx");i&&(i.modalBegin(),i.callbackListeners.menu&&i.dispatch("menu",{stx:i,menu:t}))}))}registerForResize(t){this.registeredForResize.push(t)}topMenu(){var t=this.activeMenuStack;return t.length?t[t.length-1]:null}unregisterForResize(t){for(var e=this.registeredForResize,i=0;i<e.length;i++)if(e[i]===t)return void e.splice(i,1)}}n.Pz.UI.UIManager=u,n.Pz.ChartEngine.registerGlobalEvent("unload",(function(){const t=n.Pz.UI._uiManagers.get(this.document);if(t){n.Pz.UI._uiManagers.delete(this.document);try{t.disconnectedCallback()}catch(t){}}}),!1,!0),n.Pz.UI.getUIManager=function(t){let e=document;if(t){const i=n.Pz.UI.closestContextContainer(t);e=i?i.portalDoc||e:t.ownerDocument||e}n.Pz.UI._uiManagers||(n.Pz.UI._uiManagers=new WeakMap);const i=n.Pz.UI._uiManagers.get(e);if(i)return i;let s=e.querySelector("cq-ui-manager");return s||(s=new n.Pz.UI.UIManager,s.document=e,s.connectedCallback()),n.Pz.UI._uiManagers.set(e,s),s},customElements.define("cq-ui-manager",u);const{qs:p,qsa:m,channelWrite:g,channelRead:f,channelSubscribe:v}=n.Pz.UI.BaseComponent.prototype;n.Pz.UI.Chart=class{createChartAndUI({container:t,config:e}){t||(t=document.body),e&&!e.chartId&&(e.chartId=t.id);const i=function(t){if(t.matches("cq-context")||t.getAttribute("cq-container"))return t;return t.querySelector("cq-context, [cq-context]")}(t),s=p("cq-context",i),o=n.Pz.getFromNS(s,"CIQ.UI.context"),a=p(o?"[cq-context-engine]":".chartContainer",i),r=n.Pz.ChartEngine.create({container:a,config:e,deferLoad:!0});a.stx=r;const c=r.container.closest("cq-context-wrapper");if(c&&null===e.multiChartCopySymbol&&!e.initialSymbol){const{onChartReady:t,onMultiChartEvent:i}=e;e.onChartReady=function(n){t&&t.call(e,n),i&&i("chartReady",{stx:n}),null===n.chart.symbolObject.symbol&&(n.container.insertAdjacentHTML("beforeend",`<div class='ciq-empty-message'>${n.translateIf(e.multiChartLoadMsg)}</div>`),c&&(c.classList.add("ciq-empty-chart"),c.removeEmptyMsg=()=>{c.querySelector(".ciq-empty-message").remove(),c.classList.remove("ciq-empty-chart"),delete c.removeEmptyMsg}))}}n.Pz.UI.scrollbarStyling=e.scrollbarStyling,n.Pz.UI.ensureComponentsRegistered(),this.portalizeContainerIfInDifferentDocument(t);let l=new n.Pz.UI.Context(r,i);return l.topNode.hasAttribute("tabindex")||l.topNode.setAttribute("tabindex","0"),l.config=e,t.context=l,n.Pz.UI.Layout(l),n.Pz.UI.Channel(l),this.initMenusAndToggles(l),this.initLookup(l),this.initDialogHandler(l),this.initContainerListeners(l),this.initEventMarkers(l),this.initDrawingTools(l),this.initDrawingEditListeners(l),this.loadPreferences(l),function(t){const e=document.createElement("div");e.classList.add("cq-plugin-container"),t.topNode.appendChild(e);const i=p(".ciq-chart-area",t.topNode),s=n.Pz.resizeObserver(e,(()=>{const{height:n}=getComputedStyle(e);i.style.marginTop=n,t.stx.resizeChart()}));t.stx.addEventListener("destroy",(()=>{n.Pz.resizeObserver(e,null,s)}))}(l),o||(n.Pz.UI.StudyEdit(null,l),this.initColorPicker(l),n.Pz.Renderer.Bars&&n.Pz.UI.activatePluginUI(r,"advanced"),this.initExtensions({stx:r,uiContext:l,type:"plugins"}),e.onEngineReady&&e.onEngineReady(r),this.loadChart(l)),e.language&&n.Pz.I18N.localize(r,e.language),n.Pz.UI.BaseComponent.buildReverseBindings(i),o||(i.bindingInitiated=!0,n.Pz.UI.begin(e.onWebComponentsReady),l.uiManager=n.Pz.UI.getUIManager(l.topNode),l.uiManager.initializeMenuListeners(r),window.setTimeout((function(){l.topNode.ownerDocument.body.keystrokeHub.resetTabNavigation(),n.Pz.UI.setDefaultStates(l)}),0)),l}initContainerListeners(t){const{config:{channels:{className:e="channel.componentClass",breakpoint:i="channel.breakpoint",sidenavSize:s="channel.sidenavSize",sidepanelSize:o="channel.sidepanelSize",drawingPalettes:a="channel.drawingPalettes",pluginPanelHeight:r="channel.pluginPanelHeight"}={}}={},stx:c,topNode:l}=t;n.Pz.UI.addResizeListener(l,(()=>this.notifySizeChanges(t))),c.addEventListener("destroy",(()=>n.Pz.UI.removeResizeListener(l))),this.notifySizeChanges(t),v(e,this.classSetter(t),c),v(i,this.breakpointSetter(t),c),v(s,this.sidenavSizeSetter(t),c),v(o,this.sidepanelSizeSetter(t),c),v(a,this.chartPositionSetter(t),c);const h=this.initKeystrokeHub(t),d=this.getKeystrokeHubSetter(t,h);l.addEventListener("mouseover",d),l.addEventListener("focus",(t=>{t.target.hasAttribute("cq-keyboardnavigation-active")||(d(t),t.target.setAttribute("cq-keyboardnavigation-active",""),h.resetTabNavigation())})),l.addEventListener("blur",(t=>{const e=document.querySelector(".cq-dialogs");t.relatedTarget&&(l.contains(t.relatedTarget)||e&&e.contains(t.relatedTarget))||(t.target.removeAttribute("cq-keyboardnavigation-active"),h.tabOrderDeselect(),h.highlightHide())}))}initLookup(t){const{config:e,topNode:i,stx:s}=t,{channels:{lookup:o}={},dialogs:{lookup:a}={}}=e;if(o&&a){const{channelSubscribe:e,channelWrite:i}=n.Pz.UI.BaseComponent.prototype;e(o,(e=>{i("channel.dialog",e?{type:"lookup",params:{stx:s,context:t}}:{},s)}),s)}this.initKeystrokeHub(t),t.changeSymbol=function(i,s){const{stx:o,loader:a}=t;a&&a.show(),i.symbol==i.symbol.toLowerCase()&&(i.symbol=i.symbol.toUpperCase());const{removeSeries:r,loadError:c}=e.onNewSymbolLoad||{};if(r&&Object.values(o.chart.series).filter(r).forEach((t=>o.removeSeries(t.id))),o.loadChart(i,{masterData:i._masterData},(function(i){a&&a.hide(),i?c&&c(i,t):(s&&s(o),e.restore&&n.Pz.ChartEngine.restoreDrawings(o,o.chart.symbol,e.chartId))})),i.symbol){const e=t.topNode.closest("cq-context-wrapper");e&&e.removeEmptyMsg&&e.removeEmptyMsg()}},e.lookupDriver&&t.setLookupDriver(new e.lookupDriver)}initKeystrokeHub(t){let e=document;return t&&(e=t.topNode.portalDoc||e),e.body.keystrokeHub||(e.body.keystrokeHub=new n.Pz.UI.KeystrokeHub(e.body,t,{cb:n.Pz.UI.KeystrokeHub.defaultHotKeys})),e.body.keystrokeHub}getKeystrokeHubSetter(t,e){return function(){e.context!==t&&e.setActiveContext(t)}}initDialogHandler(t){const{config:{channels:e={},dialogs:i={}}={},stx:s}=t;v(e.dialog||"channel.dialog",(function({type:t=null,params:e={}}={}){if(!t)return;const s=i[t]||i[n.Pz.makeCamelCase(t)];if(!s)return;const o=e.context.topNode.ownerDocument;let a=p(s.tag,o);if(!a){const t=function(t){let e=p(".cq-dialogs",t);return e||(e=document.createElement("div"),e.classList.add("cq-dialogs"),t.body.append(e),e)}(o),e=document.createElement("cq-dialog");a=document.createElement(s.tag),Object.entries(s.attributes||{}).forEach((([t,e])=>a.setAttribute(t,e))),e.append(a),t.append(e)}a&&a.open&&a.open(e)}),s)}initDrawingTools(t){const{stx:e,config:{channels:i={}}={},topNode:n}=t;v(i.drawing||"channel.drawing",(function(t){n.classList[t?"add":"remove"]("toolbar-on"),e.resizeChart()}),e)}initDrawingEditListeners(t){const{config:{channels:e={}}={},stx:i}=t,s=new n.Pz.UI.DrawingEdit(null,t);let o=!0;const a=e.drawing||"channel.drawing";s.node.addEventListener("drawing-edit-begin",(function(t){f(a,i)||(o=!1,g(a,!0,i))}),!1),s.node.addEventListener("drawing-edit-end",(function({detail:t}){o||("edit"!==t.action&&(o=!0),"close"===t.action&&g(a,!1,i))}),!1)}initColorPicker(t){let e=document;t&&(e=t.topNode||e);let i=e.querySelector("cq-color-picker");i||(e=e.ownerDocument||e,i=e.querySelector("body > cq-color-picker"),i||(i=document.createElement("cq-color-picker"),document.body.append(i),e.ownerDocument&&e.ownerDocument.body.append(i)))}loadPreferences(t){const{stx:e,topNode:i,config:{chartId:s,multiChartId:o,restore:a}={}}=t;a&&n.Pz.ChartEngine.restorePreferences(e,o||s||i.id)}loadChart(t){const{stx:e,config:{chartId:i,initialSymbol:s,restore:o,onChartReady:a,initialData:r}={},loader:c}=t;function l(){if(e.crossSection&&e.setChartType("crosssection"),!s)return void h();const i="string"==typeof s?{symbol:s}:s;i._masterData=r,t.changeSymbol(i,h)}function h(){a&&setTimeout((()=>a(e)))}c&&c.show(),o?n.Pz.ChartEngine.restoreLayout(e,(function(){c&&c.hide(),e.chart.symbol?h():l()}),i,t.config):l()}notifySizeChanges(t){const{stx:e,topNode:{clientWidth:i,clientHeight:n,classList:s},config:{channels:o={}}={}}=t;if(e.destroyed)return;const a=f(o.containerSize||"channel.containerSize",e);if(a&&a.width===i&&a.height===n)return;const r=this.getBreakpoint(i,n);s.contains(r[1])||g(o.breakpoint||"channel.breakpoint",r[1],e),r[0]!==e.chart.breakpoint&&window.setTimeout((()=>{g(o.breakpoint||"channel.breakpoint",r[0],e),e.notifyBreakpoint(r[0]),e.resizeChart()})),g(o.containerSize||"channel.containerSize",{width:i,height:n},e),e.resizeChart()}getBreakpoint(t,e){let i="break-sm";if(t>768?i="break-lg":t>584&&(i="break-md"),void 0===e)return i;let n="break-height-sm";return e>768?n="break-height-lg":e>350&&(n="break-height-md"),[i,n]}initEventMarkers(t){const e=t.config;if(e.eventMarkersImplementation&&n.Pz.UI.Markers){const i=e.eventMarkersImplementation&&new e.eventMarkersImplementation(t.stx),s=e.selector.markersMenuItem;n.Pz.UI.Markers(t,{menuItemSelector:s,implementation:i})}}initExtensions({stx:t,uiContext:e,type:i}){const{config:s}=e,o=s[i];Object.entries(o).filter((([,t])=>!!t)).forEach((([s,o])=>{const a=o.moduleName||n.Pz.capitalize(s);try{if(!n.Pz[a])return void(n.Pz.debug&&console.log(`${a} not available for ${i} with params:`,o));const s=Object.assign({stx:t,context:e},o),r=new n.Pz[a](s);n.Pz.UI.activatePluginUI(t,a),o.postInstall&&o.postInstall({uiContext:e,extension:r})}catch(t){n.Pz.debug&&console.error("Error configuring "+i+" using params ",o,"error",t)}}))}initMenusAndToggles(t){const{config:e}=t;e.toggles=e.toggles||{},t.advertiseAs(e.toggles,"ToggleConfig"),e.menus=e.menus||{},t.advertiseAs(e.menus,"MenuConfig"),[...n.Pz.UI.shadowComponents.keys()].forEach((t=>t.fireConfigChange&&t.fireConfigChange()))}chartPositionSetter(t){let e=p(".ciq-multi-chart-container",t.topNode);return e||(e=p(".chartContainer",t.topNode)),function(t){if(!t)return;const{top:i,left:n}=t;Object.assign(e.style,{top:i+"px",marginLeft:n+"px",height:`calc(100% - ${i}px)`})}}sidenavSizeSetter(t){const e=p(".ciq-multi-chart-container-wrapper, .ciq-chart-area",t.topNode);t.stx;return function(i){e.style.left=i+"px",n.Pz.getFnFromNS(t,"topNode.getCharts",[t.stx])().forEach((t=>t.resizeChart()))}}chartAreaTopSetter(t){const e=p(".ciq-chart-area",t.topNode);return function(i){let n=Object.values(i||{}).reduce(((t,e)=>t+e),0);const s=t.topNode.querySelector(".cq-plugin-container");s&&(n=s.offsetHeight),e.style.marginTop=n+"px",t.stx.resizeChart()}}sidepanelSizeSetter(t){const{multiChartContainer:e}=t.topNode,i=p(".ciq-multi-chart-container, .ciq-chart-area",e||t.topNode),n=t.stx;return function(e){i.style.marginRight=e+"px";const s=p(".cq-plugin-container",t.topNode);s&&(s.style.marginRight=e+"px"),n.resizeChart()}}breakpointSetter(t){return function(e){let i=[["break-lg","break-md","break-sm"],["break-height-lg","break-height-md","break-height-sm"]];const s=[t.topNode];n.Pz.UI.shadowComponents.forEach(((e,i)=>{e===t.topNode&&s.push(i)})),s.forEach((t=>{i.forEach((i=>{i.includes(e)&&t.classList.remove(...i)})),t.classList.add(e)}))}}classSetter(t){return function(e){e&&n.Pz.UI.shadowComponents.forEach(((i,n)=>{for(const[s,o]of Object.entries(e))i===t.topNode&&n.classList[o](s)}))}}portalizeContainerIfInDifferentDocument(t){if(t.ownerDocument===document)return;const e=Object.keys(n.Pz.UI._webcomponents.list).join(","),i=Array.from(t.querySelectorAll(e)),s=i.filter((t=>!i.some((e=>e!==t&&e.contains(t)))));t.matches("cq-context")||(t=t.querySelector("cq-context")),(t||{}).portalDoc=t.ownerDocument,s.forEach((t=>{t.querySelectorAll("template").forEach((t=>{for(;t.firstChild;)t.content.append(t.firstChild)}));const e=document.createElement("div");e.innerHTML=t.outerHTML,t.parentElement.replaceChild(e.firstChild,t)}))}};n.Pz.UI.Multichart=class{createCharts({containerId:t,chartsConfig:e},i){const s=t&&"string"!=typeof t?t:document.querySelector(t||"cq-context");s.styles={},s.isMultiChartHost=!0;const o=Array.from(s.querySelectorAll("cq-context-wrapper"));if(!o.length)throw"cq-context-wrapper element is required for multichart template setup";const a=o[0].outerHTML;let{charts:r,colCount:c,rowCount:l,gridTemplate:h,offgridCharts:d=[]}=e;r.slice(0,r.length-o.length).forEach((()=>{o[0].parentElement.insertAdjacentHTML("beforeend",a)}));const u=s.querySelectorAll("cq-context");i.root=null,null===i.multiChartCopySymbol&&(i.initialSymbol=""),i.hotkeyConfig.hotkeys=i.hotkeyConfig.hotkeys.filter((({label:t})=>!/\btab\b/i.test(t)));const p=new n.Pz.UI.Chart,m=r.map((({symbol:t,chartId:e},o)=>{const a=n.Pz.clone(i);a.initialSymbol=void 0!==t?t:a.initialSymbol,a.chartId=e||(i.chartId||"")+"_c"+n.Pz.uniqueID();const r=u[o];a.root=r,r.multiChartContainer=s;const{stx:c}=p.createChartAndUI({container:r,config:a});return this.initChart(r,a,c),c}));let g;return p.createChartAndUI({container:s,config:i}),this.initContainer(s,i,a),this.setGridUI(s,c,l,h),m.forEach((t=>{t.setDrawingContainer(s.context.stx.drawingContainer),t.currentVectorParameters=s.context.stx.currentVectorParameters,t.preferences.drawings=s.context.stx.preferences.drawings})),v(i.channels.drawing||"channel.drawing",(function(t){s.classList[t?"add":"remove"]("toolbar-on");const{onDraw:e}=i.soloActive||{},{shouldSolo:n}=e||{},o=s.querySelector("cq-context-wrapper.active cq-context");s.activeRequests&&t&&(g=null);if(e&&s.soloActive&&o){const{stx:e}=o.CIQ.UI.context,i="function"!=typeof n||t&&n(e);(i||!t&&g===e)&&s.soloActive(t,"onDraw"),i&&(g=e)}s.context.stx.resizeChart()}),s.context.stx),s.colCount=c,s.rowCount=l,s.gridTemplate=h,s.offgridCharts=d,s.updateLayout(),m}initContainer(t,e,i){const n=t.querySelector("cq-context");t.plugins=[],this.contextSwitcher(t),this.addChart(t,e,i),this.moveChart(t,e),this.removeChart(t,e),this.solo(t,e),this.toggleSolo(t,e),this.setColCount(t),this.setRowCount(t),this.setGridTemplate(t),this.cleanGridStyles(t),this.fillLayoutWithCharts(t),this.updateGridListener(t),this.updateLayout(t,e),this.utils(t),this.copyAttributes(n,t),setTimeout((()=>{t.switchContext(n.CIQ.UI.context)}))}initChart(t,e,i){const s=n.Pz.UI.closestContextContainer(t.parentElement);let o;if(i.keepDrawingToolSelected=e.keepDrawingToolSelected,["mousedown","touchstart","pointerdown"].forEach((e=>{t.addEventListener(e,(t=>{if(function(){const t=+new Date,e=t-o;if(o&&e<10)return!0;o=t}())return;const e=t.target.closest("cq-context");if(e){const i=e.CIQ.UI.context;s.switchContext(i,t)}}),!0)})),e.onMultiChartEvent){const t=()=>{e.onMultiChartEvent("chartDestroy",{stx:i}),i.removeEventListener("destroy",t)};i.addEventListener("destroy",t)}void 0===i.keepDrawingToolSelected&&(i.keepDrawingToolSelected=!0),null===i.preserveCandleWidthOnResize&&(i.preserveCandleWidthOnResize=!0),i.prepend("mousemoveinner",(()=>{if(i.__notifiedExit)return;s.getCharts().forEach((t=>{t!==i&&(t.insideChart=t.overYAxis=t.overXAxis=!1,t.undisplayCrosshairs(),t.draw(),t.__notifiedExit=!1)})),i.__notifiedExit=!0})),n.Pz.UI.closestContextContainer(t,{isWrapper:!0}).close=function(){s.activeRequests&&s.toggleSolo({node:this}),s.removeChart(this)},n.Pz.UI.closestContextContainer(t,{isWrapper:!0}).move=function(t,e="after"){s.activeRequests&&s.toggleSolo({node:this}),s.moveChart(this,e)}}addChart(t,e,i){t.addChart=(s,o="after")=>{t.activeRequests&&t.toggleSolo({node:t.querySelector("cq-context-wrapper.active .ciq-solo-toggle")});let{node:a,symbol:r,chartId:c}=s||{};const l=a?n.Pz.UI.closestContextContainer(a,{isWrapper:!0}):t.querySelector("cq-context-wrapper.active");e.multiChartCopySymbol?r={...n.Pz.getFromNS(l.querySelector("cq-context"),"CIQ.UI.context.stx.chart.symbolObject")}:null===e.multiChartCopySymbol&&(r="");const{crosshair:h,headsUp:d}=l.querySelector("cq-context").CIQ.UI.context.stx.layout;let u;"after"===o?(l.insertAdjacentHTML("afterEnd",i),u=l.nextSibling):"before"===o&&(l.insertAdjacentHTML("beforeBegin",i),u=l.previousSibling),u.querySelector("cq-context").multiChartContainer=t,n.Pz.UI.BaseComponent.buildReverseBindings(u);const p=u.querySelector("cq-context"),m=n.Pz.clone(e);m.initialSymbol=void 0!==r?r:m.initialSymbol,m.chartId=c||`_c${n.Pz.uniqueID()}`,m.root=p;const g=m.createChart(p);return g.layout.crosshair=h,g.layout.headsUp=Object.assign({},d),t.querySelectorAll("cq-info-toggle-dropdown").forEach((e=>e.initInfoComponents(t))),t.setCurrentThemeClass&&t.setCurrentThemeClass(p,g),this.initChart(p,m,g),g.setDrawingContainer(t.context.stx.drawingContainer),g.currentVectorParameters=t.context.stx.currentVectorParameters,g.preferences.drawings=t.context.stx.preferences.drawings,t.updateLayout(),g}}moveChart(t,e){t.moveChart=(e,i="after")=>{const n=e||t.querySelector("cq-context-wrapper.active");let s="before"==i?n.previousElementSibling:n.nextElementSibling;s&&("after"==i&&(s=s.nextElementSibling),n.doNotDisconnect=!0,n.parentElement.insertBefore(n,s),delete n.doNotDisconnect),t.updateLayout()}}removeChart(t,e){t.removeChart=function(i){const s=i||t.querySelector("cq-context-wrapper:last-of-type"),o=s.classList.contains("active"),a=s.nextElementSibling||s.previousElementSibling;if(!a)return;o&&a.querySelector("cq-context").dispatchEvent(new Event("stxtap")),s.querySelector("cq-context").CIQ.UI.context.stx.destroy(),s.remove();const r=new(e.nameValueStore||n.Pz.NameValueStore),c=n.Pz.getFromNS(s.querySelector("cq-context")||{},"CIQ.UI.context.config.chartId");n.Pz.getFromNS(s.querySelector("cq-context")||{},"CIQ.UI.context.config.chartId");if(c){r.remove(`myChartLayout${c}`);const e=`${c||""}_drawings`;r.get(e,((t,i)=>{!t&&i&&(Object.keys(i).forEach((t=>{r.remove(t)})),r.remove(e))})),t.updateLayout()}t.switchContext(a.querySelector("cq-context").CIQ.UI.context)}}contextSwitcher(t){t.activeContext=t.CIQ.UI.context;const e=t.CIQ.UI.context;t.switchContext=(i,s)=>{if(function(e){if(!e)return;if(!i.stx.chart.symbolObject.symbol){if(e.target.closest("cq-menu"))return;n.Pz.UI.getUIManager(e.target).closeTopMenu(),e.stopPropagation();const s=t.querySelector(".ciq-search cq-lookup cq-lookup-input input");if(s)return void setTimeout((()=>{s.click(),s.focus()}));const o=(i.config.channels||{}).dialog||"channel.dialog",{channelWrite:a}=n.Pz.UI.BaseComponent.prototype;a(o,{type:"lookup",params:{context:i}},i.stx)}}(s),i===t.activeContext)return;var o;this.getCommonUI(t).forEach((t=>function(t,e){if(t.changeContext)return void t.changeContext(e);t.stx&&(t.stx=e.stx);t.context&&(t.context=e)}(t,i))),o=i,Object.values(e.advertised).forEach((t=>{t.changeContext&&t.changeContext(o)})),t.plugins.forEach((t=>{t.switchContext&&t.switchContext(i)})),Array.from(t.querySelectorAll("cq-context-wrapper")).forEach((t=>{const e=t.querySelector("cq-context").CIQ.UI.context;t.classList.toggle("active",i===e)})),t.activeContext=i;n.Pz.getFnFromNS(i,"config.onMultiChartEvent")("contextSwitch",{prev:t.activeContext,context:i})}}solo(t,e){const{freezeEngineRendering:i,transitionToSolo:s,transitionFromSolo:o}=this;t.resized=-1,t.soloActive=(a,r)=>{let{activeRequests:c=0}=t;const l=c;if(!a&&"toggle"!==r&&"toggle"===t.soloType)return;a&&0===c&&(t.soloType=r),c+=a?1:c?-1:0,"toggle"!==r||a||(c=0),Object.assign(t,{activeRequests:c});const h=t.querySelector("cq-context-wrapper.active");if(!h)return;c?setTimeout((()=>{s(t,i)}),100):o(t);const d=h.querySelector("cq-context").context.stx;if(a){const i=n.Pz.getFromNS(e,`soloActive.${r}.notify`);!l&&i&&t.classList.contains("ciq-multi-chart")&&d.dispatch("notification",i)}else c||Object.values(e.soloActive||{}).filter((t=>t.notify)).forEach((({notify:t})=>{d.dispatch("notification",Object.assign({},t,{remove:!0}))}))}}freezeEngineRendering(t){const e={draw(){},resizeChart(){}};function i(t){const{draw:i,resizeChart:n}=t;return Object.assign(t,e),{draw:i,resizeChart:n}}let n=0;const{quoteDriver:s}=t;s&&(n=s.behavior.refreshInterval,s.resetRefreshInterval(s.behavior.backgroundRefreshInterval||0));const{slider:o}=t.slider||{},{marketDepth:a}=t.marketDepth||{},r=i(t),c=i(o||{}),l=i(a||{});return()=>{Object.assign(t,r),s&&s.resetRefreshInterval(n),o&&Object.assign(o,c),a&&Object.assign(a,l),t.draw()}}transitionToSolo(t,e){const i=t.querySelector(".ciq-multi-chart-container"),{top:s,left:o}=i.getBoundingClientRect(),a=[];t.querySelectorAll("cq-context-wrapper").forEach((t=>{const i=t.classList.contains("active");if(!i){const i=t.querySelector("cq-context").CIQ.UI.context.stx;t.restoreDraw=e(i),setTimeout((()=>{t.style.visibility="hidden"}),550)}const{height:n,width:r,top:c,left:l}=t.getBoundingClientRect();a.push({el:t,style:{height:n+"px",width:r+"px",top:c-s+"px",left:l-o+"px"},className:i?"ciq-solo":"ciq-solo-minimized"})})),t.classList.add("ciq-solo"),a.forEach((({el:t,style:e,className:i})=>{Object.assign(t.style,e),setTimeout((()=>{t.classList.add(i)}),50)})),t.rHandle=n.Pz.resizeObserver(t,(()=>{t.resized+=1}))}transitionFromSolo(t){const e=t.querySelectorAll("cq-context-wrapper");e.forEach((e=>{e.classList.remove("ciq-solo-minimized","ciq-solo"),t.resized||(e.style.visibility="")})),setTimeout((()=>{t.classList.remove("ciq-solo"),e.forEach((t=>{t.classList.remove("ciq-solo-minimized","ciq-solo"),Object.assign(t.style,{height:"",width:"",top:"",left:"",visibility:""}),t.restoreDraw&&(t.restoreDraw(),delete t.restoreDraw)}))}),t.resized?0:350),n.Pz.resizeObserver(t,null,t.rHandle),t.resized=-1}toggleSolo(t,e){t.toggleSolo=({node:i})=>{const s=n.Pz.UI.closestContextContainer(i,{isWrapper:!0}).querySelector("cq-context").CIQ.UI.context;if(t.activeRequests){const{drawing:i="channel.drawing",tfc:o="channel.tfc"}=e.channels||{},{channelWrite:a}=n.Pz.UI.BaseComponent.prototype;a(i,!1,s.stx),a(o,!1,s.stx),t.soloActive(!1,"toggle")}else{n.Pz.UI.closestContextContainer(i,{isWrapper:!0}).classList.contains("active")||t.switchContext(s),t.soloActive(!0,"toggle")}}}setColCount(t){t.setColCount=function(e){t.gridTemplate="",t.colCount=e,t.updateLayout()}}setRowCount(t){t.setRowCount=function(e){t.gridTemplate="",t.rowCount=e,t.updateLayout()}}setGridTemplate(t){t.setGridTemplate=function(e){t.colCount="",t.rowCount="",t.gridTemplate=e,t.updateLayout()}}cleanGridStyles(t){t.cleanGridStyles=function(e){const i=t.querySelector("cq-grid-size-picker").templates.split(" "),n=t.querySelector(".ciq-multi-chart-container");n.style.gridTemplateRows="",n.style.gridTemplateColumns="",n.className=n.className.split(" ").filter((t=>!i.includes(t))).join(" ")}}fillLayoutWithCharts(t){t.fillLayoutWithCharts=function(){const e=t.querySelector(".ciq-multi-chart-container");if(!e)return;const i=getComputedStyle(e);let n=0;i.gridTemplateAreas&&"none"!=i.gridTemplateAreas?n=[...new Set(i.gridTemplateAreas.match(/([a-z])+/gi))].length:i.getPropertyValue("--grid-dimension")?(n=parseInt(i.getPropertyValue("--grid-dimension"))||0,n++):n=parseInt(t.rowCount)*parseInt(t.colCount);const{restoreOffgridCharts:s}=t.CIQ.UI.context.config;let{offgridCharts:o}=t;for(;n&&e.childElementCount!==n;)if(e.childElementCount>n){const e=t.querySelector("cq-context-wrapper:last-of-type").querySelector("cq-context").CIQ.UI.context.config,i=e.chartId;s&&o.push(i),e.chartId="",t.removeChart()}else{const i=e.querySelector("cq-context-wrapper:last-of-type cq-context"),n=s?o.pop():void 0;if(t.addChart({node:i,chartId:n}),e.childElementCount>=25)break}s&&t.updateLayout()}}updateGridListener(t){t.addEventListener("update-grid",(({detail:{columns:e,rows:i,template:n,container:s}})=>{s===t&&(n?t.setGridTemplate(n):e&&i&&(t.setColCount(e),t.setRowCount(i)),t.fillLayoutWithCharts())}))}updateLayout(t,e){t.updateLayout=function(){const i=new(e.nameValueStore||n.Pz.NameValueStore),s=Array.from(t.ownerDocument.querySelectorAll("cq-context-wrapper"),(t=>{const e=n.Pz.getFromNS(t.querySelector("cq-context")||{},"CIQ.UI.context.config.chartId");if(e)return{chartId:e}})).filter((t=>t));i.set("multiCharts"+(e.multiChartId||""),{charts:s,colCount:t.colCount,rowCount:t.rowCount,gridTemplate:t.gridTemplate,offgridCharts:t.offgridCharts}),t.classList[s.length>1?"add":"remove"]("ciq-multi-chart"),t.cleanGridStyles();const o=t.querySelector(".ciq-multi-chart-container");t.gridTemplate?o.classList.add(t.gridTemplate):t.rowCount&&t.colCount&&(o.style.gridTemplateColumns=Array(parseInt(t.colCount)).fill("1fr").join(" ")),o.style.setProperty("--orphan-span-start","1");const a=getComputedStyle(o),r=o.childElementCount,c="column"==a.gridAutoFlow?a.gridTemplateRows.split(" ").length:a.gridTemplateColumns.split(" ").length,l=r%c||c;let h="initial";l>0&&(h=`${l} / -1`),o.style.setProperty("--orphan-span-start",l)}}copyAttributes(t,e){t.getAttributeNames().filter((t=>/-feature$/.test(t))).forEach((i=>e.setAttribute(i,t.getAttribute(i))))}getCommonUI(t){return(e=".ciq-nav, .ciq-footer",i=t,e.split(/, |,/g).reduce(((t,e)=>{const n=i.querySelector(e);if(!n)return t;const s=Array.from(n.querySelectorAll("*"));return t.concat(s)}),[])).filter((t=>!("cq-themes"===t.localName||"cq-info-toggle-dropdown"===t.localName||"cq-side-nav"===t.localName||t.classList.contains("ciq-sidenav")||t.classList.contains("ciq-draw")||t.classList.contains("ciq-shortcut-button")||t.matches("cq-toggle[cq-member=tfc]"))));var e,i}setGridUI(t,e,i,n){const s=t.querySelector("cq-grid-size-picker");s&&(s.generateTable(+e+1,+i+1),s.highlightTable(+e,+i),s.highlightTemplate(n))}utils(t){t.getChartContainers=()=>Array.from(t.querySelectorAll("cq-context")).map((t=>t.querySelector(".chartContainer"))).concat(t.CIQ.UI.context.stx.container),t.getCharts=()=>t.getChartContainers().map((({stx:t})=>t))}},n.Pz.UI.setDefaultStates=function(t){const e=t.config.ariaActive;function i(t){const e=t.parentElement;e&&([...e.children].forEach((e=>{e.ariaHidden=t!==e&&"false"!==e.ariaHidden})),"false"===e.ariaHidden||e.matches("cq-context")||i(e))}null!==e&&(e&&e.length?e.forEach((e=>{let n=t.topNode.querySelector(e);n&&i(n)})):t.topNode.setAttribute("aria-hidden",!0))};class b{constructor(t,e){void 0!==e&&console.log("CIQ.UI.$() only accepts one input parameter.");let i=[];if(t instanceof b)return t;Array.isArray(t)&&(i=t),"object"==typeof t?t.ownerDocument?i.push(t):"[object NodeList]"!==t.toString()&&"[object HTMLCollection]"!==t.toString()||(i=Array.from(t)):"string"==typeof t&&(console.log("Note: string argument for CIQ.UI.$(element) deprecated and may be removed in the future"),i=i=Array.from(document.querySelectorAll(t)));const n=this.length=i.length;for(let t=0;t<n;t++)this[t]=i[t]}_(t,e){const i=[],n=t=>{e&&!t.matches(e)||i.includes(t)||i.push(t)};for(let e=0;e<this.length;e++){const i=this[e];Array.from(t(i)).forEach(n)}return new b(i)}addClass(t){return"string"==typeof t&&(t=t.split(" ")),t.forEach((t=>this._((e=>(e.classList.add(t),[e]))))),this}append(t,e){if(void 0!==e&&console.log("CIQ.UI.$#append only accepts one argument."),t instanceof Array)for(let e=0;e<t.length;e++)this.append(t[e]);else{if("string"==typeof t)return this._((e=>(e["<"===t[0]?"innerHTML":"innerText"]+=t,[e])));if(t.ownerDocument){const e=this._((e=>(e.appendChild(t.cloneNode(!0)),[e]))),i=e[e.length-1];return i.replaceChild(t,i.lastChild),e}if(t instanceof b)return this.append(Array.from(t))}return this}attr(t,e){if("object"==typeof t)return this._((e=>(Object.keys(t).forEach((i=>e.setAttribute(i,t[i]))),[e])));if(void 0===e){if(!this[0])return;const e=this[0].getAttribute(t);if(null===e)return;return e}return this._((i=>(i.setAttribute(t,e),[i])))}children(t){return this._((t=>t.children),t)}css(t,e){return"object"==typeof t?this._((e=>(Object.assign(e.style,t),[e]))):void 0===e?this[0]?getComputedStyle(this[0])[t]:void 0:this._((i=>(i.style[t]=e,[i])))}each(t){for(let e=0;e<this.length;e++)t.call(this[e],e,this[e]);return this}empty(){return this._((t=>(t.innerHTML="",[t])))}find(t){return t?this._((e=>e.querySelectorAll(t))):new b([])}hasClass(t){return this._((e=>e.classList.contains(t)&&[e])).length>0}hide(){return this._((t=>("none"!==t.style.display&&(t.style.displayCache=t.style.display,t.style.display="none"),[t])))}html(t){return this.prop("innerHTML",t)}nextAll(t){return this._((t=>{const e=Array.from(t.parentNode.children);return e.slice(e.indexOf(t)+1)}),t)}not(t){return this._((e=>!e.matches(t)&&[e]))}parent(t){return this._((t=>[t.parentNode]),t)}parents(t){return this._((e=>n.Pz.climbUpDomTree(e.parentElement,t)||[]))}prop(t,e){return"object"==typeof t?this._((e=>(Object.keys(t).forEach((i=>e[i]=t[i])),[e]))):void 0===e?this[0]?this[0][t]:void 0:this._((i=>(i[t]=e,[i])))}remove(t){return Array.from(this).forEach((e=>{t&&!e.matches(t)||e.parentNode.removeChild(e)})),this}removeAttr(t){return"string"==typeof t&&(t=t.split(" ")),t.forEach((t=>this._((e=>(e.removeAttribute(t),[e]))))),this}removeClass(t){return"string"==typeof t&&(t=t.split(" ")),t?t.forEach((t=>this._((e=>(e.classList.remove(t),[e]))))):this._((t=>(t.className="",[t]))),this}show(){return this._((t=>("none"===t.style.display&&(void 0===t.style.displayCache?t.style.display="block":(t.style.display=t.style.displayCache,t.style.displayCache=void 0)),[t])))}text(t){return this.prop("innerText",t)}val(t){return this.prop("value",t)}}n.Pz.UI.$=function(t,e){return!e&&"function"==typeof $&&$.fn?(y||(console.log("Using jQuery."),y=!0),$(t)):new b(t)};let y=!1,q=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.BaseComponent{connectedCallback(){this.attached||(super.connectedCallback(),this.init())}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}init(){this.type=this.getAttribute("cq-type")||"helicopter";const{markups:t}=this.constructor;this.addDefaultMarkup(this,t[this.type])}}i.markups={helicopter:'\n\t\t<div class="stx-marker-templates" style="left: -1000px; visibility:hidden;">\n\t\t\t\x3c!-- Abstract Markers. You can remove this unless you actually need a helicopter. Seriously though, markers can be anything you want them to be! --\x3e\n\t\t\t<div class="abstract">\n\t\t\t\t<div class="stx-marker abstract">\n\t\t\t\t\t<div class="stx-marker-content">\n\t\t\t\t\t\t<div class="sample">\n\t\t\t\t\t\t\t<div stage>\n\t\t\t\t\t\t\t\t<div helicopter>\n\t\t\t\t\t\t\t\t\t<div propeller style="height: 160px;">\n\t\t\t\t\t\t\t\t\t\t<div spinner style="-webkit-transform-origin: 40px 0 0; transform-origin: 40px 0 0;">\n\t\t\t\t\t\t\t\t\t\t\t<div style="-webkit-transform: rotateY(0deg) translateX(40px); transform: rotateY(0deg) translateX(40px);"></div>\n\t\t\t\t\t\t\t\t\t\t\t<div style="-webkit-transform: rotateY(-90deg) translateX(40px); transform: rotateY(-90deg) translateX(40px);"></div>\n\t\t\t\t\t\t\t\t\t\t\t<div style="-webkit-transform: rotateY(-180deg) translateX(40px); transform: rotateY(-180deg) translateX(40px);"></div>\n\t\t\t\t\t\t\t\t\t\t\t<div style="-webkit-transform: rotateY(-270deg) translateX(40px); transform: rotateY(-270deg) translateX(40px);"></div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div heli-body></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="text">This is an example of a complex marker which can contain html, video, images, css, and animations.</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t'},e.UI.addComponentDefinition("cq-abstract-marker",i)},x=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;if(e.Marker){class t extends e.UI.ModalTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,t)}close(){this.node.css({display:"none"});var t=this;this.nameValueStore.get("cq-advertisement",(function(e,i){if(!e){var n=new Date;t.sleepAmount||(t.sleepAmount={units:1,unitType:"day"});var s=t.sleepAmount.units,o=t.sleepAmount.unitType;"minute"==o?n.setMinutes(n.getMinutes()+s):"hour"==o?n.setHours(n.getHours()+s):"day"==o?n.setDate(n.getDate()+s):"week"==o?n.setDate(n.getDate()+7*s):"month"==o&&n.setMonth(n.getMonth()+s);var a=n.getTime();i&&"object"==typeof i||(i={}),i[t.selector]=a,t.nameValueStore.set("cq-advertisement",i)}}))}makeMarker(){this.markerExists||(e.Marker({stx:this.context.stx,xPositioner:"none",label:"advertisement",permanent:!0,node:this.node[0]}),this.markerExists=!0)}setContext(t){const{config:{nameValueStore:e}}=t;this.setNameValueStore(e)}setNameValueStore(t){!t&&e.NameValueStore&&(t=e.NameValueStore),this.nameValueStore=t?new t:{get:function(){},set:function(){}}}setSleepAmount(t,e){this.sleepAmount={units:t,unitType:e}}show(t,e=!1){this.selector&&this.node.find(this.selector).removeClass("ciq-show");if(this.selector=t,!this.selector){var i=this.node.find("div:first-of-type");this.selector="."+i.attr("class")}this.ignoreSleep=e;var n=this;function s(){n.makeMarker(),n.node.css({display:"block"}),n.node.find(n.selector).addClass("ciq-show"),n.node.css({height:"0px"}),setTimeout((function(){n.node.css({height:n.node[0].scrollHeight+"px"})}),0)}e?s():this.nameValueStore.get("cq-advertisement",(function(t,e){if(!t){e&&"object"==typeof e||(e={});var i=e[n.selector];i&&i>Date.now()||s()}}))}watchForRemoteClose(t){t||(t=1e3);var e=this;setInterval((function(){"none"!=e.node.css("display")&&e.nameValueStore.get("cq-advertisement",(function(t,i){if(!t){i&&"object"==typeof i||(i={});var n=i[e.selector];n&&n>Date.now()&&e.close()}}))}),t)}}e.UI.addComponentDefinition("cq-advertisement",t)}else console.error("advertisement component requires first activating markers feature.")},C=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}open(t){this.addDefaultMarkup(),super.open(t);var i=this.context.stx,n=t.aggregationType,s={kagi:{title:"Set Reversal Percentage"},renko:{title:"Set Brick Size"},linebreak:{title:"Set Price Lines"},rangebars:{title:"Set Range"},pandf:{title:"Set Point & Figure Parameters"}};i.layout.aggregationType!=n&&i.setAggregationType(n);var o=s[n],a=this.node;for(var r in a.find(".title").text(i.translateIf(o.title)),s)a.find(".ciq"+r).css(n===r?{display:""}:{display:"none"});a.find(".ciq"+n+" input").each((function(){var t=this.name;"box"!=t&&"reversal"!=t||(t="pandf."+t);var n=e.deriveFromObjectChain(i.layout,t);n&&(n.obj[n.member]||0===n.obj[n.member])?this.value=n.obj[n.member]:i.chart.defaultChartStyleConfig[this.name]&&(this.value=i.chart.defaultChartStyleConfig[this.name])}))}}i.markup='\n\t\t<h4 class="title"></h4>\n\t\t<cq-close></cq-close>\n\t\t<div style="text-align:center;margin-top:10px;">\n\t\t\t<div class="ciqkagi">\n\t\t\t\t<em>Enter value and hit "Enter"</em>\n\t\t\t\t<p>\n\t\t\t\t\t<input name="kagi" stxtap="Layout.setAggregationEdit(\'kagi\')">\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<div class="ciqrenko">\n\t\t\t\t<em>Enter value and hit "Enter"</em>\n\t\t\t\t<p>\n\t\t\t\t\t<input name="renko" stxtap="Layout.setAggregationEdit(\'renko\')">\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<div class="ciqlinebreak">\n\t\t\t\t<em>Enter value and hit "Enter"</em>\n\t\t\t\t<p>\n\t\t\t\t\t<input name="priceLines" stxtap="Layout.setAggregationEdit(\'priceLines\')">\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<div class="ciqrangebars">\n\t\t\t\t<em>Enter value and hit "Enter"</em>\n\t\t\t\t<p>\n\t\t\t\t\t<input name="range" stxtap="Layout.setAggregationEdit(\'rangebars\')">\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<div class="ciqpandf">\n\t\t\t\t<i>Enter box size and hit "Enter"</i>\n\t\t\t\t<p>\n\t\t\t\t\t<input name="box" stxtap="Layout.setAggregationEdit(\'pandf.box\')">\n\t\t\t\t</p>\n\t\t\t\t<p>\n\t\t\t\t\t<i>Enter reversal and hit "Enter"</i>\n\t\t\t\t</p>\n\t\t\t\t<p>\n\t\t\t\t\t<input name="reversal" stxtap="Layout.setAggregationEdit(\'pandf.reversal\')">\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<p>or</p>\n\t\t\t<div class="ciq-btn" stxtap="Layout.setAggregationEdit(\'auto\')">Auto Select</div>\n\t\t</div>\n\n\t',e.UI.addComponentDefinition("cq-aggregation-dialog",i)},k=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;if(e.Marker){class t extends e.UI.ModalTag{constructor(){super(),this.messages={sources:{simulator:"Simulated data.",demo:"Demo data.",xignite:'<a target="_blank" href="https://www.xignite.com">Market Data</a> by Xignite.',fis_mm:'<a target="_blank" href="https://www.fisglobal.com/">Market Data</a> by FIS MarketMap.',Twiggs:'Twiggs MF Formula courtesy <a target="_blank" href="https://www.incrediblecharts.com/indicators/twiggs_money_flow.php">IncredibleCharts</a>.'},exchanges:{RANDOM:"Data is randomized.","REAL-TIME":"Data is real-time.",DELAYED:"Data delayed 15 min.",RATES:"Yield data latest from source, bid/ask simulated.",BATS:"BATS BZX real-time.",EOD:"End of day data."}}}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,t),this.constructor=t}insert(t,i){if(e.Marker){var n=e.UI.makeFromTemplate(this.template);return n.marker=new e.Marker({stx:t,node:n[0],xPositioner:"none",yPositioner:"none",label:"component",panelName:i,permanent:!0}),n}}setContext(t){this.addDefaultMarkup(),this.template=this.node.find("template"),this.marker=this.insert(t.stx,"chart");var e=this;this.addInjection("append","createDataSet",(function(){return e.displayAttribution(this)})),this.displayAttribution()}displayAttribution(t){t||(t=this.context.stx);var e,i,n=t.chart,s=t.layout,o=this.marker;for(var a in n.attribution&&((e=this.messages.sources[n.attribution.source])||(e=""),(i=this.messages.exchanges[n.attribution.exchange])||(i=""),e+i!=o.attr("lastAttrib")&&(o.find("cq-attrib-source").html(e),o.find("cq-attrib-quote-type").html(i),t.translateUI&&t.translateUI(o[0]),o.attr("lastAttrib",e+i))),s.studies){var r=s.studies[a],c=r.type;if(this.messages.sources[c]){if(r.attribution&&r.attribution.marker.params.panelName==r.panel)continue;e=this.messages.sources[c]||"",i=this.messages.exchanges[c]||"";var l=this.insert(t,r.panel);l.find("cq-attrib-source").html(e),l.find("cq-attrib-quote-type").html(i),t.translateUI&&t.translateUI(l[0]),r.attribution=l}}}}t.markup="\n\t\t<template>\n\t\t\t<cq-attrib-container>\n\t\t\t\t<cq-attrib-source></cq-attrib-source>&nbsp;\n\t\t\t\t<cq-attrib-quote-type></cq-attrib-quote-type>\n\t\t\t</cq-attrib-container>\n\t\t</template>\n\t",e.UI.addComponentDefinition("cq-attribution",t)}else console.error("attribution component requires first activating markers feature.")},I=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}setContext(){this.addDefaultMarkup(),this.content=this.querySelector("span")||this.firstElementChild,this.instructions=this.querySelector("p")||this.content;const{config:{hotkeyConfig:t={}}={}}=this.context;if(t.hotkeys){const e=t.hotkeys.filter((t=>t.ariaLabel));this.setHotKeyCommands(e)}}setHotKeyCommands(t){const e=document.createElement("UL");this.instructions.innerText+=" The following is a list of keyboard commands available to interact with the chart.";t.map((t=>{const{commands:e,label:i,ariaLabel:n}=t,s=[];e.forEach((t=>s.push(t.split("+").map((t=>t.replace("Key",""))).join(" + "))));return`${i}. ${n}. Hotkeys press ${s.length>1?s.join(" or "):s[0]}. `})).forEach((t=>{const i=document.createElement("LI");i.innerText=t,e.append(i)})),this.content.append(e)}}i.markup="\n<span>\n\t<p>ChartIQ interactive chart component. Instructions for use with screen readers.</p>\n</span>\n",e.UI.addComponentDefinition("cq-chart-instructions",i)},w=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}setContext(){this.contextSet||(this.contextSet=!0,this.addDefaultMarkup())}}i.markup='\n\t\t<cq-study-legend cq-signal-studies-only cq-marker-label="Signals" cq-marker cq-hovershow>\n\t\t\t\t<template cq-study-legend>\n\t\t\t\t\t<cq-item>\n\t\t\t\t\t\t<cq-label class="click-to-edit"></cq-label>\n\t\t\t\t\t</cq-item>\n\t\t\t\t</template>\n\t\t</cq-study-legend>\n\t\t<cq-study-legend cq-chart-legend cq-marker-label="Plots" cq-clone-to-panels="Plots" cq-panel-only cq-marker cq-hovershow cq-content-keys="cq-label,cq-comparison-label">\n\t\t\t<cq-comparison>\n\t\t\t\t<cq-comparison-key cq-panel-only cq-all-series>\n\t\t\t\t\t<template cq-comparison-item>\n\t\t\t\t\t\t<cq-comparison-item>\n\t\t\t\t\t\t\t<span class="ciq-switch" keyboard-selectable-child></span>\n\t\t\t\t\t\t\t<cq-swatch cq-overrides="auto"></cq-swatch>\n\t\t\t\t\t\t\t<div class="stx-btn-ico ciq-close" keyboard-selectable-child="true"></div>\n\t\t\t\t\t\t\t<cq-comparison-label>AAPL</cq-comparison-label>\n\t\t\t\t\t\t\t\x3c!-- cq-comparison-price displays the current price with color animation --\x3e\n\t\t\t\t\t\t\t<cq-comparison-price cq-animate></cq-comparison-price>\n\t\t\t\t\t\t\t\x3c!-- cq-comparison-tick-price displays the price for the active crosshair item --\x3e\n\t\t\t\t\t\t\t\x3c!-- <cq-comparison-tick-price></cq-comparison-tick-price>\t--\x3e\n\t\t\t\t\t\t\t<cq-comparison-loader></cq-comparison-loader>\n\t\t\t\t\t\t</cq-comparison-item>\n\t\t\t\t\t</template>\n\t\t\t\t</cq-comparison-key>\n\t\t\t</cq-comparison>\n\t\t\t<template cq-study-legend>\n\t\t\t\t<cq-item>\n\t\t\t\t\t<div class="ciq-icon ciq-close"></div>\n\t\t\t\t\t<cq-label></cq-label>\n\t\t\t\t</cq-item>\n\t\t\t</template>\n\t\t</cq-study-legend>\n\t',e.UI.addComponentDefinition("cq-chart-legend",i)},S=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ModalTag{get displayExchange(){return this.getAttribute("display-exchange")}constructor(){super(),this.previousClose=null}begin(){const t=this;this.addInjection("append","createDataSet",(function(){t.update()})),this.update()}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}disconnectedCallback(){this.context&&e.UI.unobserveProperty("symbolObject",this.context.stx.chart,this.listener),super.disconnectedCallback()}initialize(t){this.params=t||{},void 0===this.params.autoStart&&(this.params.autoStart=!0),this.marker=null,this.params.autoStart&&this.begin()}setContext(t){if(this.listener)return;var i=this,n=this.context.stx;let{markup:s}=this.constructor;this.hasAttribute("cq-activate-symbol-search-on-click")||(s=s.replace('<cq-clickable role="button" cq-selector="cq-lookup-dialog" cq-method="open">',"").replace("</cq-clickable>","")),this.addDefaultMarkup(this,s),this.symbolDiv=this.querySelector("cq-symbol"),this.symbolDescriptionDiv=this.querySelector("cq-symbol-description"),this.currentPriceDiv=this.querySelector("cq-current-price"),this.todaysChangeDiv=this.querySelector("cq-todays-change"),this.todaysChangePctDiv=this.querySelector("cq-todays-change-pct"),this.chartPriceDiv=this.querySelector("cq-chart-price"),this.changeDiv=this.querySelector("cq-change"),this.exchangeDiv=this.querySelector(".exchange"),this.listener=function(t){const{exchangeDiv:e}=i;if(i.mostRecentClose=n.mostRecentClose("iqPrevClose"),e){const{value:{exchDisp:n}}=t;i.displayExchange&&n?e.innerText=`Exchange: ${n}`:t.value.static?e.innerText="STATIC":e.innerText=""}},e.UI.observeProperty("symbolObject",n.chart,this.listener),this.initialize()}update(){const{stx:t}=this.context,{chart:{symbol:i,symbolDisplay:n},internationalizer:s}=t,{symbolDiv:o,symbolDescriptionDiv:a,exchangeDiv:r,currentPriceDiv:c,changeDiv:l,chartPriceDiv:h,todaysChangeDiv:d,todaysChangePctDiv:u}=this;var p=-1==["false","0",null].indexOf(this.getAttribute("cq-browser-tab")),m=this.closest("cq-context-wrapper");!m||m&&m.classList.contains("active")||(p=!1);const g=h&&c;let f=!1,v=!1,b=i?"add":"remove";if(this.classList[b]("stx-show"),o.innerText!==i&&(o.innerText=i,v=!0),a&&a.innerText!==(n||i)&&(a.innerText=n||i),t.isHistoricalModeSet)return""!==c.innerText&&(c.innerText=""),void(l.style.display="none");let y="",q=0,x="";const C=t.getFirstLastDataRecord(t.chart.dataSet,"Close",!0);let k="",I="";if(C&&(k=C.Close),g){""!==k&&(I=t.formatYAxisPrice(k,t.chart.panel,t.chart.decimalPlaces));let i=parseFloat(c.innerText);if(c.innerText!==I){c.innerText=I,f=!0;var w=this.currentPriceDiv.getAttribute("cq-animate");void 0!==w&&e.UI.animatePrice(c,k,i,"fade"==w)}}if((g||p)&&i&&(v||f)){let n=this.previousClose;n||0===n||(n=C&&C.iqPrevClose),n||0===n||(n=this.mostRecentClose),l&&(k||0===k)?(y=e.fixPrice(k-n),q=y/n*100,x=n<=0||k<0?"N/A":s?s.percent2.format(q/100):q.toFixed(2)+"%",l.style.display=""):l&&(l.style.display="none");const o=Math.abs(y),a=t.formatYAxisPrice(o,t.chart.panel,t.chart.decimalPlaces);o&&d.innerText!==a&&(d.innerText=a),u&&u.innerText!==x&&(u.innerText=x),""!==x&&y<0?h.classList.add("stx-down"):h.classList.remove("stx-down"),""!==x&&y>0?h.classList.add("stx-up"):h.classList.remove("stx-up"),k=void 0!==k?k:"",y=void 0!==y?y:"",this.title=i+" ​ ​ "+I+" ​ ​ ​ ",y>0?this.title+="▲ "+a:y<0&&(this.title+="▼ "+a),p&&(this.ownerDocument.title=this.title)}}}i.markup='\n\t\t<cq-clickable role="button" cq-selector="cq-lookup-dialog" cq-method="open" title="Symbol Search">\n\t\t\t<cq-symbol class="hide-outline"></cq-symbol>\n\t\t</cq-clickable>\n\t\t<cq-menu class="ciq-menu ciq-period" title="Interval Selector">\n\t\t\t<span><cq-clickable stxbind="Layout.periodicity">1D</cq-clickable></span>\n\t\t\t<cq-menu-dropdown cq-lift>\n\t\t\t\t<cq-menu-container cq-name="menuPeriodicity"></cq-menu-container>\n\t\t\t</cq-menu-dropdown>\n\t\t</cq-menu>\n\t\t<cq-chart-price>\n\t\t\t<cq-current-price cq-animate></cq-current-price>\n\t\t\t<cq-change>\n\t\t\t\t<div class="ico"></div>\n\t\t\t\t<cq-todays-change></cq-todays-change>\n\t\t\t\t<cq-todays-change-pct></cq-todays-change-pct>\n\t\t\t</cq-change>\n\t\t</cq-chart-price>\n\t\t<div class="exchange"></div>\n\t',e.UI.addComponentDefinition("cq-chart-title",i)},E=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ModalTag{connectedCallback(){this.attached||super.connectedCallback()}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}setContext(t){this.addDefaultMarkup();var i=this.node;i[0].addEventListener("touchstart",(function(t){t.stopPropagation()}),{passive:!1}),i[0].addEventListener("mousedown",(function(t){t.stopPropagation()}));var n=i.find("input");e.UI.stxtap(n[0],(function(){this.focus()}))}}i.markup='\n\t\t<cq-clickable role="button" class="symbol-search" cq-selector="cq-lookup-dialog" cq-method="open">\n\t\t\t<span class="ciq-lookup-icon"></span>\n\t\t\t<cq-tooltip>Symbol Search</cq-tooltip>\n\t\t</cq-clickable>\n\t\t<cq-clickable role="button" class="symbol-search" cq-selector="cq-lookup-dialog" cq-method="open" comparison="true">\n\t\t\t<span class="ciq-comparison-icon"></span>\n\t\t\t<cq-tooltip>Add Comparison</cq-tooltip>\n\t\t</cq-clickable>\n\t\t<cq-toggle class="ciq-draw" cq-member="drawing"><span></span><cq-tooltip>Draw</cq-tooltip></cq-toggle>\n\t\t<cq-toggle class="ciq-CH" cq-member="crosshair"><span></span><cq-tooltip>Crosshair</cq-tooltip></cq-toggle>\n\t\t<cq-toggle class="ciq-DT" cq-member="tableView"><span></span><cq-tooltip>Table View</cq-tooltip></cq-toggle>\n\t\t<cq-menu class="ciq-menu ciq-period">\n\t\t\t<span><cq-clickable stxbind="Layout.periodicity">1D</cq-clickable></span>\n\t\t\t<cq-menu-dropdown>\n\t\t\t\t<cq-menu-container cq-name="menuPeriodicity"></cq-menu-container>\n\t\t\t</cq-menu-dropdown>\n\t\t</cq-menu>\n\t',e.UI.addComponentDefinition("cq-chartcontrol-group",i)},T=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{connectedCallback(){if(!this.attached){super.connectedCallback();var t=this;e.UI.stxtap(this,(function(e){this.closest("cq-menu")||(this.uiManager.closeMenu(),e.stopPropagation()),t.runMethod()}))}}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}runMethod(){const{context:t}=this,e=this.getAttribute("cq-selector"),i=this.getAttribute("cq-method");if(/-dialog/.test(e)&&"open"===i&&t.config){const i=(t.config.channels||{}).dialog||"channel.dialog";this.channelWrite(i,{type:e.replace(/cq-|-dialog/g,""),params:{context:t,caller:this}},t.stx)}else{var n=this;this.ownerDocument.querySelectorAll(e).forEach((function(t){t[i]&&t[i].call(t,{context:n.context,caller:n})}))}}}e.UI.addComponentDefinition("cq-clickable",i)},U=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.BaseComponent{connectedCallback(){if(!this.attached){var t=this;e.UI.stxtap(this,(function(e){t.tap(),e.stopPropagation()})),super.connectedCallback()}}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}tap(){e.UI.containerExecute(this,"close")}}e.UI.addComponentDefinition("cq-close",i)},P=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ModalTag{constructor(){super(),this.swatchColors=[],this.loading=[]}connectedCallback(){this.attached||(super.connectedCallback(),this.swatchColors=["#8ec648","#00afed","#ee652e","#912a8e","#fff126","#e9088c","#ea1d2c","#00a553","#00a99c","#0056a4","#f4932f","#0073ba","#66308f","#323390"])}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}disconnectedCallback(){this.removeClaim(this),super.disconnectedCallback()}configureUI(){const t=this.node,i=t.find("cq-accept-btn");this.template=t.find("*[cq-comparison-item]");const n=t.find("cq-swatch").attr("cq-colors");n&&(this.swatchColors=n.split(",")),this.swatchColors=e.convertToNativeColor(this.swatchColors);const s=t.find("cq-lookup");s.length&&s[0].setCallback(function(t){return function(){t.selectItem.apply(t,arguments)}}(this)),e.UI.stxtap(i[0],(function(t){s[0].forceInput(),t.stopPropagation()})),this.addClaim(this);const o=this.ownerDocument.body.keystrokeHub;if(!o)return;let a=this.querySelector("cq-menu.cq-comparison-new");if(a){let t=a.hide.bind(a);a.hide=()=>{o.removeActiveModal(this),o.tabOrderSelect(),t()}}e.UI.stxtap(this,(function(t){this.keyboardNavigation&&(a&&a.open(),o.addActiveModal(this)),t.stopPropagation()}))}keyStroke(t,e,i){if(!this.keyboardNavigation)return;const n=this.querySelectorAll("cq-lookup, cq-swatch, cq-accept-btn, [keyboard-selectable='true']");if(!n.length)return;const s=this.findFocused(n);switch(e){case"Enter":if(!s[0])return;this.clickItem(s[0],i,this);break;case"Tab":s[0]&&"CQ-LOOKUP"==s[0].tagName&&(this.keyboardNavigation.disableKeyControlElement(s[0],!0),t.tabActiveElement.element.blur(),s[0].overrideIsActive=!0);let e=this.focusNextItem(n,!1,!0);"CQ-LOOKUP"==e.tagName&&(e.keyboardNavigation=this.keyboardNavigation,e.onKeyboardSelection&&e.onKeyboardSelection(),e.overrideIsActive=!1);break;case"Esc":case"Escape":this.removeFocused(n);let o=this.querySelector("cq-menu.cq-comparison-new");o&&o.hide();break;default:i.preventDefault()}}onKeyboardSelection(){let t=this.querySelector("cq-lookup");t.setAttribute("cq-focused","true"),t.overrideIsActive=!1,t.keyboardNavigation=this.keyboardNavigation,t.onKeyboardSelection&&t.onKeyboardSelection()}pickSwatchColor(){e.UI.pickSwatchColor(this,this.querySelector("cq-swatch"))}position(){var t=this.context.stx,e=t.barFromPixel(t.cx);this.tick=t.tickFromPixel(t.cx);var i=t.chart.xaxis[e],n=this;if(this.tick!=this.prevTick){this.timeout&&clearTimeout(this.timeout);this.timeout=setTimeout((function(){var e;for(var s in n.timeout=null,t.chart.series){e||(e=n.node.find("cq-comparison-key"));var o=e.find('cq-comparison-item[cq-symbol="'+s+'"] cq-comparison-tick-price');if(""!==o.text()&&o.text(""),o.length&&i&&i.data){var a=t.chart.series[s].parameters.symbol,r=t.padOutPrice(i.data[a]);o.text()!==r&&o.text(r);var c=i.data[a];null!==c&&("object"==typeof c&&(c=c.Close),r=t.padOutPrice(c),o.text()!==r&&o.text(r))}}}),0)}this.prevTick=this.tick}removeSeries(t,e){this.context.stx.removeSeries(t)}renderLegend(){function t(t,e,i){return function(){t.nomore=!0,i.parameters.permanent||t.removeSeries(e,i),t.modalEnd()}}this.pickSwatchColor();var i=this.closest(".stx-holder"),n=e.cqvirtual(this.querySelector("cq-comparison-key"));if(n){var s=function(t){n.appendChild(t)},o=this.context.stx;o.getDefaultColor();var a=n.hasAttribute("cq-panel-only"),r=!n.hasAttribute("cq-all-series");for(var c in o.chart.seriesRenderers){var l=o.chart.seriesRenderers[c];if(l!=o.mainSeriesRenderer&&((!r||l.params.isComparison)&&(!a||i&&l.params.panel==i.panel.name)))for(var h=0;h<l.seriesParams.length;h++){var d=l.seriesParams[h],u=e.UI.makeFromTemplate(this.template),p=u.find(".ciq-switch"),m=u.find("cq-comparison-swatch"),g=u.find("cq-swatch"),f=u.find("cq-comparison-label"),v=u.find("cq-comparison-description"),b=u.find("cq-comparison-loader"),y=u.find(".ciq-close"),q=o.chart.series[d.id],x=q.parameters,C=x.color||l.colors[q.id].color,k="auto"==C;k&&(C=o.defaultColor),m.css({background:C}),g.length&&(g[0].seriesId=d.id,g[0].setColor(C,!1,k)),x.opacity&&(m.css({opacity:x.opacity}),g.css({opacity:x.opacity})),f.text(o.translateIf(q.display)),v.text(o.translateIf(q.description)),u.attr("cq-symbol",q.id);var I=x.symbol,w=o.mostRecentClose(I);if(w||0===w){var S=u.find("cq-comparison-price");S.length&&S.text(o.padOutPrice(w))}this.loading[x.symbolObject.symbol]?b.addClass("stx-show"):b.removeClass("stx-show"),x.error&&u.attr("cq-error",!0),!x.color||x.permanent?y.hide():e.UI.stxtap(y[0],t(this,q.id,q)),Array.from(u).forEach(s),p[0].parentElement.classList[x.disabled?"remove":"add"]("ciq-active"),e.safeClickTouch(p[0],E(q,o))}}e.climbUpDomTree(e.cqrender(n),"cq-study-legend").forEach((function(t){t.displayLegendTitle&&t.displayLegendTitle()}))}function E(t,e){return i=>{var n=t.parameters;n.disabled=!n.disabled,e.changeOccurred("layout"),i.target.parentElement.classList[n.disabled?"add":"remove"]("ciq-active")}}}setColor(t,e){e.seriesId&&this.context.stx.modifySeries(e.seriesId,{color:t})}startPriceTracker(t){var e=this;this.addInjection("append","createDataSet",(function(){t&&e.updatePrices(),this.chart.dataSet&&this.chart.dataSet.length?"true"!==e.node.attr("cq-show")&&e.node.attr("cq-show","true"):e.hasAttribute("cq-show")&&e.removeAttribute("cq-show")}))}startTickPriceTracker(){this.prevTick=null,this.addInjection("prepend","headsUpHR",function(t){return function(){t.position()}}(this))}selectItem(t){var e=this.context,i=this;var n=this.node.find("cq-swatch"),s="auto",o=null,a=1;if(n[0]){var r=n[0].style;s=r.backgroundColor,o=r.borderTopStyle,a=r.width||1}var c=e.stx;this.loading[t.symbol]=!0;for(var l={name:"comparison "+t.symbol,symbolObject:t,isComparison:!0,color:s,pattern:o,width:a||1,data:{useDefaultQuoteFeed:!0},forceData:!0},h=c.getSeries({symbolObject:t}),d=0;d<h.length;d++)if(h[d].parameters.isComparison)return void(this.loading[t.symbol]=!1);t.symbol&&t.symbol.trim().length>0&&(!e.stx.chart.symbol||e.stx.chart.symbol.toLowerCase()!==t.symbol.toLowerCase())?c.addSeries(t.symbol,l,(function(t,e){t&&(e.parameters.error=!0),i.loading[e.parameters.symbolObject.symbol]=!1,i.renderLegend()})):this.loading[t.symbol]=!1}setContext(t){this.node.attr("cq-show","true"),this.configureUI();var i=this,n=this.context.stx;n.chart;function s(t){i.renderLegend()}if(["layout","symbolImport","symbolChange","theme"].forEach((function(t){n.addEventListener(t,s)})),this.addInjection("append","modifySeries",(function(){i.renderLegend()})),this.renderLegend(),this.template.length){var o=e.UI.makeFromTemplate(this.template);this.startPriceTracker(o.find("cq-comparison-price").length),o.find("cq-comparison-tick-price")&&this.startTickPriceTracker()}}updatePrices(){var t,i=this.context.stx,n=i.isHistoricalModeSet,s=e.ChartEngine.isDailyInterval(i.layout.interval);for(var o in i.chart.series){t||(t=this.node.find("cq-comparison-key"));var a=t.find('cq-comparison-item[cq-symbol="'+o+'"] cq-comparison-price');if(a.length){i.chart.series[o].parameters.symbol;var r=i.chart.series[o].lastQuote;if(!r||!r.DT||!r.Close&&0!==r.Close)continue;if(!s&&i.chart.market&&null===i.chart.market.getSession(r.DT))continue;var c=r.Close,l=i.chart.series[o].parameters.subField||"Close",h=parseFloat(a.text());c&&(c[l]||0===c[l])&&(c=c[l]),!c&&0!==c&&i.chart.series[o].lastQuote&&(c=i.chart.series[o].lastQuote[l]);var d=i.padOutPrice(n?"":c);if(a.text()!==d&&a.text(d),n)return;void 0!==a.attr("cq-animate")&&e.UI.animatePrice(a,c,h)}}}}e.UI.addComponentDefinition("cq-comparison",i)},z=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}setContext(){this.contextSet||(this.contextSet=!0,this.addDefaultMarkup())}}i.markup='\n\t\t<cq-comparison cq-marker>\n\t\t\t<cq-menu class="cq-comparison-new" cq-focus="input">\n\t\t\t\t<cq-comparison-add-label class="ciq-no-share">\n\t\t\t\t\t<cq-comparison-plus></cq-comparison-plus><span>Compare</span><span>...</span>\n\t\t\t\t</cq-comparison-add-label>\n\t\t\t\t<cq-comparison-add>\n\t\t\t\t\t<cq-comparison-lookup-frame>\n\t\t\t\t\t\t<cq-lookup cq-keystroke-claim cq-uppercase></cq-lookup>\n\t\t\t\t\t</cq-comparison-lookup-frame>\n\t\t\t\t\t<cq-swatch cq-no-close></cq-swatch>\n\t\t\t\t\t<span><cq-accept-btn class="stx-btn">ADD</cq-accept-btn></span>\n\t\t\t\t</cq-comparison-add>\n\t\t\t</cq-menu>\n\t\t</cq-comparison>\n\t',e.UI.addComponentDefinition("cq-comparison-lookup",i)},L=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{get active(){return this.context.stx.currentVectorParameters["active"+this._scope]}set active(t){this.context.stx.currentVectorParameters["active"+this._scope]=t}get color(){return this.context.stx.currentVectorParameters["color"+this._scope]}set color(t){this.context.stx.currentVectorParameters["color"+this._scope]=t}get lineWidth(){return this.context.stx.currentVectorParameters["lineWidth"+this._scope]}set lineWidth(t){this.context.stx.currentVectorParameters["lineWidth"+this._scope]=t}get pattern(){return this.context.stx.currentVectorParameters["pattern"+this._scope]}set pattern(t){this.context.stx.currentVectorParameters["pattern"+this._scope]=t}connectedCallback(){if(!this.attached){Object.defineProperty(this,"_scope",{configurable:!0,enumerable:!1,value:this.getAttribute("cq-cvp-header")||"",writable:!1});var t=this.ownerDocument.querySelector('template[cq-cvp-controller], template[cvp-controller="true"]');if(0===this.children.length&&t){e.UI.makeFromTemplate(t,this);var i=this.querySelector(".ciq-heading");i&&(i.innerHTML=this._scope)}super.connectedCallback()}}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}emit(t,e){this.toolbar?this.toolbar.emit():this.dispatchEvent(new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:e}))}getColor(t){var i=e.UI.$(t.node||this.node.find("cq-line-color")),n=this.color;"transparent"!=n&&"auto"!=n||(n=""),i.css({background:n});var s=e.getBackgroundColor(this.parentNode);if(!n||Math.abs(e.hsl(s)[2]-e.hsl(n)[2])<.2){var o=e.chooseForegroundColor(s);i.css({border:"solid "+o+" 1px"}),n||i.css({background:"linear-gradient(to bottom right, "+o+","+o+" 49%, "+s+" 50%, "+s+")"})}else i.css({border:""})}pickColor(t){var i=e.UI.$(t.node),n=this.ownerDocument.querySelector("cq-color-picker"),s=this,o=i.attr("cq-overrides");if(!n)return console.error("CVPController.prototype.pickColor: no <cq-color-picker> available");o&&(t.overrides=o.split(",")),n.callback=function(e){s.color=e,s.getColor(t),s.emit("change",{color:e})},t.context=this.context,n.display(t)}setContext(){this.setStyle(),this.toolbar&&this.toolbar.dirty(!1)}setStyle(t,e,i){e=e||"1",i=i||"dotted",this.lineWidth=parseInt(e,10),this.pattern=i;var n=this.node.find("*[cq-cvp-line-style]");this.lineStyleClassName&&n.removeClass(this.lineStyleClassName),i&&"none"!==i?(this.lineStyleClassName="ciq-"+i+"-"+this.lineWidth,n.addClass(this.lineStyleClassName)):this.lineStyleClassName=null,this.emit("change",{lineWidth:e,pattern:i})}sync(t){var e=t["active"+this._scope],i=t["color"+this._scope],n=t["lineWidth"+this._scope],s=t["pattern"+this._scope],o="ciq-active",a=this.node.find(".ciq-checkbox");e?a.addClass(o):a.removeClass(o),this.active=!!e,this.color=i||"",this.getColor({}),this.setStyle(null,n,s)}toggleActive(t){var i=e.UI.$(t.node),n="ciq-active";this.active?(this.active=!1,i.removeClass(n)):(this.active=!0,i.addClass(n)),this.emit("change",{active:this.active})}}e.UI.addComponentDefinition("cq-cvp-controller",i)},A=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.DialogContentTag{constructor(){super(),this.fileMap=new Map,this.swatchColors=e.UI.defaultSwatchColors}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}abortImport(t){const i="CQ-CLOSE"===t.target.nodeName,n=[...this.fileMap.keys()],s=t=>e=>e.name===t;for(let e of this.form.querySelectorAll("fieldset[name]")){let o=e.getAttribute("fields");if(t&&t.target.getAttribute("fields")!==o&&!i)continue;let a=n.findIndex(s(o));this.form.removeChild(e.parentElement),this.fileMap.delete(n[a])}i&&(this.fileInput.value=""),this.fileMap.size||(this.fileInput.value="",this.loadDataBtn.style.display="inline-block",this.importBtn.style.display="none",this.querySelector("cq-section.loader").style.display="flex",this.warn("","",!0),e.UI.containerExecute(this,"resize")),this.resetTabSelect()}close(){this.abortImport({target:this.querySelector("cq-close")}),this.channelWrite("channel.dataLoader",!1,this.context.stx),this.loadDataBtn.style.display=this.fileInput.value?"none":"inline",this.querySelector("cq-section.loader").style.display="flex",this.warn("","",!0),super.close()}getFormData(){const t=(t,e)=>i=>{const n=t.elements[i];let s;if(n)s="checkbox"===n.type?n.checked:n.value;else{const e=t.querySelector(`[name='${i}']`);e&&(s=e.value)}e.formData.append(i,s)};for(let e of this.fileMap){const[i,n]=e;let s=this.querySelector(`[name='${i.name}'] fieldset`);n.formData=new FormData,["name","display","periodicity","panel","color"].forEach(t(s,n))}}hide(){this.channelWrite("channel.dataLoader",!1,this.context.stx)}importData(t){t.preventDefault();const{dialog:e}=this;if(!e.validate()())return;let{context:{stx:i},fileMap:n}=e;e.getFormData(),n.forEach((t=>{i.dataLoader.importData(t)})),e.close()}async loadData(){if(this.validateFileInput()(),!this.warning.getAttribute("cq-active")){for(const t of this.fileInput.files){let i=new e.CSVReader(t);this.fileMap.set(t,i),await i.parse(t)}this.loadDataBtn.style.display="none",this.querySelector("cq-section.loader").style.display="none",this.showData()}}resetTabSelect(){const{uiManager:{keystrokeHub:t}}=this.context;t.highlightAlign()}showData(){const{context:{stx:t,config:i={}},keystrokeHub:n}=this,s=t=>i=>{i.setAttribute("fields",t),i.addEventListener("pointerup",(t=>{t.preventDefault(),e.UI.containerExecute(i,"abortImport",[t])}))};let o=!1,a=this.querySelector("template");for(const r of this.fileMap){const[c,l]=r,h=c.name,d=a.content.cloneNode(!0);d.firstElementChild.id+=`${h}`,d.firstElementChild.setAttribute("name",h);const u=d.querySelector("fieldset");u&&(u.setAttribute("fields",h),u.setAttribute("name","fields"));d.querySelector("legend.file-name").innerText=`File: ${h}`;const p=d.querySelector(".data-name input");p.setAttribute("placeholder",h),p.value=h;const m=d.querySelector(".ciq-select[name='periodicity']"),g=i.menuPeriodicity?i.menuPeriodicity:function(){const e=t.getPeriodicity();return[{value:e,label:`${e.period}, ${e.timeUnit}`}]}();g.filter((t=>t.label)).forEach((t=>{const e=document.createElement("option");e.value=e.innerText=t.label,e.value=JSON.stringify(t.value),m.append(e)}));const f=d.querySelector(".data-fields ul");let{fields:v=[]}=l;v.forEach((t=>{const e=document.createElement("li");e.innerText=t,f.append(e)}));const b=d.querySelector("[name=display]"),y=d.querySelector(".secondary-options");o?(b.value="secondary",y.style.display="block"):o=!0,b.addEventListener("change",(function(t){let e="secondary"===this.value.toLowerCase();y.style.display=e?"block":"none",n.highlightAlign()})),d.querySelectorAll(".abort").forEach(s(h)),e.UI.pickSwatchColor(this,d.querySelector("cq-swatch")),this.form.append(d),this.form.querySelectorAll("input:not([type=submit]").forEach((t=>{t.addEventListener("keypress",(t=>{"Enter"===t.key&&t.preventDefault()}))}))}this.importBtn.style.display="inline",e.UI.containerExecute(this,"resize"),this.resetTabSelect()}setContext(t){this.context=t,this.addDefaultMarkup(),this.form=this.querySelector("form"),this.fileInput=this.querySelector("input[type=file]"),this.loadDataBtn=this.querySelector("button.load"),this.importBtn=this.querySelector("button.import"),this.controls=this.querySelector("div.ciq-dialog-cntrls"),this.warning=this.querySelector(".invalid-warning"),this.warningTitle=this.warning.querySelector(".invalid-warning-title"),this.warningText=this.warning.querySelector(".invalid-warning-text"),this.form.dialog=this,this.form.addEventListener("submit",this.importData),this.form.addEventListener("change",this.validate()),this.fileInput.addEventListener("change",this.validateFileInput()),this.keystrokeHub=t.uiManager.keystrokeHub}validate(){const t=this;return function(i){let n;t.getFormData();let s=!0;for(const i of t.fileMap){const[,a]=i,{formData:r,fields:c}=a,l=r.get("display"),h=r.get("periodicity");if(!((c.includes("DT")||c.includes("Date"))&&c.some((t=>"Close"===t||"Value"===t))))return s=!1,o({messageTitle:"Invalid Data fields",messageText:'Your data contains invalid schema to display. It must include a "DT" column and either a "Close" or "Value" column.'},s);if("secondary"===l){if(!e.equals(JSON.parse(h),t.context.stx.getPeriodicity()))return s=!1,o({messageTitle:"Mis-matched periodicities:",messageText:"Having mixed periodicities can result in chart displaying incorrect time scales. Check your data and try again."},s)}else{if(n)return s=!1,o({messageTitle:"Multiple Main series",messageText:"Detected multiple data files set to display main data. Only one data file can be main."},s);n=!0}}return o({messageTitle:"",messageText:""},s);function o({messageTitle:e,messageText:i},n){return t.warn(e,i,n),t.resetTabSelect(),n}}}validateFileInput(){const t=this;return function(e){const n=t.files||t.fileInput.files;let s=!0,o="",a="";Object.values(n).forEach((function(t){const{name:e}=t,n=e.lastIndexOf(".")>0&&e.slice(e.lastIndexOf("."),e.length);(n&&".csv"!==n||-1==i.mimeTypes.indexOf(t.type))&&(o="Invalid File Type",a="Data Importer requires a text/csv file to work. Please select a CSV file.",s=!1)})),n.length||(o="Please select a file!",a="Data Importer requires a text/csv file to work. Please select a CSV file.",s=!1),t.warn(o,a,s),t.resetTabSelect()}}warn(t,e,i){this.warningTitle.innerText=t,this.warningText.innerText=e,i?this.warning.removeAttribute("cq-active"):this.warning.setAttribute("cq-active",!0)}}i.mimeTypes=["text/csv","application/csv","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"],i.markup='\n<h4 class="title">Import Data</h4>\n<cq-close></cq-close>\n<cq-scroll cq-no-maximize>\n\t<cq-section class="loader">\n\t\t<label for="fileSelector">Choose one or more CSV files to load data into the chart:</label>\n\t\t<input name="fileSelector" type="file" multiple accept=".csv" />\n\t</cq-section>\n\t<cq-section class="ciq-dialog-cntrls">\n\t\t<button class="ciq-btn load" stxtap="loadData()">Open Files</button>\n\t</cq-section>\n\t<cq-section>\n\t\t<form class="import-data" id="data-wizard"></form>\n\t</cq-section>\n\t<template class="table">\n\t\t<cq-section class="data-table">\n\t\t\t<fieldset form="data-wizard" name="file-fields">\n\t\t\t<legend class="file-name"></legend>\n\t\t\t<div class="data-name"><label for="name">Name for imported data:</label><input type="text" name="name" required /></div>\n\t\t\t<div class="data-periodicity">\n\t\t\t\t<label for="periodicity">Data Periodicity:</label>\n\t\t\t\t<span class="select-holder">\n\t\t\t\t\t<select name="periodicity" class="ciq-select" form="data-wizard" required>\n\t\t\t\t</span>\n\t\t\t\t</select>\n\t\t\t</div>\n\t\t\t<div class="data-fields">\n\t\t\t\t<label>Data Fields:</label>\n\t\t\t\t<ul class="content-justify-end"></ul>\n\t\t\t</div>\n\t\t\t<div class="data-display">\n\t\t\t\t<label>Display As:</label>\n\t\t\t\t<span class="select-holder">\n\t\t\t\t\t<select name="display" form="data-wizard" class="ciq-select" required>\n\t\t\t\t\t<option value="main">Main Series</option>\n\t\t\t\t\t<option value="secondary">Secondary Series</option>\n\t\t\t\t\t</select>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class="content-justify-end">\n\t\t\t\t<fieldset class="secondary-options">\n\t\t\t\t<legend>Secondary Series Options:</legend>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label>Add in new panel: </label><input type="checkbox" name="panel" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<label>Color: </label><cq-swatch name="color"></cq-swatch>\n\t\t\t\t\t</div>\n\t\t\t\t</fieldset>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="buttons">\n\t\t\t<button class="ciq-btn-negative abort">Remove</button>\n\t\t</div>\n\t\t</fieldset>\n\t\t</cq-section>\n\t</template>\n\t<cq-section>\n\t\t<div class="invalid-warning">\n\t\t\t<div class="invalid-warning-title"></div>\n\t\t\t<div class="invalid-warning-text"></div>\n\t\t</div>\n\t</cq-section>\n\t<cq-section class="ciq-dialog-cntrls">\n\t\t<button class="ciq-btn import" form="data-wizard" type="submit">Confirm</button>\n\t</cq-section>\n\n</cq-scroll>\n',e.UI.addComponentDefinition("cq-data-dialog",i)},D=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.BaseComponent{constructor(){super(),this.activeAttributes={}}connectedCallback(){if(!this.attached){this.isDialog=!0,super.connectedCallback();var t=this;e.UI.stxtap(this,(function(e){t.tap(e)}));var i=e.UI.getUIManager(this);i.registerForResize(this),this.uiManager=i,this.hasAttribute("cq-no-claim")||this.addClaim(this),this.hasAttribute("tabindex")||this.setAttribute("tabindex","0")}}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}disconnectedCallback(){this.removeClaim(this),this.uiManager.unregisterForResize(this),super.disconnectedCallback()}refreshFocus(){const t=this.getKeyboardSelectableItems();let e=this.findFocused(t)[0];e||(e=Array.from(t||[]).find((t=>t.matches("[name="+this.activeElementName+"]")))),e&&this.focusItem(e)}getKeyboardSelectableItems(){return this.querySelectorAll("[keyboard-selectable='true'], input, .ciq-select, cq-swatch, .ciq-btn, .ciq-btn-negative, cq-scroll li, ul cq-item")}keyStroke(t,e,i){if(t.tabActiveModals[0]!==this)return;let{shiftKey:n}=i||{};const s=this.hasAttribute("native-tabbing"),o=this.getKeyboardSelectableItems();if("Tab"!==e||s){if("Enter"==e){const t=this.findFocused(o)[0];t&&(this.clickItem(t,i,this),"function"==typeof t.click&&t.click())}}else{const e=this.focusNextItem(o,n,!0),i=this.querySelector("cq-scroll");e&&i&&(i.scrollToElement(e),setTimeout((()=>t.highlightAlign())))}}onKeyboardSelection(){this.keyboardNavigation.highlightHide()}onKeyboardDeselection(){this.keyboardNavigation&&null!==this.keyboardNavigation&&this.keyboardNavigation.highlightAlign()}clickItem(t,e,i){if(t&&this.keyboardNavigation){const e=t.querySelector("cq-menu-dropdown");e&&(e.keyboardOriginationElement=i,this.keyboardNavigation.setKeyControlElement(e))}super.clickItem(t,e,this)}processEsc(t){return!!this.closeActiveMenu()&&(t.tabActiveModals[0]&&t.setKeyControlElement(t.tabActiveModals[0]),!0)}closeActiveMenu(){const t=this.querySelector("*.stxMenuActive");if(t){const i=e.UI.getUIManager(this);return i&&i.closeMenu(t),!0}return!1}addActiveAttribute(t){this.activeAttributes[t]=!0}center(){}close(){this.uiManager.closeMenu(this),this.onClose&&this.onClose(),this.parentElement.removeAttribute("cq-active")}hide(){if(this.node.find(":invalid").length)return;for(var t in this.node.children().each((function(){"function"==typeof this.hide&&this.hide()})),this.active=!1,this.opener&&(delete this.opener.keepOpen,delete this.opener),this.uiManager.overlay&&this.uiManager.overlay.hasAttribute("cq-active")&&this.uiManager.overlay.removeAttribute("cq-active"),this.activeAttributes)this.hasAttribute(t)&&this.removeAttribute(t);this.activeAttributes={},this.node.find("input").each((function(){this==this.ownerDocument.activeElement&&this.blur()})),this.removeFocused();const e=this.ownerDocument.body.keystrokeHub;e&&e.removeActiveModal(this),this.parentElement.removeAttribute("cq-active")}launchColorPicker(){this.uiManager&&this.uiManager.closeMenu(null,"CQ-MENU")}open(t){this.uiManager.openMenu(this,t);const{context:e,opener:i}=t||{};if(!e||!e.config)return void(this.onClose=null);const{config:{channels:n},stx:s}=e;s.translateUI&&s.translateUI(this.node[0]),this.onClose=()=>{this.channelWrite(n.dialog||"channel.dialog",{},s),this.onClose=null,this.firstElementChild.hide&&this.firstElementChild.hide()},i&&(this.opener=i,this.opener.keepOpen=!0),this.parentElement.setAttribute("cq-active",!0)}resize(){this.node.find("cq-scroll").each((function(){this.resize&&this.resize()})),this.params&&this.params.x?this.stxContextMenu():this.center()}show(t){this.params=t,t||(t=this.params={});var i=this,n=t.context||e.UI.getMyContext(this);if(this.uiManager.overlay||t.bypassOverlay||(this.uiManager.overlay=document.createElement("cq-dialog-overlay"),n&&n.node.append(this.uiManager.overlay)),i.active=!0,setTimeout((function(){for(var e in i.uiManager.overlay&&!t.bypassOverlay&&"true"!==i.uiManager.overlay.getAttribute("cq-active")&&i.uiManager.overlay.setAttribute("cq-active","true"),i.activeAttributes["cq-active"]=!0,i.activeAttributes)"true"!==i.node.attr(e)&&i.node.attr(e,"true");i.resize()})),n&&n.config&&n.config.themes){let t=Object.keys(n.config.themes.builtInThemes);this.classList.remove(...t);let e=t.find((t=>!0===n.topNode.classList.contains(t)));e&&this.classList.add(e)}const s=this.ownerDocument.body.keystrokeHub;s&&s.addActiveModal(this)}stxContextMenu(){var t=this.parentElement;"BODY"==t.tagName&&(t=window);var i=e.guaranteedSize(t),n=i.width,s=i.height,o=e.elementDimensions(this,{padding:1,border:1}),a=o.width,r=o.height,c=this.params.x,l=this.params.y,h=!1;this.node.find("cq-menu.stxMenuActive").each((function(){if(this.querySelector(".context-menu-right")){var t=e.UI.$(this).nextAll().length+1,i=e.elementDimensions(this,{padding:1,border:1}),n=e.elementDimensions(this.querySelector(".context-menu-right"),{padding:1,border:1});a+=o.width,r+=n.height-i.height*t,h=!0}})),c+a>n&&(c=n-a),l+r>s&&(l=s-r),l<0&&(l=0),h&&(this.params.x=c,this.params.y=l),Object.assign(this.style,{top:`${l}px`,left:`${c}px`,"margin-top":"auto"})}tap(t){this.uiManager.topMenu()!==this&&t.currentTarget.active||t.stopPropagation()}}e.UI.addComponentDefinition("cq-dialog",i)},M=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.BaseComponent{connectedCallback(){this.attached||(super.connectedCallback(),this.init())}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}init(){this.addDefaultMarkup(),this.textRange=this.querySelector(".ciq-double-slider-text"),this.lowSlider=this.querySelector(".ciq-double-slider-range[range='low']"),this.highSlider=this.querySelector(".ciq-double-slider-range[range='high']"),this.backing=this.querySelector("cq-double-slider-range"),this.name=this.getAttribute("name")||e.uniqueID(),["min","max","step","low","high"].forEach((t=>{this.hasAttribute(t)&&(this[t]=Number(this.getAttribute(t)))})),this.setBounds(this);const t=this;function i(e,i){let n=e.value;if(i){const e=i.touches[0],s=t.highSlider.getBoundingClientRect();let{height:o,width:a}=getComputedStyle(t.highSlider);o=parseFloat(o),a=parseFloat(a);let r=1;if(o>a){r=Math.max(0,Math.min(o,e.pageY-s.top))/o}else{r=Math.max(0,Math.min(a,e.pageX-s.left))/a}n=t.min+r*(t.max-t.min)}t.whichSlider||(t.whichSlider=2*n>(isNaN(t.high)?t.max:t.high)+(isNaN(t.low)?t.min:t.low)+1?t.highSlider:t.lowSlider),t.whichSlider===t.lowSlider?t.low=t.lowSlider.value=Math.min(void 0===t.high?t.max:t.high,n):t.whichSlider===t.highSlider&&(t.high=t.highSlider.value=Math.max(void 0===t.low?t.min:t.low,n)),t.setValue(t)}[this.highSlider,this.lowSlider].forEach((n=>{["mousedown","pointerdown"].forEach((e=>{n.addEventListener(e,(e=>{t.whichSlider=null}))})),n.addEventListener("input",(()=>i(n))),e.touchDevice&&(n.addEventListener("touchstart",(e=>{t.whichSlider=null,t.engaged=!0,i(n,e)}),{passive:!1}),n.addEventListener("touchmove",(e=>{t.engaged&&i(n,e)}),{passive:!1}),n.addEventListener("touchend",(e=>{t.engaged=!1}),{passive:!1}))}))}setBounds(t){Array.from(this.querySelectorAll('input[type="range"]')).forEach((e=>{["min","max","step"].forEach((i=>{(t[i]||0===t[i])&&(e.setAttribute(i,t[i]),this[i]=t[i])}))})),this.updateVisual()}setValue(t){const i={};t&&(void 0!==t.low&&(i.low=void 0===this.min?t.low:Math.max(this.min,t.low)),void 0!==t.high&&(i.high=void 0===this.max?t.high:Math.min(this.max,t.high))),e.equals(this.value,i)||(this.value=i),this.low=i.low,this.high=i.high,this.updateVisual()}updateVisual(){this.setAttribute("min",this.min),this.setAttribute("max",this.max),this.setAttribute("low",this.low),this.setAttribute("high",this.high),this.setAttribute("step",this.step);const t=getComputedStyle(this.textRange),e=t.color,i=t.borderLeftColor;let n=this.low;(isNaN(n)||n<this.min)&&(n=this.min);let s=this.high;(isNaN(s)||s>this.max)&&(s=this.max),this.lowSlider.value=n,this.highSlider.value=s,void 0!==n&&(n=Number(this.lowSlider.value)),void 0!==s&&(s=Number(this.highSlider.value));const o=n-this.min,a=s-this.min;this.textRange.innerHTML=n+"-"+s;const r=this.max-this.min,c=[o/r*100,a/r*100];this.backing.style.background=`linear-gradient(to right,\n\t\t\t${i} 0% ${c[0]}%,\n\t\t\t${e} ${c[0]}% ${c[1]}%,\n\t\t\t${i} ${c[1]}% 100%)`}}i.markup='\n\t\t<cq-double-slider-text class="ciq-double-slider-text"></cq-double-slider-text>\n\t\t<cq-double-slider-range class="ciq-double-slider-range"></cq-double-slider-range>\n\t\t<input type="range" class="ciq-double-slider-range" range="low">\n\t\t<input type="range" class="ciq-double-slider-range" range="high">\n',e.UI.addComponentDefinition("cq-double-slider",i)},N=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}open(t){this.addDefaultMarkup(),this.classList.add("ciq-context-menu"),this.drawing=t.drawing;var e=this.node.find("[cq-edit-text]");return this.drawing.edit?e.show():e.hide(),super.open(t)}}i.markup='\n\t\t<div stxtap="DrawingEdit.text()" cq-edit-text>Edit Text</div>\n\t\t<div stxtap="DrawingEdit.edit()">Edit Settings</div>\n\t\t<div stxtap="DrawingEdit.clone()">Clone Drawing</div>\n\t\t<cq-menu stxtap="resize()" cq-close-top="cq-dialog[cq-drawing-context]">\n\t\t\t<cq-menu-dropdown cq-no-scroll="true" class="context-menu-right">\n\t\t\t\t<cq-item stxtap="DrawingEdit.reorderLayer(\'top\')">Bring to Top</cq-item>\n\t\t\t\t<cq-item stxtap="DrawingEdit.reorderLayer(\'up\')">Bring Forward</cq-item>\n\t\t\t\t<cq-item stxtap="DrawingEdit.reorderLayer(\'down\')">Send Backward</cq-item>\n\t\t\t\t<cq-item stxtap="DrawingEdit.reorderLayer(\'bottom\')">Send to Bottom</cq-item>\n\t\t\t</cq-menu-dropdown>\n\t\t\t\x3c!-- element here so that <cq-menu-dropdown> can keep "top: auto;" --\x3e\n\t\t\t<div>Layer Management<div class="context-button-right-arrow"></div></div>\n\t\t</cq-menu>\n\t\t<div stxtap="DrawingEdit.remove()">Delete Drawing</div>\n\t',e.UI.addComponentDefinition("cq-drawing-context",i)},O=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}add(){var t=this.node.find("[cq-custom-fibonacci-setting] input").val();if(t&&(t=parseFloat(t)/100,!isNaN(t))){for(var i,n,s=this.context.stx.currentVectorParameters.fibonacci.fibs||[],o=0;o<s.length;o++)if((i=s[o]).level>t){(n=e.clone(i)).level=t,n.display=!0,n.parameters&&(n.parameters.opacity=.25),s.splice(o,0,n);break}n||(i=s.length?e.clone(s[0]):{color:"auto",parameters:{pattern:"solid",opacity:.25,lineWidth:1}},(n=e.clone(i)).level=t,n.display=!0,s.push(n)),this.open()}}close(){if(this.opener){var t=new Event("change",{bubbles:!0,cancelable:!0});this.opener.dispatchEvent(t),this.context.stx.currentVectorParameters.fibonacci.fibsAlreadySet=!0}super.close()}open(t){this.addDefaultMarkup(),super.open(t),t&&(this.opener=t.caller);var i,n=this.context.stx.currentVectorParameters,s=n.vectorType,o=this.node;if(n.fibonacci&&"fibtimezone"!=s){o.find(".title").text("Fibonacci Settings");var a=n.fibonacci.fibs||[];(i=o.find("cq-fibonacci-settings")).children(":not(template)").remove();for(var r=0;r<a.length;r++){var c=a[r];if(!("fibarc"===s&&c.level<0)){var l=e.UI.makeFromTemplate(this.node.find("template"),i),h=100*c.level;l.find(".ciq-heading").text(h.toFixed(1)+"%");var d=l.find("input");c.display&&d.prop("checked",!0),this.setChangeEvent(d,"fib",c.level),l.find(".stx-data").append(d)}}}else o.find(".title").text("Settings"),(i=o.find("cq-fibonacci-settings")).children(":not(template)").remove();this.node.find("[cq-custom-fibonacci-setting] input").val("")}setChangeEvent(t,e,i){var n=this;t[0].addEventListener("change",(function(){var t=n.context.stx.currentVectorParameters,e=t.vectorType;if(t.fibonacci&&"fibtimezone"!=e){var s=t.fibonacci.fibs||[];if("checkbox"==this.type)for(var o=0;o<s.length;o++){var a=s[o];a.level===i&&(a.display=!!this.checked)}}}))}}i.markup='\n\t\t<h4 class="title">Settings</h4>\n\t\t<cq-scroll cq-no-maximize>\n\t\t\t<cq-fibonacci-settings>\n\t\t\t\t<template cq-fibonacci-setting>\n\t\t\t\t\t<cq-fibonacci-setting>\n\t\t\t\t\t\t<div class="ciq-heading"></div>\n\t\t\t\t\t\t<div class="stx-data">\n\t\t\t\t\t\t\t<input type="checkbox">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</cq-fibonacci-setting>\n\t\t\t\t</template>\n\t\t\t</cq-fibonacci-settings>\n\t\t\t<div cq-custom-fibonacci-setting>\n\t\t\t\t<input class="ciq-heading" type="text">%\n\t\t\t\t<div class="ciq-btn stx-data" stxtap="add()">Add</div>\n\t\t\t</div>\n\t\t</cq-scroll>\n\t\t<div class="ciq-dialog-cntrls">\n\t\t\t<div class="ciq-btn" stxtap="close()">Done</div>\n\t\t</div>\n\t',e.UI.addComponentDefinition("cq-fib-settings-dialog",i)},H=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}setContext(t){const{stx:i}=t;i.callbackListeners.floatingWindow||(i.callbackListeners.floatingWindow=[]),i.addEventListener("floatingWindow",(t=>{const i=this["on"+e.capitalize(t.type)];if(i)return i.call(this,t),!0}))}onShortcut({container:t,title:e,tag:i,content:n,width:s,status:o,onClose:a}){this.shortcutWindow?this.shortcutWindow.toggle(o).ensureVisible():(this.shortcutWindow=this.constructor.windowImplementation.get({tag:i,content:n,title:e,container:t||document.body,onClose:a}),this.shortcutWindow.toggle(!0).update({width:s}).positionRelativeTo())}onDocumentation({container:t,title:i,tag:n,content:s,actionButtons:o,width:a,status:r,onClose:c}){function l(t,e){return()=>{"close"===t?e.toggle(!1):"function"==typeof t&&t()}}this.documentationWindow=this.constructor.windowImplementation.get({tag:n,content:s+"<br/>",title:i,container:t||document.body,onClose:c});for(let t of o){let i=document.createElement("button");i.innerText=t.label,i.style.marginTop="1em",i.style.marginRight="1em",e.safeClickTouch(i,l(t.action,this.documentationWindow)),this.documentationWindow.bodyEl.appendChild(i)}this.context.stx.translateUI&&this.context.stx.translateUI(this.documentationWindow.w),this.documentationWindow.toggle(!0).update({width:a}).positionRelativeTo()}}class n{constructor({content:t,title:e,tag:i,minWidth:n,minHeight:s,container:o,onClose:a}){const r=document.createElement("div");r.innerHTML=this.constructor.markup,r.classList.add("ciq-window"),(o.ownerDocument||document).body.append(r),r.tag=i,r.docWindow=this,Object.assign(this,{isDragging:!1,isResizing:!1,isOpen:!1,xDiff:0,yDiff:0,x:50,y:50,w:r}),this.bindEvents(),this.titleEl=r.querySelector(".ciq-window-title"),this.bodyEl=r.querySelector(".ciq-window-body"),this.titleBarEl=r.querySelector(".ciq-window-bar"),this.setProps({title:e,content:t,minWidth:n,minHeight:s,container:o,onClose:a}),this.render()}setProps({title:t,content:e,minWidth:i,minHeight:n,container:s,onClose:o}){const{w:a,titleEl:r,bodyEl:c}=this;r.removeAttribute("cq-translate-original"),c.removeAttribute("cq-translate-original"),void 0!==t&&(r.textContent=t),void 0!==e&&(c.innerHTML=e),void 0!==i&&(a.style.minWidth=i+"px"),void 0!==n&&(a.style.minHeight=n+"px"),s&&(this.container=s),void 0!==o&&(this.onClose=o)}bindEvents(){const{w:t}=this,e=e=>t.querySelector(e);e(".ciq-window-bar").addEventListener("mousedown",this.onStartDrag.bind(this));const i=this.toggleCollapse.bind(this);e(".ciq-window-bar").addEventListener("dblclick",i),e(".ciq-window-collapse").addEventListener("click",i);"top, right, bottom, left, top-right, bottom-right, bottom-left, top-left".split(/, /).forEach((t=>{e(`.ciq-window-resize-${t}`).addEventListener("mousedown",(function(t){if(0!==t.button)return;const e=t.target.className.replace(/ciq-window-resize-/,"");n.isResizing=e,n.downX=t.pageX,n.downY=t.pageY,n.startWidth=n.width,n.startHeight=n.height,n.startLeft=n.x,n.startTop=n.y}))})),t.ownerDocument.addEventListener("mousemove",this.onMouseMove.bind(this)),t.ownerDocument.addEventListener("mouseup",this.onMouseUp.bind(this)),e(".ciq-window-close").addEventListener("click",this.toggle.bind(this,!1)),t.ownerDocument.defaultView.addEventListener("resize",this.ensureVisible.bind(this));const n=this}update({x:t,y:e,width:i,height:n}){return Object.assign(this,{x:t,y:e,width:i,height:n}),this.render(),this}positionRelativeTo({container:t,location:e="center"}={}){const{x:i,y:n,width:s,height:o}=(t||this.container||document.body).getBoundingClientRect(),a=this.w.ownerDocument.documentElement.scrollTop,r=this.w.ownerDocument.documentElement.scrollLeft;return this.width>s-20&&(this.width=s-20),this.height>o-20&&(this.height=o-20),"center"===e&&(this.x=r+(i+s/2-this.width/2),this.y=a+(n+o/2-this.height/2)),this.render(),this}ensureVisible(){if(!this.isOpen)return;const{x:t,y:e,width:i}=this.w.getBoundingClientRect(),{innerWidth:n,innerHeight:s}=this.w.ownerDocument.defaultView;e>s-20&&(this.y=s-20),t>n-i&&(this.x=n-i),this.render()}render(){const{x:t,y:e}=this;Object.assign(this.w.style,{display:this.isOpen?"":"none",transform:"translate("+t+"px, "+e+"px)"}),this.w.classList.toggle("ciq-wdragging",this.isDragging||this.isResizing)}get width(){return this.w.offsetWidth}set width(t){t&&(this.w.style.width=t+"px")}get height(){return this.w.offsetHeight}set height(t){t&&(this.w.style.height=t+"px")}clampX(t){return Math.min(Math.max(t,0),this.w.ownerDocument.defaultView.innerWidth-this.w.offsetWidth)}clampY(t){return Math.min(Math.max(t,0),this.w.ownerDocument.defaultView.innerHeight-this.titleBarEl.offsetHeight-8)}onMouseMove(t){const{isDragging:e,isResizing:i}=this;if(!e&&!i)return;const n=t.pageX-this.downX,s=t.pageY-this.downY;e&&(this.x=this.clampX(n),this.y=this.clampY(s));const{startWidth:o,startHeight:a}=this;let r,c;if(/left/.test(i)&&(c=this.startWidth-n,this.width=c,this.x=this.startLeft+n),/top/.test(i)&&(r=this.startHeight-s,this.height=r,this.y=this.startTop+s),i&&/right|bottom/.test(i)){this.width=/right/.test(i)?n+o:c||o,this.height=/bottom/.test(i)?s+a:r||a;const t=this.w.ownerDocument.defaultView;this.x+this.width-2>t.innerWidth&&(this.width=t.innerWidth-this.x-2),this.y+this.height-2>t.innerHeight&&(this.height=t.innerHeight-this.y-2)}this.render()}onStartDrag(t){0===t.button&&(this.isDragging=!0,this.downX=t.pageX-this.x,this.downY=t.pageY-this.y)}onMouseUp(){this.isDragging=!1,this.isResizing=!1,this.render()}toggle(t){const e=void 0===t?!this.isOpen:t,i=this.isOpen!==e;return this.isOpen=e,i&&!this.isOpen&&this.onClose&&(this.onClose(),this.isCollapsed&&this.toggleCollapse()),this.render(),this}toggleCollapse(){this.isCollapsed=!this.isCollapsed,this.isCollapsed?(this.prevHeight=this.height,this.w.classList.add("ciq-window-collapsed"),this.height=this.titleBarEl.offsetHeight,this.onCollapse&&this.onCollapse()):(this.height=this.prevHeight,this.w.classList.remove("ciq-window-collapsed"));this.w.querySelector(".ciq-window-collapse").title=this.isCollapsed?"Expand":"Collapse",this.render()}}n.markup='\n<div class="ciq-window-bar" title="Drag to reposition. Double click to collapse">\n<div class="ciq-window-title"></div>\n<span class="ciq-window-collapse" title="Collapse"></span>\n<span class="ciq-window-close" title="Click to close">\n</span>\n</div>\n<div class="ciq-window-body"></div>\n<div class="ciq-window-resize-left"></div>\n<div class="ciq-window-resize-top"></div>\n<div class="ciq-window-resize-right"></div>\n<div class="ciq-window-resize-bottom"></div>\n<div class="ciq-window-resize-bottom-right"></div>\n<div class="ciq-window-resize-bottom-left"></div>\n<div class="ciq-window-resize-top-left"></div>\n<div class="ciq-window-resize-top-right"></div>\n',n.get=function(t){let e;return t.tag&&(e=Array.from((t.container.ownerDocument||document).querySelectorAll(".ciq-window")).find((e=>e.tag===t.tag)),e)?(e.docWindow.setProps(t),e.docWindow):new this(t)},i.windowImplementation=n,e.UI.addComponentDefinition("cq-floating-window",i)},F=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.BaseComponent{connectedCallback(){if(this.attached)return;super.connectedCallback(),this.innerHTML=this.render(),this.columns=2,this.rows=2,this.generateTable(this.columns,this.rows),this.highlightTable(this.columns-1,this.rows-1),this.querySelector("table").addEventListener("mouseleave",(()=>{this.generateTable(this.columns+1,this.rows+1),this.highlightTable(this.columns,this.rows)}));const t=t=>{let i=document.createElement("div");return i.className="ciq-multi-chart-button "+t,e.safeClickTouch(i,function(e){this.triggerUpdateGridEvent({template:t})}.bind(this)),i};if(this.templates){const e=this.querySelector(".ciq-grid-layout-picker");this.templates.split(" ").forEach((i=>{e.appendChild(t(i))})),e.childNodes.forEach((t=>{const e=getComputedStyle(t);let i=0;if(e.gridTemplateAreas&&"none"!=e.gridTemplateAreas){i=[...new Set(e.gridTemplateAreas.match(/([a-z])+/gi))].length}else e.getPropertyValue("--grid-dimension")&&(i=parseInt(e.getPropertyValue("--grid-dimension"))||0,i++);for(let e=0;e<i;e++)t.innerHTML+="<div></div>"}))}}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}get maxcols(){return this.getAttribute("maxcols")||4}set maxcols(t){this.setAttribute("maxcols",t)}get maxrows(){return this.getAttribute("maxrows")||4}set maxrows(t){this.setAttribute("maxrows",t)}get templates(){return this.getAttribute("templates")||""}set templates(t){this.setAttribute("templates",t)}get resize(){return this.getAttribute("resize")||""}set resize(t){this.setAttribute("resize",t)}generateTable(t,e){var i=this;function n(t){let e=parseInt(t.target.dataset.column)+1;e>i.maxcols&&(e=i.maxcols);let n=parseInt(t.target.dataset.row)+1;n>i.maxrows&&(n=i.maxrows),"fixed"!=this.resize&&i.generateTable(e,n),i.highlightTable(parseInt(t.target.dataset.column),parseInt(t.target.dataset.row))}"fixed"==this.resize&&(t=this.maxcols,e=this.maxrows);let s=this.querySelector("table");if(s){this.cleanTable(t,e),t=t||1,e=e||1;for(let i=1;i<=Math.min(e,this.maxrows);i++){let o;s.childNodes[i-1]?o=s.childNodes[i-1]:(o=document.createElement("tr"),s.appendChild(o));for(let s=1;s<=Math.min(t,this.maxcols);s++)if(!o.childNodes[s-1]){let a=document.createElement("td");a.dataset.row=i,a.dataset.column=s,a.dataset.rows=e,a.dataset.columns=t,a.addEventListener("mouseenter",n),a.addEventListener("click",function(t){this.triggerUpdateGridEvent({columns:t.target.dataset.column,rows:t.target.dataset.row})}.bind(this)),a.appendChild(document.createElement("div")),o.appendChild(a)}}}}triggerUpdateGridEvent({columns:t,rows:e,template:i}){this.columns=+t,this.rows=+e,this.template=i||"",this.highlightTable(this.columns,this.rows),this.highlightTemplate();this.closest("cq-context, [cq-context]").dispatchEvent(new CustomEvent("update-grid",{detail:{columns:t,rows:e,template:i,container:this.closest("cq-context")},bubbles:!0,composed:!0}))}highlightTable(t,e){for(let i of this.querySelectorAll("td"))i.dataset.column<=t&&i.dataset.row<=e?i.classList.add("highlight"):i.classList.remove("highlight");const i=this.querySelector(".row.count"),n=this.querySelector(".multiply"),s=this.maxrows<2;i.style.display=s?"none":"",n.style.display=s?"none":"",i.innerHTML=e,this.querySelector(".column.count").innerHTML=t}highlightTemplate(t){t&&(this.template=t);const e=this.querySelectorAll(".ciq-grid-layout-picker .ciq-multi-chart-button");if(e.forEach((t=>{t.classList.remove("active")})),this.template){const t=Array.from(e).find((t=>t.classList.contains(this.template)));t&&t.classList.add("active")}}cleanTable(t,e){let i=this.querySelector("table");for(;i.childNodes.length>e;)i.removeChild(i.lastChild);for(let e of i.childNodes)for(;e.childNodes.length>t;)e.removeChild(e.lastChild)}render(){return'\n\t\t\t\t<style>\n\n\t\t\t\t\t.ciq-grid-layout-picker {\n\t\t\t\t\t\tdisplay: grid;\n\t\t\t\t\t\tgrid-template-columns: 1fr 1fr 1fr 1fr;\n\t\t\t\t\t\tgrid-gap: 10px;\n\t\t\t\t\t\tmargin: 5px 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tcq-grid-size-picker, cq-grid-size-picker tr, cq-grid-size-picker td{\n\t\t\t\t\t\tdisplay: block;\n\t\t\t\t\t}\n\n\t\t\t\t\tcq-grid-size-picker tr{\n\t\t\t\t\t\tmargin: 0;\n\t\t\t\t\t\tpadding: 0;\n\t\t\t\t\t\twhite-space: nowrap;\n\t\t\t\t\t\tline-height: 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tcq-grid-size-picker td{\n\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\theight: 19px;\n\t\t\t\t\t\twidth: 19px;\n\t\t\t\t\t\tmargin: 0;\n\t\t\t\t\t\tpadding: 0;\n\t\t\t\t\t\ttext-align: center;\n\t\t\t\t\t}\n\n\t\t\t\t\tcq-grid-size-picker td div{\n\t\t\t\t\t\tpointer-events: none;\n\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t\theight: 15px;\n\t\t\t\t\t\twidth: 15px;\n\t\t\t\t\t\tmargin: 2px;\n\t\t\t\t\t\tpadding: 0;\n\t\t\t\t\t\tborder: solid 1px #ccc;\n\t\t\t\t\t\tborder-color: var(--grid-size-border-color, #ccc);\n\t\t\t\t\t\tbackground: #eee; /* keep a hard coded style in case the var function is unavailable */\n\t\t\t\t\t\tbackground-color: var(--grid-size-background-color, #eee);\n\t\t\t\t\t\ttext-align: center;\n\t\t\t\t\t}\n\n\t\t\t\t\tcq-grid-size-picker td:hover div, cq-grid-size-picker td.highlight div{\n\t\t\t\t\t\tborder-color: #666;\n\t\t\t\t\t\tborder-color: var(--grid-size-border-hl-color, #666);\n\t\t\t\t\t\tbackground: #ccc;\n\t\t\t\t\t\tbackground-color: var(--grid-size-background-hl-color, #ccc);\n\t\t\t\t\t}\n\n\t\t\t\t\tcq-grid-size-picker p{\n\t\t\t\t\t\twidth:100%;\n\t\t\t\t\t\tline-height: 1em;\n\t\t\t\t\t\ttext-align: center;\n\t\t\t\t\t\tmargin: 5px 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tcq-grid-size-picker .multiply{\n\t\t\t\t\t\ttransform: rotate(45deg);\n\t\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\t}\n\t\t\t\t</style>\n\n\t\t\t\t<div class="ciq-grid-layout-picker"></div>\n\t\t\t\t<cq-separator></cq-separator>\n\t\t\t\t<table class="grid-size-picker"></table>\n\t\t\t\t<p><span class="row count">1</span> <span class="multiply">+</span> <span class="column count">1</span></p>\n\t\t\t'}}e.UI.addComponentDefinition("cq-grid-size-picker",i)},Q=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}setContext(){if(!this.hasAttribute("cq-filter"))return;const t=this.getAttribute("cq-filter")||"Search";this.createFilter(t)}createFilter(t){if(this.filterCreated)return;const e=document.createElement("div");e.classList.add("searchFilter"),this.appendChild(e);const i=document.createElement("input");i.type="search",i.placeholder=t,i.setAttribute("tabindex","-1"),this.hasAttribute("cq-search-icon")&&e.appendChild(this.ownerDocument.createElement("cq-lookup-icon")),e.appendChild(i),this.searchWrapper=e;const n=this.nextElementSibling;let s="";const o=({target:{value:t}})=>{const e=new RegExp(t,"i"),o=this.qsa;o("cq-item",n).forEach((a=>{const r=t&&!e.test(a.textContent)?"add":"remove";a.classList[r]("item-hidden"),s!==t&&(s=t,this.removeFocused.apply(n),o(".cq-keyboard-selected-highlight").forEach((t=>{t.classList.add("disabled")})),i.focus())})),"function"==typeof n.scrollToTop&&n.scrollToTop()};i.addEventListener("input",o),i.addEventListener("keyup",o),i.addEventListener("pointerdown",(t=>{t.stopPropagation()}));const a=this.getAttribute("cq-filter-min")||15,r=()=>{const t=this.qsa("cq-item",n).length;e.classList[t>a?"add":"remove"]("active")};"undefined"!=typeof MutationObserver?(new MutationObserver(r).observe(this.parentElement,{childList:!0,subtree:!0}),r(),this.filterCreated=!0):e.classList.add("active")}}e.UI.addComponentDefinition("cq-heading",i)},V=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}disconnectedCallback(){super.disconnectedCallback(),this.attached=!0}setContext(t){this.addDefaultMarkup();const i=new e.UI.HeadsUp(this,t,{followMouse:!0,autoStart:!1});let n=t.config&&t.config.channels?t.config.channels.headsUp:"layout.headsUp";this.channelSubscribe(n,(t=>{i["dynamic"===t||(t||{}).dynamic?"begin":"end"]()}))}}i.markup='\n\t\t<svg version="1.1" x="0px" y="0px" viewBox="0 0 215 140" enableBackground="new 0 0 215 140">\n\t\t\t<defs>\n\t\t\t\t<filter id="ciq-hu-shadow" height="130%">\n\t\t\t\t\t<feGaussianBlur in="SourceAlpha" stdDeviation="1"></feGaussianBlur>\n\t\t\t\t\t<feOffset dx="0" dy="1" result="offsetblur"></feOffset>\n\t\t\t\t\t<feComponentTransfer>\n\t\t\t\t\t\t<feFuncA type="linear" slope="0.2"></feFuncA>\n\t\t\t\t\t</feComponentTransfer>\n\t\t\t\t\t<feMerge>\n\t\t\t\t\t\t<feMergeNode></feMergeNode>\n\t\t\t\t\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t\t\t\t\t</feMerge>\n\t\t\t\t</filter>\n\t\t\t</defs>\n\t\t\t<polygon\n\t\t\t\tclass="ciq-hu-bg" style="stroke-width: 1;"\n\t\t\t\tpoints="198.4,124.4 1,124.4 1,1 214,1 214,137.8"\n\t\t\t\tfilter="url(#ciq-hu-shadow)"\n\t\t\t\t/>\n\t\t\t<path class="ciq-hu-stroke"\n\t\t\t\tfill="#398DFF"\n\t\t\t\td="M213,2v133.6l-13.7-11.8l-0.6-0.5H198H2V2H213 M215,0H0v125.4h198l17,14.6V0L215,0z">\n\t\t\t</path>\n\t\t</svg>\n\t\t<div>\n\t\t\t<cq-hu-col1>\n\t\t\t\t<cq-hu-date></cq-hu-date>\n\t\t\t\t<cq-hu-price></cq-hu-price>\n\t\t\t\t<cq-volume-grouping>\n\t\t\t\t\t<div>Volume</div>\n\t\t\t\t\t<div><cq-volume-visual></cq-volume-visual></div>\n\t\t\t\t\t<div><cq-hu-volume></cq-hu-volume><cq-volume-rollup></cq-volume-rollup></div>\n\t\t\t\t</cq-volume-grouping>\n\t\t\t</cq-hu-col1>\n\t\t\t<cq-hu-col2>\n\t\t\t\t<div>Open</div><cq-hu-open></cq-hu-open>\n\t\t\t\t<div>Close</div><cq-hu-close></cq-hu-close>\n\t\t\t\t<div>High</div><cq-hu-high></cq-hu-high>\n\t\t\t\t<div>Low</div><cq-hu-low></cq-hu-low>\n\t\t\t</cq-hu-col2>\n\t\t</div>\n\t',e.UI.addComponentDefinition("cq-hu-dynamic",i)},_=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}disconnectedCallback(){super.disconnectedCallback(),this.attached=!0}setContext(t){this.addDefaultMarkup();const i=new e.UI.HeadsUp(this,t,{autoStart:!0});let n=t.config&&t.config.channels?t.config.channels.headsUp:"layout.headsUp";this.channelSubscribe(n,(t=>{i["static"===t||(t||{}).static?"begin":"end"]()}))}}i.markup="\n\t\t<div>\n\t\t\t<div>Price</div><cq-hu-price></cq-hu-price>\n\t\t\t<div>Open</div><cq-hu-open></cq-hu-open>\n\t\t\t<div>Close</div><cq-hu-close></cq-hu-close>\n\t\t</div>\n\t\t<div>\n\t\t\t<div>Vol</div>\n\t\t\t<cq-volume-section>\n\t\t\t\t<cq-hu-volume></cq-hu-volume>\n\t\t\t\t<cq-volume-rollup></cq-volume-rollup>\n\t\t\t</cq-volume-section>\n\t\t\t<div>High</div><cq-hu-high></cq-hu-high>\n\t\t\t<div>Low</div><cq-hu-low></cq-hu-low>\n\t\t</div>\n\t",e.UI.addComponentDefinition("cq-hu-static",i)},j=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{connectedCallback(){this.attached||(super.connectedCallback(),["mousedown","pointerdown","touchstart"].forEach((t=>this.addEventListener(t,this.mouseTouchDown,{passive:!1}))),["mouseup","pointerup","touchend","touchmove","click"].forEach((t=>this.addEventListener(t,this.mouseTouchUp,{passive:!1}))))}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}disconnectedCallback(){["mousedown","pointerdown","touchstart"].forEach((t=>this.removeEventListener(t,this.mouseTouchDown))),["mouseup","pointerup","touchend","touchmove"].forEach((t=>this.removeEventListener(t,this.mouseTouchUp))),super.disconnectedCallback()}setContext(){this.addDefaultMarkup();const t="help-feature";let{topNode:i,stx:n}=this.context;e.Help&&!i.hasAttribute(t)&&i.setAttribute(t,""),this.ensureMessagingAvailable(n)}mouseTouchDown(t){!(e.Help&&e.Help.Content&&e.Help.Content[this.getAttribute("help-id")])||this.pressTimer||t.button&&t.button>=2||(this.pressTimer=setTimeout((()=>{this.pressTimer=null,setTimeout((()=>this.classList.remove("pressing")),1e3),this.press()}),this.context.stx.longHoldTime),this.classList.add("pressing"))}mouseTouchUp(t){e.Help&&e.Help.Content&&e.Help.Content[this.getAttribute("help-id")]&&!(t.button&&t.button>=2)&&("click"===t.type&&(this.classList.contains("pressing")||this.press(),this.classList.remove("pressing")),this.pressTimer&&(clearTimeout(this.pressTimer),this.pressTimer=null))}ensureMessagingAvailable(t){setTimeout((()=>{const e=t.uiContext.topNode;e.querySelector("cq-floating-window")||e.append(document.createElement("cq-floating-window"))}))}verifyHelpContent(){if(!e.Help||!e.Help.Content)return;e.Help.Content[this.getAttribute("help-id")]?this.classList.add("help-available"):this.classList.remove("help-available")}press(){if(!e.Help||!e.Help.Content)return;let{stx:t}=this.context,i=this.getAttribute("help-id")||"default",n=e.Help.Content[i]||e.Help.Content.default;if(n){n.actions||(n.actions=[e.Help.Actions.close,e.Help.Actions.enable]),n.actionButtons=[];for(let t of n.actions){let{label:e,action:i}=t;"function"==typeof i&&(i=s(t,this.parentElement)),n.actionButtons.push({label:e,action:i})}t.dispatch("floatingWindow",{type:"documentation",title:n.title,content:n.content,actionButtons:n.actionButtons,container:t.container.querySelector(".stx-subholder"),onClose:()=>!0,width:500,status:!0,tag:"help"})}function s(t,e){return()=>t.action(e)}}}i.markup='\n\t\t<div class="ciq-help-widget"></div>\n\t\t<div class="press-indicator">\n\t\t\t\x3c!-- 1x1 transparent image to maintain aspect ratio when sizing by height --\x3e\n\t\t\t<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">\n\t\t</div>\n\t',e.UI.addComponentDefinition("cq-help",i)},B=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}setContext(t){let i=this.constructor.markup;const n=this.getAttribute("cq-toggles");n&&(i=i.replace(/dynamic,static,null/,n)),this.addDefaultMarkup(this,i),this.tooltip=this.querySelector("cq-tooltip");let s=t.config?t.config.channels:{headsUp:"layout.headsUp",crosshair:"layout.crosshair"};this.channelSubscribe(s.headsUp,(()=>this.applyValues(s))),this.channelSubscribe(s.crosshair,(t=>{(e.isMobile||t)&&"dynamic"===this.channelRead(s.headsUp)&&setTimeout((()=>this.channelWrite(s.headsUp,"static")))})),this.initInfoComponents(t)}setTooltip(t){const{context:{stx:e},tooltip:i}=this;i.innerText=e.translateIf(`Info ${t||"off"}`)}initInfoComponents(t){const e=this.querySelector("cq-toggle").getAttribute("cq-toggles");["dynamic","static"].forEach((function(i){if(new RegExp(i).test(e)&&!t.topNode.querySelector(`cq-hu-${i}`)){const e=document.createElement(`cq-hu-${i}`);t.topNode.append(e)}}))}applyValues(t){const i=this.channelRead(t.crosshair),n=this.channelRead(t.headsUp);"dynamic"===n&&(i||e.isMobile)&&setTimeout((()=>this.channelWrite(t.headsUp,"static"))),e.isMobile&&"static"===n&&setTimeout((()=>this.channelWrite(t.crosshair,!0))),this.setTooltip(n)}}i.markup='\n\t\t<cq-toggle\n\t\t\tclass="ciq-HU"\n\t\t\tcq-member="headsUp"\n\t\t\tcq-toggles="dynamic,static,null">\n\t\t\t<span></span>\n\t\t\t<cq-tooltip>Info</cq-tooltip>\n\t\t</cq-toggle>\n\t',e.UI.addComponentDefinition("cq-info-toggle",i)},R=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}set(t){const{toggleEl:e,options:i,selected:n,stx:s}=this,{crossX:o,crossY:a}=s.controls,{obj:r}=e.params,c={};i.forEach((e=>{const[i,s]=e.getAttribute("cq-member").split("-"),o=e===n&&!0===t;c[i]=s?Object.assign(c[i]||{},{[s]:o}):o})),this.connectedCharts().forEach((t=>{Object.entries(c).forEach((([e,i])=>{t.layout[e]="object"==typeof i?Object.assign({},t.layout[e],i):i})),t.changeOccurred("layout")})),"class"===e.params.action&&e.classList[t?"add":"remove"](e.params.value),e.currentValue=t,e.updateClass(),this.applyValues(this.channels);const l=this.context.topNode.getCharts;if(t){const t=l?this.connectedCharts().find((t=>t.container.closest("cq-context-wrapper.active"))):s;this.positionCrosshair(t)}}connectedCharts(){return this.context.topNode.getCharts?this.context.topNode.getCharts():[this.stx]}positionCrosshair(t){if(!t)return;const{dataSegment:e}=t.chart;if(t.container.classList.contains("stx-crosshair-on")||!e||!e.length)return;const{index:i,Close:n}=function(t){let e=t.length;for(;e--&&t[e];){const{Close:i}=t[e];if(i||0===i)return{index:e,Close:i}}return-1}(e);if(i<0)return;const s=t.pixelFromBar(i),o=t.pixelFromPrice(n);t.mousemoveinner(s+t.left,o+t.top)}setSelected(t){const{options:e}=this;this.selected=t,e.forEach((e=>{e.classList[e===t?"add":"remove"]("ciq-active")}))}setContext(t){this.tooltip=this.querySelector("cq-tooltip"),this.toggleEl=this.querySelector("cq-toggle"),this.optionsMenu=this.querySelector("cq-menu-dropdown"),this.options=Array.from(this.optionsMenu.querySelectorAll("cq-item"));let{config:{channels:i={}}={}}=t;i.headsUp||(i.headsUp="layout.headsUp"),i.crosshair||(i.crosshair="layout.crosshair"),this.channels=i,this.channelSubscribe(i.headsUp,(()=>this.applyValues(i)));const n=this.channelRead(i.headsUp)||{},s=this.channelRead(i.crosshair);let o=!1;const a=t=>{this.setSelected(t.target),this.set(!0),this.stx.changeOccurred("layout")};this.options.forEach((t=>{const[,e]=t.getAttribute("cq-member").split("-");!e&&s&&(o=!0),n[e]&&this.setSelected(t),t.selectFC=function(){a({target:this})}})),this.toggleEl.isInfoToggle=!0,this.toggleEl.currentValue=this.selected||o,this.selected||this.setSelected(this.options[0]),e.UI.stxtap(this.optionsMenu,a),e.isMobile&&(this.querySelector("cq-menu").style.display="none"),this.initInfoComponents(t.topNode),this.applyValues(i)}setTooltip(t){const{context:{stx:e},tooltip:i}=this;if(!this.options.some((t=>"crosshair"===t.getAttribute("cq-member")))){const t=this.toggleEl.currentValue?"On":"Off";i.innerText=e.translateIf(`Info ${t}`)}}initInfoComponents(t){t.querySelectorAll(".ciq-chart-area").forEach((t=>{this.options.forEach((e=>{const[,i]=e.getAttribute("cq-member").split("-");if(i&&!t.querySelector(`cq-hu-${i}`)){const e=document.createElement(`cq-hu-${i}`);t.append(e)}}))}))}applyValues(t){const i=this.channelRead(t.crosshair),n=this.channelRead(t.headsUp)||{},{dynamic:s,floating:o,crosssection:a}=n,{channelWrite:r}=this,c=this.connectedCharts();if(e.isMobile){const e=this.context.topNode.querySelector("cq-hu-static");e&&(e.style.display=o?"none":"");const a=this.context.topNode.querySelector("cq-hu-dynamic");if(a&&(a.style.display="none"),s)return d(t.headsUp,Object.assign({},n,{dynamic:!1,floating:!0})),void this.applyValues(t);const r=this.querySelector("cq-item[cq-member*='headsUp-']:not([cq-member*='-dynamic'])"),c=Object.values(n).includes(!0);if(r&&!c&&(this.setSelected(r),i)){const[,e]=r.getAttribute("cq-member").split("-");if(e){const i={};return i[e]=!0,d(t.headsUp,Object.assign({},n,i)),void this.applyValues(t)}}}let l=null,h=null;for(const t of this.options){const[e,i]=t.getAttribute("cq-member").split("-");"headsUp"===e&&n[i]?l=t:"crosshair"===e&&(h=t)}function d(t,e){c.forEach((i=>r(t,e,i)))}l?this.setSelected(l):h&&this.setSelected(h),i||!n.static&&!a||d(t.crosshair,!0)}getCurrentValue(t){const{options:e}=this,{obj:i}=t;for(let t=0;t<e.length;t++){const[n,s]=e[t].getAttribute("cq-member").split("-");if(!s&&i[n]||i[n]&&i[n][s])return!0}return!1}}e.UI.addComponentDefinition("cq-info-toggle-dropdown",i)},W=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;let i=!1;class n extends HTMLElement{connectedCallback(){if(this.hasAttribute("attached"))return;this.setAttribute("attached","");var t=this;const n=this.getAttribute("env-container")||"body",s=this.getAttribute("tmpl-src");var o=this.querySelector("cq-context");o||(o=this.appendChild(document.createElement("cq-context")));const a=this.hasAttribute("no-save");this.style.visibility="hidden",e.loadUI(s,o,(function(e){if(e)return;var s=t.querySelector("cq-chart-title");s&&s.removeAttribute("cq-browser-tab");for(var o=t.querySelectorAll("cq-ui-manager, cq-dialog, cq-color-picker"),r=0;r<o.length;r++){var c=o[r];c.parentNode.removeChild(c),i||document.querySelector(n).appendChild(c)}i=!0;const l={extendedHours:!0,rangeSlider:!0,inactivityTimer:!0,fullScreen:!1,initialSymbol:t.getAttribute("symbol")||void 0,restore:!a};t.signalEvent=new CustomEvent("signal-chart-ready",{detail:{node:t,params:l}}),t.setAttribute("cq-event-flag",""),t.style.visibility="",t.ownerDocument.body.dispatchEvent(t.signalEvent)}))}disconnectedCallback(){this.stx.destroy()}}customElements.define("cq-instant-chart",n)},K=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;if(e.I18N){class t extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,t),this.constructor=t}close(){const t=this.ownerDocument.querySelector("cq-language-dialog");t&&t.closest("cq-dialog,cq-menu").close()}open(t){this.addDefaultMarkup(),super.open(t);const i=this.node.find("cq-languages");i.children(":not(template)").remove();const n=this.node.find("template"),{languages:s}=e.I18N;if(!s)return;const o=this;function a(t){return function(){e.UI.contextsForEach((function(){const{stx:i}=this;e.I18N.localize(i,t),i.preferences.language=t,i.changeOccurred("preferences"),i.draw()}),o),e.I18N.translateUI(t,o.querySelector(".title"))}}for(let t in s){const o=e.UI.makeFromTemplate(n,i);o.find("cq-language-name").text(s[t]),o.find("cq-flag").attr("cq-lang",t),e.UI.stxtap(o[0],a(t))}if(this.ownerDocument.body.keystrokeHub){let{tabActiveModals:t}=this.ownerDocument.body.keystrokeHub;t[0]&&this.ownerDocument.body.keystrokeHub.setKeyControlElement(t[0])}}}t.markup='\n\t\t<h4 class="title">Choose language</h4>\n\t\t<cq-close></cq-close>\n\t\t<cq-languages>\n\t\t\t<template><div keyboard-selectable="true"><cq-flag></cq-flag><cq-language-name></cq-language-name></div></template>\n\t\t</cq-languages>\n\t',e.UI.addComponentDefinition("cq-language-dialog",t)}else console.error("languageDialog component requires first activating i18n feature.")},G=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}setContext(t){this.context.setLoader(this)}show(){this.classList.add("stx-show")}hide(){this.classList.remove("stx-show")}}e.UI.addComponentDefinition("cq-loader",i)},Y=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;if(e.ChartEngine.Driver)if(e.ChartEngine.Driver.Lookup){class t extends e.UI.ContextTag{constructor(){super(),this.usingEmptyDriver=!1,this.currentFilter=null,this.filterElements=null,this.params={},this.overrideIsActive=!1}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,t),this.constructor=t}disconnectedCallback(){this.removeClaim(this),super.disconnectedCallback()}acceptText(t,i){var n=this;this.params.driver||(this.context.lookupDriver?this.setDriver(this.context.lookupDriver):(this.setDriver(new e.ChartEngine.Driver.Lookup),this.usingEmptyDriver=!0));var s=this.params.driver.exchanges;var o=this.getAttribute("cq-exchanges");o&&(this.params.driver.exchanges=o.split(",")),this.params.driver.acceptText(t,i,null,(function(t){n.params.driver.exchanges=s,n.results(t)}))}attachDriver(t){this.driver=t}close(){if(this.keyboardNavigation)this.highlightItem(this.input[0]),setTimeout(this.highlightItem.bind(this,this.input[0]),250),this.removeFocused(this.filterElements),this.resultList[0].keyboardNavigation=null;else{const t=this.ownerDocument.body.keystrokeHub;t&&setTimeout((()=>t.highlightAlign()),250)}this.closest("cq-dialog,cq-menu").close()}forceInput(){var t=this.input[0];this.selectItem({symbol:t.value}),e.blur(t),this.close(),t.value=""}initialize(){this.addDefaultMarkup();var t=this.node;if(this.label=this.querySelector("label"),this.labelName=this.getAttribute("label-name"),this.labelText=this.getAttribute("label-text"),this.label&&this.labelText&&this.labelName){const{config:{chartId:t=""}={}}=this.context;this.label.id=t?`${this.labelName}-${t}`:this.labelName,this.label.innerText=this.labelText,t&&this.setAttribute("aria-labelledby",this.label.id)}if(this.resultList=t.find("cq-scroll"),this.input=t.find("input"),!this.input.length){var i=document.createElement("input");i.setAttribute("type","hidden"),i.value="",this.input=t.append(i)}e.UI.stxtap(this.input[0],(function(){this.focus()}));var n=this;Array.from(this.input).forEach((function(t){t.addEventListener("paste",(function(t){var e=t.target;setTimeout((function(){n.acceptText(e.value,n.currentFilter)}),0)}))}));var s=this.querySelector("cq-lookup-filters");if(s){var o=s.querySelectorAll("cq-filter");o.forEach((function(t){e.UI.stxtap(t,(function(){o.forEach((function(t){t.classList.remove("true")})),this.classList.add("true");var t=this.querySelector("cq-translate");n.currentFilter=t?t.getAttribute("original"):this.innerHTML,n.acceptText(n.input.val(),n.currentFilter)}))}))}void 0!==t.attr("cq-keystroke-claim")&&this.addClaim(this)}isActive(){return""!==this.input[0].value}keyStroke(t,i,n,s){if(s.ctrl||s.cmd)return!1;if("Meta"==i||"Win"==i)return!1;var o=this.input[0],a=!1,r=this.ownerDocument.activeElement,c=r===o;if(!c&&(n.altKey||r&&("INPUT"==r.tagName||"TEXTAREA"==r.tagName)))return!1;var l=!1,h=!1;if(e.climbUpDomTree(this,".stxMenuActive").length&&(h=!0),(c||h)&&(l=!0),!l){if(void 0===this.node.attr("cq-keystroke-default"))return;if(!h&&this.uiManager.topMenu())return}if((" "===i||"Spacebar"===i)&&""===o.value)return!1;var d=this,u=this.findFocused(this.filterElements);switch(i){case"Delete":case"Backspace":case"Del":o.value.length&&(window.getSelection().toString()?o.value="":(c||(o.value=o.value.substring(0,o.value.length-1)),o.value.length&&d.acceptText(o.value,d.currentFilter)),a=!0),"Backspace"==i&&(a=!0);break;case"Escape":case"Esc":o.value="",this.close(),e.blur(o),a=!0;break;case"Enter":var p=this.resultList;if(c=p.length&&p[0].focused(),""===o.value&&!c||this.overrideIsActive)break;if(c&&c.selectFC)c.selectFC.apply(c,{});else{var m=o.value;-1==["false","0",null].indexOf(this.getAttribute("cq-uppercase"))&&(m=m.toUpperCase()),this.selectItem({symbol:m})}e.blur(o),this.close(),o.value="",a=!0;break;case"ArrowRight":case"Right":u.length&&(this.resultList[0].keyboardNavigation&&(this.resultList[0].keyboardNavigation=null),this.focusNextItem(this.filterElements),this.clickFocusedItem(this.filterElements,n));break;case"ArrowLeft":case"Left":this.resultList[0].keyboardNavigation&&(this.resultList[0].keyboardNavigation=null),u.length&&(this.focusNextItem(this.filterElements,!0),this.clickFocusedItem(this.filterElements,n));break;case"ArrowDown":case"Down":if(!this.keyboardNavigation)break;if((u=this.findFocused(this.filterElements)).length){if(!this.resultList[0].keyboardNavigation){this.resultList[0].querySelector("cq-item")&&(this.resultList[0].keyboardNavigation=this.keyboardNavigation)}}else for(let t=0;t<this.filterElements.length;t++){let e=this.filterElements[t];if(e.classList.contains("true")){this.focusItem(e);break}}e.blur(o);break;case"ArrowUp":case"Up":if(!this.keyboardNavigation)break;if(this.resultList[0].keyboardNavigation){var g=this.resultList[0].querySelector("cq-item:first-of-type");g&&g.hasAttribute("cq-focused")&&(g.removeAttribute("cq-focused"),this.resultList[0].keyboardNavigation=null,this.highlightFocusedItem(this.filterElements))}else u.length&&(this.removeFocused(u),this.highlightItem(o),e.focus(o));break;default:1===i.length&&(c||(o.value=o.value+i),d.acceptText(o.value,d.currentFilter),a=!0)}return a?(!this.usingEmptyDriver&&(o.value.length||"Escape"!=i&&"Esc"!=i&&"Enter"!=i&&c)?this.open():this.close(),!c||{allowDefault:!0}):void 0}open(){setTimeout(this.highlightItem.bind(this,this.input[0]),250),this.closest("cq-dialog,cq-menu").open()}onKeyboardDeselection(){e.blur(this.input[0]),this.close(),this.keyboardNavigation&&this.keyboardNavigation.highlightPosition(),this.resultList[0].keyboardNavigationWait=!1}onKeyboardSelection(){this.highlightItem(this.input[0]),e.focus(this.input[0]),this.resultList[0].keyboardNavigationWait=!0,this.open()}reset(){this.input[0].value="",this.resultList.empty()}results(t){function i(t,i){return function(n){e.blur(t.input[0]),t.selectItem(i),t.input[0].value=""}}this.resultList=e.UI.$(this.resultList),this.resultList.empty();for(var n=0;n<t.length;n++){for(var s=t[n],o="",a=0;a<s.display.length;a++)o+="<SPAN>"+s.display[a]+"</SPAN>";var r=document.createElement("cq-item");r.innerHTML=o,r.setAttribute("role","menuitem"),this.resultList.append(r),r.selectFC=i(this,s.data),e.UI.stxtap(r,r.selectFC)}var c=this.resultList;c[0]&&c[0].top(),this.highlightFocusedItem(this.filterElements)}selectItem(t,e){this.params.cb&&this.params.cb(t,e)}setCallback(t){this.params.cb=t}setContext(t){this.initialize();const e=this.querySelector("cq-lookup-input input"),{config:i,stx:n}=t;if(!i)return;const{channels:s={}}=i;this.channelSubscribe(s.breakpoint||"channel.breakpoint",(t=>{var i=n.crossSection?n.crossSection.symbolInputType:"Symbol";"break-lg"===t?i="Enter "+i:"break-sm"===t&&(i=""),e.setAttribute("cq-translate-placeholder-original",i),e.setAttribute("placeholder",n.translateIf(i))})),this.filterElements=this.querySelectorAll("cq-lookup-filters cq-filter"),!this.params.cb&&t.changeSymbol&&(this.params.cb=t.changeSymbol)}changeContext(t){this.params.cb&&t.changeSymbol&&(this.params.cb=t.changeSymbol)}setDriver(t){this.params.driver=t}}t.markup='\n\t\t<label></label>\n\t\t<cq-lookup-input cq-no-close>\n\t\t\t<input type="text"\n\t\t\t\tspellcheck="false"\n\t\t\t\tautocomplete="off"\n\t\t\t\tautocorrect="off"\n\t\t\t\tautocapitalize="none"\n\t\t\t\tname="symbol"\n\t\t\t\tplaceholder=""\n\t\t\t\ttabindex="-1"\n\t\t\t>\n\t\t\t<cq-lookup-icon></cq-lookup-icon>\n\t\t</cq-lookup-input>\n\t\t<cq-lookup-results>\n\t\t\t<cq-lookup-filters cq-no-close role="group" aria-label="Filters">\n\t\t\t\t<cq-filter class="true">ALL</cq-filter>\n\t\t\t\t<cq-filter>STOCKS</cq-filter>\n\t\t\t\t<cq-filter>FX</cq-filter>\n\t\t\t\t<cq-filter>INDEXES</cq-filter>\n\t\t\t\t<cq-filter>FUNDS</cq-filter>\n\t\t\t\t<cq-filter>FUTURES</cq-filter>\n\t\t\t</cq-lookup-filters>\n\t\t\t<cq-scroll role="menu" aria-label="Results"></cq-scroll>\n\t\t</cq-lookup-results>\n\t',e.UI.addComponentDefinition("cq-lookup",t)}else console.error("lookup component requires first activating symbolLookupBase feature.");else console.error("lookup component requires first activating quoteFeed feature.")},X=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.DialogContentTag{static get observedAttributes(){return["filter","dialog-title"]}get activeFilter(){return this.getAttribute("filter")}set activeFilter(t){this.setAttribute("filter",t.innerText)}get dialogTitle(){return this.getAttribute("dialog-title")}set dialogTitle(t){this.setAttribute("dialog-title",t)}constructor(t={}){super(),this.params=t,this.swatchColors=e.UI.defaultSwatchColors,this.initialized=!1}acceptText(t){const e=this;this.params.driver.acceptText(t,this.activeFilter,null,(function(t){e.results(t)}))}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}disconnectedCallback(){this.removeClaim(this),super.disconnectedCallback()}attributeChangedCallback(t,e,i){switch(t){case"dialog-title":this.titleEl&&(this.titleEl.innerText=i);break;case"filter":if(this.form){const{filter:t,symbol:n}=this.form.elements;t.value=i,e!==i&&this.acceptText(n.value)}}}open(t){const{caller:i}=t,n=this,s=i&&i.hasAttribute("comparison");s&&!t.context.stx.chart.symbol||(super.open(t),this.isComparison=s,this.dialogTitle=s?"Add Comparison":"Symbol Lookup",s?(this.input.parentElement.parentElement.classList.add("comparison"),e.UI.pickSwatchColor(this,this.swatch)):this.input.parentElement.parentElement.classList.remove("comparison"),this.activeFilter||(this.activeFilter=this.filters.firstElementChild,this.currentFilter=this.filters.firstElementChild,this.filters.firstElementChild.classList.add("true")),this.dialog.setAttribute("native-tabbing",!0),setTimeout((()=>{n.input.focus()}),0))}close(){this.channelWrite("channel.lookup",!1,this.context.stx),this.input.value="",super.close()}initialize(){const t=this;this.addDefaultMarkup(),this.titleEl=this.querySelector("h4"),this.closeBtn=this.querySelector("cq-close"),this.form=this.querySelector("form"),this.input=this.querySelector("cq-lookup-input input"),this.filters=this.querySelector("cq-lookup-filters"),this.resultList=this.querySelector(".ciq-lookup-results"),this.resultTemplate=this.querySelector("template#lookupResult"),this.swatch=this.querySelector("cq-swatch"),this.closeBtn.addEventListener("pointerup",(()=>{t.reset()})),this.input.addEventListener("input",(function(e){t.acceptText(e.target.value)})),this.form.addEventListener("submit",(function(e){e.preventDefault(),t.selectItem(t.input.value)})),this.initialized=!0,e.UI.scrollbarStyling&&e.UI.scrollbarStyling.refresh(this.resultList,{maxScrollbarLength:500}),this.addClaim(this),this.filters.addEventListener("pointerup",this.setFilter.bind(this)),this.filters.addEventListener("mousedown",(function(t){requestAnimationFrame((()=>t.target.blur()))})),this.verticalStructure=i.verticalStructure.map((t=>this.querySelector(t)))}reset(){const{input:t,resultList:e}=this;for(t.value="";e.firstChild;)e.removeChild(e.firstChild)}results(t){const i=this,{resultList:n}=this;for(;n.firstChild;)n.removeChild(n.firstChild);t.forEach((t=>{const s=document.createElement("LI");let{data:o,display:a}=t;s.classList.add("result");let r=Object.entries(o).filter((t=>a.find((e=>t[1]===e))));s.innerHTML=`<cq-item tabindex="0">${r.map((t=>`<span class="${t[0]}">${t[1]}</span>`)).join("")}</cq-item>`,e.UI.stxtap(s.firstChild,(function(){i.selectItem(o.symbol)})),n.append(s)}))}selectItem(t){let e=t.symbol||t;if(!e||"string"!=typeof e||!e.trim().length)return;e=e.toUpperCase();const{stx:i,changeSymbol:n}=this.context,{symbol:s}=i.chart;if(this.isComparison){if(s.toLowerCase()===e.toLowerCase())return void i.dispatch("notification","duplicatesymbol");i.addSeries(e,{name:"comparison "+e,color:this.swatch.style.backgroundColor,isComparison:!0})}else n({symbol:e});this.close()}setContext(t){this.context=t,this.dialog=this.closest("cq-dialog"),this.dialog.setAttribute("native-tabbing",!0),this.params.driver||this.setDriver(t.lookupDriver),this.initialized||this.initialize()}setFilter(t){this.currentFilter&&this.currentFilter.classList.remove("true");const e=t.target;t.preventDefault(),e.classList.add("true"),this.activeFilter=e,this.currentFilter=e}setDriver(t){this.params.driver=t}keyStroke(t,e,i){const n=this.context.uiManager.topMenu();if(n&&"CQ-COLOR-PICKER"===n.tagName)return;const s=this.ownerDocument.activeElement,o=s.parentElement,a=t=>t.findIndex((t=>t===s));let r,c,l,h;const d=this.verticalStructure.findIndex((t=>t.contains(s))),u="CQ-ITEM"===s.tagName;switch(e){case"ArrowDown":case"Down":u?(r=this.naturalTabElements(this.resultList),c=a(r),h=r[c+1]):(l=this.verticalStructure[d+1],h=this.naturalTabElements(l)[0]);break;case"ArrowUp":case"Up":u?(r=this.naturalTabElements(this.resultList),c=a(r),h=r[c-1],0===c&&(l=this.verticalStructure[d-1],h=this.naturalTabElements(l)[0])):(l=this.verticalStructure[d-1],h=this.naturalTabElements(l)[0]);break;case"ArrowLeft":case"Left":h=s.previousElementSibling;break;case"ArrowRight":case"Right":h=s.nextElementSibling;break;case"Enter":o===this.filters&&this.setFilter(i),s===this.input&&this.form.requestSubmit()}h&&h.focus()}}i.verticalStructure=["cq-lookup-input","cq-lookup-filters",".ciq-lookup-results"],i.markup='\n<h4 class="title">Symbol Lookup</h4>\n<cq-close></cq-close>\n<form role="search">\n<div class="ciq-search-container">\n<cq-lookup-input>\n\t<cq-lookup-icon></cq-lookup-icon>\n\t<input type="text"\n\t\tspellcheck="false"\n\t\tautocomplete="off"\n\t\tautocorrect="off"\n\t\tautocapitalize="none"\n\t\tname="symbol"\n\t\tplaceholder=""\n\t>\n\t</cq-lookup-input>\n\t<cq-swatch-input class="hide-label">\n\t\t<label>Color</label>\n\t\t<cq-swatch tabindex="0" name="color"></cq-swatch>\n\t\t<input name="color" type="hidden"/>\n\t</cq-swatch-input>\n\t<button type="submit" class="ciq-btn">GO</button>\n</div>\n<cq-lookup-filters role="group" aria-label="Filters">\n\t<button type="button" class="ciq-filter">ALL</button>\n\t<button type="button" class="ciq-filter">STOCKS</button>\n\t<button type="button" class="ciq-filter">FX</button>\n\t<button type="button" class="ciq-filter">INDEXES</button>\n\t<button type="button" class="ciq-filter">FUNDS</button>\n\t<button type="button" class="ciq-filter">FUTURES</button>\n</cq-lookup-filters>\n<input type="hidden" name="filter" />\n</form>\n<ul class="ciq-lookup-results" aria-label="Results"></ul>\n<template id="lookupResult">\n\t<li><span></span></li>\n</template>\n',e.UI.addComponentDefinition("cq-lookup-dialog",i)},Z=t=>{const e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}open(t){this.addDefaultMarkup(),super.open(t),t&&(this.opener=t.caller);const{currentVectorParameters:e}=this.context.stx,i=e.measurementline||{},n=this.querySelector('div[fieldname="hoverdisplay"] input');n.checked=i.calloutOnHover,n.changeHandler&&n.removeEventListener("change",n.changeHandler),n.changeHandler=({target:t})=>{const e=t.checked;i.calloutOnHover=e;const n=new Event("change",{bubbles:!0,cancelable:!0});this.opener.dispatchEvent(n)},n.addEventListener("change",n.changeHandler),Object.keys(i.displayGroups).forEach((t=>{const e=this.querySelector(`div[fieldname="${t}"] input`);e&&(e.checked=i.displayGroups[t],e.groupName=t,e.changeHandler&&e.removeEventListener("change",e.changeHandler),e.changeHandler=({target:t})=>{const{checked:e,groupName:n}=t;i.displayGroups[n]=e;const s=new Event("change",{bubbles:!0,cancelable:!0});this.opener.dispatchEvent(s)},e.addEventListener("change",e.changeHandler))}))}}i.markup='\n\t<h4 class="title">Measurement Line Settings</h4>\n\t<cq-scroll cq-no-maximize>\n\t\t<div class="ciq-drawing-dialog-setting" fieldname="hoverdisplay">\n\t\t\t<div class="ciq-heading">Display Info on Hover</div>\n\t\t\t<div class="stx-data">\n\t\t\t\t<input type="checkbox">\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="ciq-drawing-dialog-setting" fieldname="bars">\n\t\t\t<div class="ciq-heading"># Bars</div>\n\t\t\t<div class="stx-data">\n\t\t\t\t<input type="checkbox">\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="ciq-drawing-dialog-setting" fieldname="delta">\n\t\t\t<div class="ciq-heading">Delta (% Delta)</div>\n\t\t\t<div class="stx-data">\n\t\t\t\t<input type="checkbox">\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="ciq-drawing-dialog-setting" fieldname="annpercent">\n\t\t\t<div class="ciq-heading">Annualized %</div>\n\t\t\t<div class="stx-data">\n\t\t\t\t<input type="checkbox">\n\t\t\t</div>\n\t\t</div>\n\t\t\x3c!--<div class="ciq-drawing-dialog-setting" fieldname="totreturn">\n\t\t\t<div class="ciq-heading">Total Return</div>\n\t\t\t<div class="stx-data">\n\t\t\t\t<input type="checkbox">\n\t\t\t</div>\n\t\t</div>--\x3e\n\t\t<div class="ciq-drawing-dialog-setting" fieldname="volume">\n\t\t\t<div class="ciq-heading">Volume</div>\n\t\t\t<div class="stx-data">\n\t\t\t\t<input type="checkbox">\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="ciq-drawing-dialog-setting" fieldname="studies">\n\t\t\t<div class="ciq-heading">Studies</div>\n\t\t\t<div class="stx-data">\n\t\t\t\t<input type="checkbox">\n\t\t\t</div>\n\t\t</div>\n\t</cq-scroll>\n\t<div class="ciq-dialog-cntrls">\n\t\t<div class="ciq-btn" stxtap="close()">Done</div>\n\t</div>\n',e.UI.addComponentDefinition("cq-measurementline-settings-dialog",i)},J=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends HTMLElement{constructor(){super(),this.activeClassName="stxMenuActive",this.active=!1}get focusElement(){return this.getAttribute("cq-focus")}connectedCallback(){if(!this.attached&&(this.uiManager=e.UI.getUIManager(this),this.attached=!0,!this.hasAttribute("readonly"))){var t=this;this.addEventListener("stxtap",(function(e){t.captureTap(e)}),!0),e.UI.stxtap(this,(function(e){t.tap(e)}))}}adoptedCallback(){e.UI.flattenInheritance(this,i)}captureTap(t){var i=Array.from(e.climbUpDomTree(t.target));this.noClose=i.filter((function(t){var e=t.getAttribute("cq-no-close");return null!==e&&!1!==e})).length,this.noClose||(this.noClose=i.filter((function(t){return t.matches("cq-separator,cq-heading")})).length)}close(){this.uiManager.closeMenu(this)}findLifts(){return[...this.querySelectorAll("*[cq-lift]")].filter((t=>t.closest("cq-menu,cq-dialog")==this))}hide(){if(!this.active)return;this.unlift(),this.classList.remove(this.activeClassName),this.active=!1,this.querySelectorAll("input").forEach((function(t){t==t.ownerDocument.activeElement&&t.blur()}));const t=this.querySelector("cq-menu-dropdown");if(t&&(t.disablekeyboardNavigation(),e.UI.BaseComponent.prototype.removeFocused(t.querySelectorAll("[cq-focused]"))),this.ownerDocument.body.keystrokeHub){let{tabActiveModals:t}=this.ownerDocument.body.keystrokeHub;t[0]&&this.ownerDocument.body.keystrokeHub.setKeyControlElement(t[0])}const i=this.querySelector("cq-lookup");i&&i.close()}lift(){const t=e.UI.getMyContext(this),i=this.lifts=this.findLifts();for(let e=0;e<i.length;e++){if(t&&t.config&&t.config.themes){let n=Object.keys(t.config.themes.builtInThemes);i[e].classList.remove(...n);let s=n.find((e=>!0===t.topNode.classList.contains(e)));s&&i[e].classList.add(s)}this.uiManager.lift(i[e])}}onKeyboardDeselection(){this.close()}open(t){for(var e=this.uiManager.activeMenuStack,i=0;i<e.length;i++)if(e[i]===this)return;this.uiManager.openMenu(this,t)}restoreLift(t){if(t){var e=t.remember;t.doNotDisconnect=!0,t.remove(),delete t.doNotDisconnect,Object.assign(t.style,e.css),e.parentNode.appendChild(t)}}show(t){if(!this.active&&(this.active=!0,this.classList.add(this.activeClassName),this.lift(),this.querySelectorAll("cq-scroll, cq-menu-dropdown").forEach((function(t){t.resize&&t.resize()})),this.keyboardNavigation)){const t=this.querySelector("cq-menu-dropdown");t&&this.keyboardNavigation.setKeyControlElement(t,!0)}}tap(t){t.stopPropagation();var i=this.uiManager;if(this.active)this.noClose||i.closeMenu(this);else{if(t.target.closest("cq-menu-dropdown"))return;for(var n=!1,s=e.climbUpDomTree(this.parentElement,"cq-menu"),o=0;o<s.length;o++)s[o].active&&(n=!0);if(n||i.closeMenu(null,"CQ-MENU, CQ-COLOR-PICKER"),this.open(),this.focusElement&&!e.isMobile){let t=this.querySelector(this.focusElement);!t&&this.lifts&&this.lifts.length&&(t=this.lifts[0].querySelector(this.focusElement)),t&&t.focus()}}}unlift(){const{lifts:t}=this;t&&(t.forEach((t=>this.restoreLift(t))),this.lifts=null)}}e.UI.addComponentDefinition("cq-menu",i)},tt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}setContext(t){const i=this.getAttribute("cq-name");if(i&&t.config){const n=t.config.getMenu(i);if(this.addDefaultMarkup(this,n&&n.join("")),!this.innerHTML){const t=e.UI.BaseComponent.selfOrParentElement(this,"cq-menu-dropdown-section");t&&(t.style.display="none")}}else;}}e.UI.addComponentDefinition("cq-menu-container",i)},et=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{constructor(){super()}connectedCallback(){super.connectedCallback(),this.messageQueue=[],this.displayTime=+this.getAttribute("defaultDisplayTime")||10,this.messagePosition=this.getAttribute("defaultPosition")||"top",this.messageTransition=this.getAttribute("defaultTransition")||"",this.displayTimer=null}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}setContext(){const{stx:t}=this.context;t.addEventListener("notification",(t=>{this.newMessage(t)})),this.addInjection("append","resizeChart",(()=>this.handleResize()))}handleResize(){for(let t=0;t<this.messageQueue.length;t++)this.messageQueue[t].isDisplayed&&this.positionElement(this.messageQueue[t])}positionElement(t){const e=this.context.stx.chart.canvas.getBoundingClientRect(),i=this.context.topNode.getBoundingClientRect(),n=t.classList.contains("align-bottom");let s=e.top-i.top,o=e.left-i.left;Object.assign(t.style,{top:n?s+e.height+"px":s+"px",left:o+.5*e.width+"px"})}createMessageElement(t){if(!t.message)return;let{message:i,position:n,type:s,transition:o,displayTime:a,priority:r,callback:c}=t;a=parseInt(a),0!==a&&(a=a||this.displayTime),n=n||this.messagePosition,o=o||this.messageTransition,r=r||0,i.length>160&&(i=i.slice(0,160)+"...");let l=document.createElement("div");l.innerHTML='\n\t\t\t<div class="cq-message-container">\n\t\t\t\t<div class="cq-message-icon"></div>\n\t\t\t\t<div class="cq-message-text"></div>\n\t\t\t</div>';let h=l.querySelector(".cq-message-text");return e.makeTranslatableElement(h,this.context.stx,i),l.classList.add("cq-toast-message"),l.classList.add("type-"+s),o&&l.classList.add("animate","transition-"+o),"bottom"==n&&l.classList.add("align-bottom"),l.displayTime=a,l.priority=r,l.message=i,e.safeClickTouch(l,function(t,e,i){i.stopPropagation(),e&&e(),this.removeMessageNode(t)}.bind(this,l,c)),this.positionElement(l),l}displayNextMessage(){if(!this.messageQueue.length)return;if(!this.context.topNode.querySelector(".cq-toast-message")){let t=this.messageQueue[0];this.context.topNode.appendChild(t),t.isDisplayed=!0,0!==t.displayTime&&(this.displayTimer=window.setTimeout(this.removeMessageNode.bind(this,t),1e3*t.displayTime))}}removeMessageNode(t){if(t.classList.contains("hide"))return;t.classList.add("hide");let e=t.classList.contains("animate")?500:0;window.setTimeout((()=>{t.remove(),this.messageQueue.splice(this.messageQueue.indexOf(t),1),this.displayTimer&&(this.displayTimer=window.clearTimeout(this.displayTimer)),this.displayNextMessage()}),e)}recallMessageNode(t){t.isDisplayed&&(this.displayTimer&&(this.displayTimer=window.clearTimeout(this.displayTimer)),t.isDisplayed=!1,this.context.topNode.removeChild(t))}newMessage(t){if("string"==typeof t&&this.context.config&&this.context.config.systemMessages&&(t=this.context.config.systemMessages[t]),!t||"object"!=typeof t)return;if(t.remove){for(const e of this.messageQueue)e.message===t.message&&this.dismissMessage(t.message);return}let e=this.createMessageElement(t);if(e){const t=this.messageQueue.findIndex((t=>t.priority<e.priority));t>=0?(this.messageQueue[t].isDisplayed&&this.recallMessageNode(this.messageQueue[t]),this.messageQueue.splice(t,0,e)):this.messageQueue.push(e),this.displayNextMessage()}}dismissMessage(t){for(const e of this.messageQueue)e.message===t&&this.removeMessageNode(e)}}e.UI.addComponentDefinition("cq-message-toaster",i)},it=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{constructor(){super(),this.dragMargin=10}connectedCallback(){this.attached||super.connectedCallback()}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}init(){this.isDragging=!1,this.minHeight=parseInt(this.getAttribute("min-height"),10),isNaN(this.minHeight)&&(this.minHeight=25),this.paletteDock=this.parentElement.parentElement,this.dragStrip=this.querySelector(".drag-strip"),this.resizeStrip=this.querySelector(".resize-strip"),this.dragStrip&&(this.dragStrip.addEventListener("mousedown",this.handleDragResize.bind(this,"dragging")),this.dragStrip.addEventListener("touchstart",this.handleDragResize.bind(this,"dragging"),{passive:!1})),this.resizeStrip&&(this.resizeStrip.addEventListener("mousedown",this.handleDragResize.bind(this,"resizing")),this.resizeStrip.addEventListener("touchstart",this.handleDragResize.bind(this,"resizing"),{passive:!1})),this.paletteDock.paletteSubscribe&&(this.sendMessage=this.paletteDock.paletteSubscribe(this.handleMessage.bind(this)))}static get observedAttributes(){return["docked","hide","orientation"]}handlePropertyChange(t,e,i){if("docked"===t)"false"===i?(this.setTransform(100,70),this.setHeightByScale(.8)):this.style.transform=""}handleDragResize(t,e){this.paletteDock.hasOwnProperty("dragging")&&this.paletteDock.startDrag(this,t)}handleMessage(t,e){return{id:t,message:e}}detach(t,e){let i=this.ownerDocument.body.classList.contains("break-sm");if("true"===this.docked&&!i){this.docked="false",t=t||10,e=e||10;let i={top:0,left:0,width:0,height:0};this.paletteDock.getBounds&&(i=this.paletteDock.getChartBoundsOffset()),t>i.left+i.width-this.clientWidth&&(t=i.left+i.width-this.clientWidth),this.setTransformPosition(t,e),this.paletteDock.setChartDimensions(),this.paletteDock.setVerticalPaletteHeight()}}dock(){"false"===this.docked&&(this.docked="true",this.paletteDock.setChartDimensions(),this.paletteDock.setVerticalPaletteHeight())}getHeight(){return this.clientHeight}getWidth(){return this.clientWidth}checkPosition(){let t={top:0,left:0,width:0,height:0};this.paletteDock.getBounds&&(t=this.paletteDock.getChartBoundsOffset());const e=this.style.transform.match(/-?[0-9]{1,5}(?=px)/g).map((function(t){return parseInt(t)}));e[0]+=t.left+.5*this.dragStrip.clientWidth,e[1]+=t.top+.5*this.dragStrip.clientHeight,this.setTransformPosition(e[0],e[1])}setTransformPosition(t,e){let i={top:0,left:0,width:0,height:0};this.paletteDock.getBounds&&(i=this.paletteDock.getChartBoundsOffset());let n=Math.floor(e-i.top-.5*this.dragStrip.clientHeight),s=Math.floor(t-i.left-.5*this.dragStrip.clientWidth);n=Math.min(Math.max(n,this.dragMargin),i.height-(this.dragStrip.clientHeight+this.dragMargin)),s=Math.min(Math.max(s,this.dragMargin),i.width-(this.dragStrip.clientWidth+this.dragMargin)),this.setTransform(s,n)}setTransform(t,e){this.style.transform="translate3d("+t+"px,"+e+"px, 0px)"}setHeightToPosition(t){let e={top:0,left:0,width:0,height:0};this.paletteDock.getBounds&&(e=this.paletteDock.getBounds());let i=this.getBoundingClientRect(),n=t-i.top;"vertical"===this.orientation&&n>this.minHeight&&n+(i.top-e.top)<e.height&&this.setHeight(n)}setHeightByScale(t){this.style.height=Math.floor(parseInt(this.style.height,10)*t)+"px"}setHeight(t){this.style.height=t+"px"}}e.UI.addComponentDefinition("cq-palette",i)},nt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{constructor(){super(),this.dragging=!1,this.paletteRegistry=[],this.mouseOutCk=!1}connectedCallback(){this.attached||super.connectedCallback()}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}initListeners(){const{stx:t,config:e={}}=this.context,i=this;this.setVerticalPaletteHeight(),this.addEventListener("touchend",(t=>this.stopDrag(t))),this.addEventListener("touchmove",(function(t){i.dragging&&t.touches[0]&&(t.stopPropagation(),i.dragging.classList.contains("dragging")&&i.dragging.setTransformPosition(t.touches[0].clientX,t.touches[0].clientY),i.dragging.classList.contains("resizing")&&i.dragging.setHeightToPosition(t.touches[0].clientY))}),{passive:!1}),this.addEventListener("mouseup",(t=>this.stopDrag(t))),this.addEventListener("mouseleave",(function(e){t.showCrosshairs(),i.mouseOutCk=setTimeout((()=>i.stopDrag()),500)})),this.addEventListener("mouseenter",(function(e){if(t.undisplayCrosshairs(),!i.dragging)return;if(1===e.buttons)return void clearTimeout(i.mouseOutCk);i.stopDrag()})),this.addEventListener("mousemove",(function(t){i.dragging&&(t.stopPropagation(),i.dragging.classList.contains("dragging")&&i.dragging.setTransformPosition(t.clientX,t.clientY),i.dragging.classList.contains("resizing")&&i.dragging.setHeightToPosition(t.clientY))})),this.addEventListener("mousedown",this.stopContext.bind(this)),this.addInjection("append","resizeChart",(()=>this.handleResize({resizeChart:!1})));const n=(e.channels||{}).drawing||"channel.drawing";this.channelSubscribe(n,(function(e){i.setChartDimensions(),t.resizeChart()}))}setContext(){this.initListeners()}palettePublish(t,e){for(var i=0;i<this.paletteRegistry.length;i++)this.paletteRegistry[i](t,e)}paletteSubscribe(t){return this.paletteRegistry.push(t),this.palettePublish.bind(this)}getBounds(){return this.parentNode.getBoundingClientRect()}getChartBounds(){let t=this.parentNode.getBoundingClientRect(),e={top:0,left:0,height:t.height,width:t.width};for(var i=this.querySelectorAll('[docked="true"]'),n=0;n<i.length;n++){var s=i[n];"vertical"===s.orientation?(e.width-=s.getWidth(),e.left+=s.getWidth()):"horizontal"===s.orientation&&(e.height-=s.getHeight(),e.top+=s.getHeight())}return e}getChartBoundsOffset(){let t=this.parentNode.getBoundingClientRect(),e=this.getChartBounds();return e.top+=t.top,e.left+=t.left,e}startContext(){this.classList.add("context")}stopContext(){this.classList.remove("context"),this.palettePublish("context","stop")}startDrag(t,e){for(var i=this.querySelectorAll('[docked="false"]'),n=0;n<i.length;n++)i[n].style.zIndex=1;e=e||"dragging",this.dragging=t,this.classList.add("dragging"),this.dragging.classList.add(e),this.dragging.style.zIndex=10}stopDrag(t){t&&t.preventDefault(),this.classList.remove("dragging"),this.dragging=!1,this.resizing=!1,this.node.find('[docked="false"]').each((function(){this.node.removeClass("dragging resizing")}))}startResize(t){this.resizing=t,this.classList.add("dragging"),this.dragging.classList.add("dragging")}handleResize({resizeChart:t=!0}={}){this.palettePublish("dockWillResize"),this.setChartDimensions(),this.setVerticalPaletteHeight();let e=this.ownerDocument.body.classList.contains("break-sm");for(var i=this.querySelectorAll('[docked="false"]'),n=0;n<i.length;n++){var s=i[n];e?s.dock():s.checkPosition()}this.palettePublish("dockDidResize"),t&&this.context.stx.resizeChart()}setVerticalPaletteHeight(){this.node.find("[orientation=vertical]").each(function(t,e){"true"===e.getAttribute("docked")&&(e.style.height=this.parentNode.clientHeight+"px")}.bind(this))}setChartDimensions(){const t=this.context.stx.container,{top:e,left:i,width:n,height:s}=this.getChartBounds(),{config:o}=this.context,{isMultiChartHost:a}=this.context.topNode;let r=0;o&&o.channels?(this.channelWrite(o.channels.drawingPalettes||"channel.drawingPalettes",{top:e,left:i,width:n,height:s}),a&&(r=this.channelRead(o.channels.sidepanelSize||"channel.sidepanelSize")||0)):(t.style.width=n+"px",t.style.height=s+"px",t.style.top=e+"px",t.style.left=i+"px",a&&(r=+(this.context.topNode.querySelector("cq-side-panel")||{style:{width:""}}).style.width.replace("px","")));for(var c=this.querySelectorAll('[orientation="horizontal"]'),l=0;l<c.length;l++){var h=c[l];h.style.left=i+1+"px",h.style.width=n-r-3+"px"}for(var d=this.querySelectorAll('[orientation="vertical"]'),u=0;u<d.length;u++){var p=d[u];"false"===p.docked?p.style.top=e+"px":p.style.top=0}}dockAllPalettes(){for(var t=this.querySelectorAll('[docked="false"]'),e=0;e<t.length;e++)t[e].dock()}}e.UI.addComponentDefinition("cq-palette-dock",i)},st=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}pairUp(t){this.undo=t,this.undo.redoButton=this;var i=this;e.UI.stxtap(this,(function(){i.undo.redo()}))}}e.UI.addComponentDefinition("cq-redo",i)},ot=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.BaseComponent{connectedCallback(){if(!this.attached&&(super.connectedCallback(),this.hasAttribute("cq-no-claim")||this.addClaim(this),!this.hasAttribute("cq-no-scroll"))){this.style.overflowY="auto",this.uiManager=e.UI.getUIManager(this),this.uiManager.length>0&&(this.uiManager=this.uiManager[0]),this.addEventListener(e.wheelEvent,(function(t){t.stopPropagation()}),{passive:!1});var t=this;e.UI.addResizeListener(this,(function(){t.resize()})),this.resize(),this.maxHeight=this.getAttribute("cq-max-height")}}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}disconnectedCallback(){this.doNotDisconnect||(this.removeClaim(this),e.UI.removeResizeListener(this),e.UI.scrollbarStyling&&e.UI.scrollbarStyling.destroy(this),super.disconnectedCallback())}focused(){var t=this.node.find("cq-item[cq-focused]");return t.length?t[0]:null}keyStroke(t,i,n){if(!this.keyboardNavigation&&(this.keyboardNavigationWait||!this.matches(".stxMenuActive *")))return;if(!e.trulyVisible(this))return!1;const s=this.querySelectorAll("[keyboard-selectable='true'], cq-item:not(.item-hidden), li");if(s.length){if(" "==i||"Spacebar"==i||"Enter"==i){const t=this.findFocused(s);if(!t||!t.length)return;const e=t[0].querySelectorAll("[keyboard-selectable-child='true'][cq-focused]");if(e.length){const i=t[0].closest("cq-study-legend");i&&i.storeFocused(t,e[0]),this.clickItem(e[0],n)}else this.clickItem(t[0],n)}else if("ArrowDown"==i||"Down"==i)this.focusNextItem(s);else if("ArrowUp"==i||"Up"==i)this.focusNextItem(s,!0);else if("ArrowRight"==i||"Right"==i){const t=this.findFocused(s);if(!t||!t.length)return;const e=t[0].querySelectorAll("[keyboard-selectable-child='true']");e.length&&this.focusNextItem(e)}else if("ArrowLeft"==i||"Left"==i){const t=this.findFocused(s)[0];if(!t)return;const e=t.querySelectorAll("[keyboard-selectable-child='true']");e.length&&!this.focusNextItem(e,!0)&&(this.removeFocused(e),this.focusItem(t))}return!0}}focusItem(t){this.scrollToElement(t),super.focusItem(t)}onKeyboardDeselection(){this.keyboardNavigation&&null!==this.keyboardNavigation&&this.keyboardNavigation.highlightPosition()}resize(){var t=this.node,i=e.UI.getMyContext(this);if(!t.parents(".sharing").length&&!this.hasAttribute("cq-no-resize")){this.hasAttribute("cq-no-maximize")&&(this.noMaximize=!0);var n=this.getBoundingClientRect();if(n.height){var s,o,a=this.reduceMenuHeight||45;if(i&&i.topNode){var r=(i.topNode.multiChartContainer||i.topNode).getBoundingClientRect();s=r.height,o=r.top}else s=window.innerHeight,o=0;if(s){var c=s-(n.top-o)-a,l=t.parents(".stx-holder,.stx-subholder,.chartContainer");l.length&&l.each((function(){var t=this.getBoundingClientRect().top+e.elementDimensions(this).height;c=Math.min(c,t-n.top-5)}));for(var h=t.nextAll(),d=0;d<h.length;d++){var u=h[d];u&&!e.trulyVisible(u)||(c-=e.elementDimensions(u,{border:1,padding:1,margin:1}).height)}if(this.maxHeight&&this.maxHeight<c&&(c=this.maxHeight),this.noMaximize||t.css({height:c+"px"}),this.hasAttribute("cq-drop-up-menu")){const e=+this.style.bottom.replace("px",""),i=Math.min(n.top-o-a+e-4,25);t.css({bottom:i+"px"})}t.css({"max-height":c+"px"}),this.refresh()}}}}scrollToElement(t){var e=this.clientHeight,i=this.scrollTop,n=t.offsetTop+t.clientHeight;t.offsetTop>i&&n<e+i||(this.scrollTop=Math.max(n-e,0),this.refresh())}top(){this.scrollTop=0,this.refresh()}scrollToTop(){this.top()}refresh(){e.UI.scrollbarStyling&&e.UI.scrollbarStyling.refresh(this)}}e.UI.addComponentDefinition("cq-scroll",i)},at=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}setContext(){this.addDefaultMarkup(),e.safeClickTouch(this,(()=>this.tap()))}tap(t){const{context:e}=this;if(e.config)this.channelWrite(e.config.channels.dialog,{type:"share",params:{context:e}},e.stx);else{const t=this.ownerDocument.querySelector("cq-share-dialog");t&&t.open&&t.open({context:e})}}}i.markup="<div>Share</div>",e.UI.addComponentDefinition("cq-share-button",i)},rt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;if(e.Share){class t extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,t),this.constructor=t}open(t){this.addDefaultMarkup(),this.setState("share-create"),super.open(t)}close(){this.setState("share-create"),super.close()}setState(t){if(this.addDefaultMarkup(),this.node.find("div[cq-share-dialog-div]")[0].className=t,this.ownerDocument.body.keystrokeHub){let{tabActiveModals:t}=this.ownerDocument.body.keystrokeHub;t[0]&&this.ownerDocument.body.keystrokeHub.setKeyControlElement(t[0])}}share(){var t=this.context.stx,i=this;i.setState("share-generate");var n=this.ownerDocument.querySelector("cq-share-dialog .share-link-div");if(n&&(n.innerHTML=""),e.UI.bypassBindings=!0,e.Share.createImage(t,{hide:[".stx_chart_controls",".stx-btn-panel",".stx_jump_today",".stx-baseline-handle",".ciq-edit",".ciq-close","cq-marker-label"]},(function(s){e.UI.bypassBindings=!1;var o=e.uniqueID(),a="https://share.chartiq.com",r=t.getStartDateOffset(),c={layout:t.exportLayout(),drawings:t.exportDrawings(),xOffset:r,startDate:t.chart.dataSegment[r].Date,endDate:t.chart.dataSegment[t.chart.dataSegment.length-1].Date,id:o,symbol:t.chart.symbol},l=a+"/upload/"+o,h={id:o,image:s,config:c};i.setState("share-upload"),e.Share.uploadImage(s,l,h,(function(t,s){null!==t?e.alert("error: "+t):(n&&(n.innerHTML=a+s),i.setState("share-copy"))}))})),this.ownerDocument.body.keystrokeHub){let{tabActiveModals:t}=this.ownerDocument.body.keystrokeHub;t[0]&&this.ownerDocument.body.keystrokeHub.setKeyControlElement(t[0])}}copy(){var t=this.ownerDocument.querySelector("cq-share-dialog .share-link-div");if(t){var i=t.innerText,n=document.createElement("input");if(n.type="text",n.value=i,n.contentEditable=!0,n.readOnly=!0,this.ownerDocument.body.appendChild(n),n.focus(),n.select(),!e.isIE){var s=document.createRange();s.selectNodeContents(n);var o=window.getSelection();o.removeAllRanges(),o.addRange(s),n.setSelectionRange(0,i.length)}this.ownerDocument.execCommand("copy"),this.ownerDocument.body.removeChild(n),this.setState("share-copied")}}}t.markup='\n\t\t<h4 class="title">Share Your Chart</h4>\n\t\t<cq-close></cq-close>\n\t\t<div cq-share-dialog-div>\n\t\t\t<cq-separator></cq-separator>\n\t\t\t<cq-share-create class="ciq-btn" stxtap="share()">Create Image</cq-share-create>\n\t\t\t<cq-share-generating>Generating Image</cq-share-generating>\n\t\t\t<cq-share-uploading>Uploading Image</cq-share-uploading>\n\t\t\t<div class="share-link-div"></div>\n\t\t\t<cq-share-copy class="ciq-btn" stxtap="copy()">Copy Link to Clipboard</cq-share-copy>\n\t\t\t<cq-share-copied>Link Copied!</cq-share-copied>\n\t',e.UI.addComponentDefinition("cq-share-dialog",t)}else console.error("shareDialog component requires first activating share feature.")},ct=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}set(t,e,i,n,s,o){var a=this;a.context.loader&&a.context.loader.show();var r={multiplier:e,base:i,padding:40};n&&(r.periodicity={interval:n,period:s||1,timeUnit:o}),a.context.stx.setSpan(r,(function(){a.context.loader&&a.context.loader.hide()}))}setContext(t){const e=t.config&&t.config.getMenu("rangeMenu");this.addDefaultMarkup(this,e&&e.join(""))}}i.markup='\n\t\t<div stxtap="set(1,\'today\');">1D</div>\n\t\t<div stxtap="set(5,\'day\',30,2,\'minute\');">5D</div>\n\t\t<div stxtap="set(1,\'month\',30,8,\'minute\');">1M</div>\n\t\t<div class="hide-sm" stxtap="set(3,\'month\');">3M</div>\n\t\t<div class="hide-sm" stxtap="set(6,\'month\');">6M</div>\n\t\t<div class="hide-sm" stxtap="set(1,\'YTD\');">YTD</div>\n\t\t<div stxtap="set(1,\'year\');">1Y</div>\n\t\t<div class="hide-sm" stxtap="set(5,\'year\',1,1,\'week\');">5Y</div>\n\t\t<div class="hide-sm" stxtap="set(1,\'all\');">All</div>\n\t',e.UI.addComponentDefinition("cq-show-range",i)},lt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}setContext({config:{channels:t={}}={},stx:e}){const i=this.querySelector("div"),n=this.getAttribute("cq-on")||"sidenavOn",s=this.getAttribute("cq-off")||"sidenavOff",o=t.breakpoint||"channel.breakpoint",a=t.sidenav||"layout.sidenav",r=t.sidenavSize||"channel.sidenavSize",c=t.tfc||"channel.tfc",l=()=>{const t=this.channelRead(o);let e="break-sm"===this.channelRead(o);"string"==typeof t&&t.includes("height")&&(e=i.classList.contains("sidenav"));const s=e&&this.channelRead(a)===n;i.classList.remove("sidenav","ciq-toggles"),i.classList.add(e?"sidenav":"ciq-toggles"),i.classList[s?"add":"remove"]("active"),this.channelWrite(r,s?i.getBoundingClientRect().width:0)};this.channelSubscribe(a,l),this.channelSubscribe(o,l),this.channelSubscribe(c,(t=>{t&&this.channelWrite(a,s)}))}}e.UI.addComponentDefinition("cq-side-nav",i)},ht=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{constructor(){super(),this.callbacks=[]}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}setContext(t){const{config:e,stx:i}=t;if(!e)return;const{channels:n={}}=e,s=this.resizeMyself.bind(this),{node:o}=this;function a(){setTimeout(s)}this.channelSubscribe(n.breakpoint||"channel.breakpoint",a),this.channelSubscribe(n.tfc||"channel.tfc",(function(t){t?o.attr("cq-active",!0):o.removeAttr("cq-active");a()}),i)}close(){this.node.removeAttr("cq-active"),this.node.children().each((function(){this.sidePanelActiveClass?this.classList.remove(this.sidePanelActiveClass):this.removeAttribute(this.sidePanelActiveAttribute)}));var t=this;setTimeout((function(){t.resizeMyself()}),0)}nonAnimatedWidth(){var t=0;return Array.from(this.children).forEach((function(i){t+=e.elementDimensions(i).width})),t}open(t){this.close();var e=this.node.find(t.selector);t.className?(e.addClass(t.className),e.each((function(){this.sidePanelActiveClass=t.className}))):(e.attr(t.attribute,"true"),e.each((function(){this.sidePanelActiveAttribute=t.attribute}))),this.node.attr("cq-active","true");var i=this;setTimeout((function(){i.resizeMyself()}),0)}registerCallback(t){this.callbacks.push(t)}resizeMyself(){var t=this.nonAnimatedWidth();this.node.css({width:t+"px"});for(var e=0;e<this.callbacks.length;e++)this.callbacks[e].call(this,t);const{config:i,stx:n}=this.context||{};if(!i)return;const s=(i.channels||{}).sidepanelSize||"channel.sidepanelSize";this.channelWrite(s,t,n)}}e.UI.addComponentDefinition("cq-side-panel",i)},dt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}disconnectedCallback(){this.doNotDisconnect||(this.context&&(e.UI.unobserveProperty("studyLibraryHash",this.context.stx.chart,this.listener),this.context.stx.removeEventListener("preferences",this.listener)),super.disconnectedCallback())}initialize(t){this.addDefaultMarkup(),this.params=t||{},this.alwaysDisplayDialog=this.params.alwaysDisplayDialog||!1,this.excludedStudies=this.params.excludedStudies||[],this.params.template||(this.params.template="template"),this.params.template=this.node.find(this.params.template);const{stx:i}=this.context;this.listener=()=>this.renderMenu(i),e.UI.observeProperty("studyLibraryHash",i.chart,this.listener),i.addEventListener("preferences",this.listener),this.listener()}setContext({config:t}){t&&t.menuStudiesConfig&&this.initialize(Object.assign({},t.menuStudiesConfig))}renderMenu(t){if(!e.Studies)return;let i,n=[];for(let s in e.Studies.studyLibrary)i=e.Studies.studyLibrary[s],!i||this.excludedStudies[s]||this.excludedStudies[i.name]||void 0!==i.siqList||(i.name||(i.name=s),n.push([s,t.translateIf(i.name)]));n.sort((function(e,i){return e[1].localeCompare(i[1],t.locale||"en",{sensitivity:"base",caseFirst:"upper"})}));const s=this.node,o=this,a=function(t,i){return function(i){if(i.target.classList.contains("ciq-info-btn"))return o.showStudyInfo&&o.showStudyInfo(t),void i.stopPropagation();!function(t,i){const{alwaysDisplayDialog:n={},context:{stx:s}}=o;function a(t,e,n){if(!0===t)return l(e,n),!0;if("object"==typeof t)for(let s in t)if(s==i&&t[s])return l(e,n),!0}if(a(o.params.dialogBeforeAddingStudy,{stx:s,name:i},!0))return;const r=n[i]?{interactiveAdd:!1}:null,c=e.Studies.addStudy(s,i,null,null,r);a(o.alwaysDisplayDialog,{sd:c,stx:s})}(i.target,t),o.dispatchEvent(new Event("resize"))}},r=s.find("cq-studies-content");for(;r.length>0&&r[0].firstChild;)r[0].removeChild(r[0].firstChild);const c=this.hasAttribute("ciq-favorites");function l(t,e){const{context:i}=o;if(i.config)o.channelWrite(i.config.channels.dialog,{type:"study",params:Object.assign({},t,{context:i,addWhenDone:e})},i.stx);else{t.context=o.context;const i=o.ownerDocument.querySelector("cq-study-dialog");i.addWhenDone=e,i.open(t)}}n.forEach((function(n){const r=e.UI.makeFromTemplate(o.params.template);i=e.Studies.studyLibrary[n[0]];const l=r.find("span")[0];e.makeTranslatableElement(l||r[0],t,i.name),r[0].type=n[0];const h=r.find(".fav-marker")[0];h&&(c?e.safeClickTouch(h,function(t,i){return i=>{const n=i.target.parentElement,s=n.classList.contains("ciq-favorite");n.classList.add(s?"ciq-move-down":"ciq-move-up"),setTimeout((()=>{n.classList[s?"remove":"add"]("ciq-favorite"),e.Studies.Favorites[s?"remove":"add"](t.name),o.updateOrder()}),500)}}(i)):h.remove()),o.makeTap(r[0],a(n[0],o.context));const d=r.find(".ciq-info-btn")[0];!d||e.Studies.Info&&e.Studies.Info[i.name]||(d.style.display="none"),s.find("cq-studies-content").append(r)})),c&&this.updateOrder()}updateOrder(){const{stx:t}=this.context;e.Studies.Favorites.retrieveList(t,(e=>{const i=this.hasAttribute("ciq-favorites"),n=Array.from(this.querySelectorAll("cq-item")),s=e.filter((({isCustomized:t})=>!t)).reduce(((t,{type:e})=>({...t,[e]:!0})),{}),o=this.querySelector("cq-studies-content");n.sort((({textContent:e,type:n},{textContent:o,type:a})=>{if(i){if(s[n]&&!s[a])return-1;if(!s[n]&&s[a])return 1}return e.localeCompare(o,t.locale||"en",{sensitivity:"base",caseFirst:"upper"})})).forEach((t=>{t.classList[s[t.type]?"add":"remove"]("ciq-favorite"),t.classList.remove("ciq-move-up"),t.classList.remove("ciq-move-down"),o.append(t)}))}))}}i.markup="\n\t\t<template>\n\t\t\t<cq-item></cq-item>\n\t\t</template>\n\t\t<cq-studies-content></cq-studies-content>\n\t",e.UI.addComponentDefinition("cq-studies",i)},ut=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}setContext(t){let e=this.constructor.markup;!!t.topNode.querySelector(".ciq-sb-container")||(e=e.split(/\n/g).filter((t=>!/StudyEdit\.addToFavorites/i.test(t))).join("\n")),this.addDefaultMarkup(this,e),this.classList.add("ciq-context-menu"),super.setContext(t)}}i.markup='\n\t\t<div stxtap="StudyEdit.edit()">Edit Settings...</div>\n\t\t<div stxtap="StudyEdit.addToFavorites()">Add to Favorites</div>\n\t\t<div stxtap="StudyEdit.remove()">Delete Study</div>\n\t',e.UI.addComponentDefinition("cq-study-context",i)},pt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;if(e.Studies){class t extends e.UI.DialogContentTag{connectedCallback(){this.attached||(super.connectedCallback(),this.queuedUpdates={})}close(){if(this.addWhenDone){var t=this.helper,i=e.Studies.addStudy(t.stx,t.name);e.isEmpty(this.queuedUpdates)||(t.sd=i,t.updateStudy(this.queuedUpdates),this.queuedUpdates={})}}closeActiveMenu(t){const i=this.ownerDocument.body.keystrokeHub,n=this.querySelector("*.stxMenuActive"),s=e.UI.getUIManager(this);n&&i&&i.tabActiveElement&&i.tabActiveElement.element===t&&(i.tabActiveElement=null,i.highlightHide(),s.closeMenu(n))}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,t),this.constructor=t}disconnectedCallback(){e.UI.unobserveProperty("signal",this.helper),super.disconnectedCallback()}formatDateInput(t){return(t=t.replace(/-/g,"")).search(/^\d{8}$/)||(t=t.substring(0,4)+"-"+t.substring(4,6)+"-"+t.substring(6,8)),t}formatTimeInput(t){return(t=t.replace(/:/g,"")).search(/^\d{4,6}$/)||(t=t.substring(0,2)+":"+t.substring(2,4)+(4==t.length?"":":"+t.substring(4,6))),t}hide(){e.isEmpty(this.queuedUpdates)||(this.helper.updateStudy(this.queuedUpdates),this.queuedUpdates={}),this.node.find("cq-menu").each((function(){this.unlift&&this.unlift()})),this.node.find("cq-swatch").each((function(){this.colorPicker&&this.colorPicker.close()}))}makeMenu(t,i,n,s){var o=e.UI.makeFromTemplate(this.menuTemplate),a=o.find("cq-menu-dropdown");for(var r in n){var c=document.createElement("cq-item");c.innerText=n[r],c.setAttribute("stxtap","StudyDialog.setSelectOption('"+s+"')"),a.append(c),c.cqMenuWrapper=a.parents("cq-menu")[0],c.setAttribute("name",t),c.setAttribute("value",r),c.context=this.context}return o.find("cq-selected").text(this.helper.stx.translateIf(i)),o[0]}open(t){this.addDefaultMarkup(),this.selectTemplates(),super.open(t),"axisSelect"in t||(t.axisSelect=this.getAttribute("cq-study-axis"),""===t.axisSelect&&(t.axisSelect=!0)),"panelSelect"in t||(t.panelSelect=this.getAttribute("cq-study-panel"),""===t.panelSelect&&(t.panelSelect=!0)),void 0!==t.addWhenDone&&(this.addWhenDone=t.addWhenDone);var i=this;this.context.stx;e.UI.unobserveProperty("signal",this.helper),this.helper=new e.Studies.DialogHelper(t),e.UI.observeProperty("signal",this.helper,(function(e){i.refreshInputs(),i.refreshOutputs(),i.refreshParameters(t)})),this.node.find(".title").text(this.helper.title),this.refreshInputs(!0),this.refreshOutputs(!0),this.refreshParameters(t,!0)}refreshInputs(t){var i=this.node.find("cq-study-inputs");t&&i.empty();for(var n=0;n<this.helper.inputs.length;n++){var s=this.helper.inputs[n],o=e.UI.makeFromTemplate(this.inputTemplate);this.menuTemplate=o.find("template[cq-menu]"),o.find(".ciq-heading").text(s.heading),o[0].setAttribute("fieldname",s.name);var a,r=null,c=this.helper.attributes[s.name];if("number"==s.type)for(a in(r=document.createElement("input")).setAttribute("type","number"),r.value=s.value,this.setChangeEvent(r,"inputs",s.name),c){var l=c[a];(e.isIE||e.isEdge)&&"step"==a&&Math.floor(l)!=l&&(l="any"),"hidden"!==a&&r.setAttribute(a,l)}else if("text"==s.type||"date"==s.type||"time"==s.type)for(a in(r=document.createElement("input")).setAttribute("type",e.UI.supportedInputType(s.type)),"date"==s.type?r.value=this.formatDateInput(s.value):"time"==s.type?r.value=this.formatTimeInput(s.value):r.value=s.value,this.setChangeEvent(r,"inputs",s.name),c)"hidden"!==a&&r.setAttribute(a,c[a]);else if("select"==s.type)r=this.makeMenu(s.name,s.value,s.options,"inputs"),c&&c.readonly&&r.setAttribute("readonly",c.readonly);else if("checkbox"==s.type)for(a in(r=document.createElement("input")).setAttribute("type","checkbox"),s.value&&(r.checked=!0),this.setChangeEvent(r,"inputs",s.name),c)"hidden"!==a&&r.setAttribute(a,c[a]);c&&c.hidden&&o.hide(),r&&o.find(".stx-data").append(r),o[0].originalOuterHTML=o[0].outerHTML;var h=i.find("[fieldname='"+s.name+"']");h.length?h[0].originalOuterHTML!==o[0].originalOuterHTML&&h[0].replaceWith(o[0]):i.append(o)}}refreshOutputs(t){var i=this.node.find("cq-study-outputs");t&&i.empty();for(var n=0;n<this.helper.outputs.length;n++){var s=this.helper.outputs[n],o=e.UI.makeFromTemplate(this.outputTemplate);o[0].initialize({studyDialog:this,output:s.name}),o.find(".ciq-heading").text(s.heading),o[0].setAttribute("fieldname",s.name);var a=o.find("cq-swatch"),r=s.color;"object"==typeof r&&(r=r.color),o[0].originalOuterHTML=o[0].outerHTML;var c=i.find("[fieldname='"+s.name+"']");c.length?c[0].originalOuterHTML!==o[0].originalOuterHTML&&c[0].replaceWith(o[0]):i.append(o),a[0].setColor(r,!1)}}refreshParameters(t,i){var n=this.node.find("cq-study-parameters");i&&n.empty();for(var s=0;s<this.helper.parameters.length;s++){var o=this.helper.parameters[s],a=e.UI.makeFromTemplate(this.parameterTemplate);if(this.menuTemplate=a.find("template[cq-menu]"),this.menuTemplate.length||!o.options){a.find(".ciq-heading").text(o.heading),a[0].setAttribute("fieldname",o.name);var r,c=a.find("cq-swatch"),l=document.createElement("input"),h=!1,d={};if(o.defaultValue.constructor==Boolean)for(r in l.setAttribute("type","checkbox"),o.value&&(l.checked=!0),this.setChangeEvent(l,"parameters",o.name+"Enabled"),c.remove(),d=this.helper.attributes[o.name+"Enabled"])"hidden"!==r&&l.setAttribute(r,d[r]);else if(o.defaultValue.constructor==String){var u=o.name;for(r in o.defaultColor?(a[0].initialize({studyDialog:this,parameter:o.name+"Color",params:t}),h=!0,u+="Value"):c.remove(),o.options?l=this.makeMenu(u,o.value,o.options,"parameters"):l.value=o.value,d=this.helper.attributes[u])"hidden"!==r&&l.setAttribute(r,d[r])}else{if(o.defaultValue.constructor!=Number)continue;for(r in l.setAttribute("type","number"),l.value=o.value,this.setChangeEvent(l,"parameters",o.name+"Value"),a[0].initialize({studyDialog:this,parameter:o.name+"Color",params:t}),h=!0,d=this.helper.attributes[o.name+"Value"]){var p=d[r];(e.isIE||e.isEdge)&&"step"==r&&Math.floor(p)!=p&&(p="any"),"hidden"!==r&&l.setAttribute(r,p)}}d&&d.hidden&&a.not("hr").hide(),a.find(".stx-data").append(l),a[0].originalOuterHTML=a[0].outerHTML;var m=n.find("[fieldname='"+o.name+"']");m.length?m[0].originalOuterHTML!==a[0].originalOuterHTML&&m[0].replaceWith(a[0]):n.append(a),h&&c[0].setColor(o.color,!1)}else a.remove()}}setChangeEvent(t,e,i){var n=this;t.addEventListener("change",(function(){var t={};t[e]={},t[e][i]=this.value,"checkbox"!=this.type&&"radio"!=this.type||(t[e][i]=this.checked),n.updateStudy(t)}))}setContext(t){this.context=t,t.advertiseAs(this,"StudyDialog")}setSelectOption(t,i){var n=e.UI.$(t.node),s=n.attr("name"),o=n.attr("value"),a=n[0].cqMenuWrapper;a.fieldValue=o;var r=a.querySelector("cq-selected");r&&(r.innerText=this.helper.stx.translateIf(o)),i||(i="inputs");var c={};c[i]={},c[i][s]=o,this.closeActiveMenu(n[0]),this.updateStudy(c)}updateStudy(t){this.node.find(":invalid").length||(this.addWhenDone?e.extend(this.queuedUpdates,t):this.helper.libraryEntry.deferUpdate?(e.extend(this.queuedUpdates,{inputs:t.inputs}),this.helper.updateStudy({outputs:t.outputs,parameters:t.parameters})):this.helper.updateStudy(t))}selectTemplates(){this.inputTemplate||(this.inputTemplate=this.querySelector("template[cq-study-input]"),this.outputTemplate=this.querySelector("template[cq-study-output]"),this.parameterTemplate=this.querySelector("template[cq-study-parameters]"))}}t.markup='\n\t\t<h4 class="title">Study here</h4>\n\t\t<cq-scroll cq-no-maximize>\n\t\t\t<cq-study-inputs>\n\t\t\t\t<template cq-study-input>\n\t\t\t\t\t<cq-study-input>\n\t\t\t\t\t\t<div class="ciq-heading"></div>\n\t\t\t\t\t\t<div class="stx-data">\n\t\t\t\t\t\t\t<template cq-menu>\n\t\t\t\t\t\t\t\t<cq-menu class="ciq-select">\n\t\t\t\t\t\t\t\t\t<cq-selected></cq-selected>\n\t\t\t\t\t\t\t\t\t<cq-menu-dropdown cq-lift></cq-menu-dropdown>\n\t\t\t\t\t\t\t\t</cq-menu>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</cq-study-input>\n\t\t\t\t\t<hr>\n\t\t\t\t</template>\n\t\t\t</cq-study-inputs>\n\t\t\t<cq-study-outputs>\n\t\t\t\t<template cq-study-output>\n\t\t\t\t\t<cq-study-output>\n\t\t\t\t\t\t<div class="ciq-heading"></div>\n\t\t\t\t\t\t<cq-swatch cq-overrides="auto"></cq-swatch>\n\t\t\t\t\t</cq-study-output>\n\t\t\t\t\t<hr>\n\t\t\t\t</template>\n\t\t\t</cq-study-outputs>\n\t\t\t<cq-study-parameters>\n\t\t\t\t<template cq-study-parameters>\n\t\t\t\t\t<cq-study-parameter>\n\t\t\t\t\t\t<div class="ciq-heading"></div>\n\t\t\t\t\t\t<div class="stx-data"><cq-swatch cq-overrides="auto"></cq-swatch>\n\t\t\t\t\t\t\t<template cq-menu>\n\t\t\t\t\t\t\t\t<cq-menu class="ciq-select">\n\t\t\t\t\t\t\t\t\t<cq-selected></cq-selected>\n\t\t\t\t\t\t\t\t\t<cq-menu-dropdown cq-lift></cq-menu-dropdown>\n\t\t\t\t\t\t\t\t</cq-menu>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</cq-study-parameter>\n\t\t\t\t\t<hr>\n\t\t\t\t</template>\n\t\t\t</cq-study-parameters>\n\t\t</cq-scroll>\n\t\t<div class="ciq-dialog-cntrls">\n\t\t\t<div class="ciq-btn" stxtap="close()">Done</div>\n\t\t</div>\n\t',e.UI.addComponentDefinition("cq-study-dialog",t)}else console.error("studyDialog component requires first activating studies feature.")},mt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.DialogContentTag{}e.UI.addComponentDefinition("cq-study-input",i)},gt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;if(e.Studies){class t extends e.UI.ModalTag{connectedCallback(){this.attached||(super.connectedCallback(),this.hasAttribute("cq-no-claim")||this.addClaim(this),this.context&&this.context.config&&this.context.config.channels&&this.channelWrite(this.context.config.channels.keyboardNavigation||"channel.keyboardNavigation",{action:"registerElements"}))}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,t)}disconnectedCallback(){this.doNotDisconnect||(this.context&&this.context.config&&this.context.config.channels&&this.channelWrite(this.context.config.channels.keyboardNavigation||"channel.keyboardNavigation",{action:"registerElements"}),this.setActiveState(!1),this.removeClaim(this),super.disconnectedCallback())}begin(){if(!this.init){var t=this.context.stx,i=this.node;this.template=i.find("template[cq-study-legend]"),this.template.length||(this.template=i.find("template")),this.contentKeys=i.attr("cq-content-keys")||"cq-label",this.eventListeners.push(t.addEventListener("layout",this.renderLegend.bind(this)),t.addEventListener("theme",this.renderLegend.bind(this))),this.hasAttribute("cq-marker")&&(this.setAttribute("chart-legend",""),e.UI.stxtap(this,(function(){this.setActiveState()}))),this.renderLegend(),this.init=!0}}setActiveState(t){let e=this.classList.contains("ciq-active");t=void 0===t?!e:t;const i=this.ownerDocument.body.keystrokeHub;t?(this.classList.add("ciq-active"),i&&this.keyboardNavigation&&i.addActiveModal(this)):(this.classList.remove("ciq-active"),i&&i.removeActiveModal(this))}keyStroke(t,e,i){if(!this.keyboardNavigation)return;const n=this.querySelectorAll("[keyboard-selectable='true'], cq-item:not(.item-hidden), cq-comparison-item");if(" "==e||"Spacebar"==e||"Enter"==e){const t=this.findFocused(n);if(!t||!t.length)return;const e=t[0].querySelector("[keyboard-selectable-child='true'][cq-focused]");if(e)this.storeFocused(t,e),this.clickItem(e,i);else{const e=t[0].querySelector("cq-swatch");e?this.clickItem(e,i):this.clickItem(t[0],i)}}else if("ArrowDown"==e||"Down"==e)this.focusNextItem(n);else if("ArrowUp"==e||"Up"==e)this.focusNextItem(n,!0);else if("ArrowRight"==e||"Right"==e){const t=this.findFocused(n);if(!t||!t.length)return;const e=t[0].querySelectorAll("[keyboard-selectable-child='true']");e.length&&this.focusNextItem(e)}else if("ArrowLeft"==e||"Left"==e){const t=this.findFocused(n)[0];if(!t)return;const e=t.querySelectorAll("[keyboard-selectable-child='true']");e.length&&!this.focusNextItem(e,!0)&&(this.removeFocused(e),this.focusItem(t))}else if("Tab"===e||"Esc"===e||"Escape"===e){this.removeFocused(n),this.setActiveState(!1);const t=this.ownerDocument.body.keystrokeHub;t&&t.tabOrderSelect()}}storeFocused(t,e){let i=t[0].querySelector("cq-label")||t[0];const n=e.classList.contains("ciq-switch");n||(i="TEMPLATE"!==t[0].previousElementSibling.nodeName&&t[0].previousElementSibling||t[0].nextElementSibling,i&&i.querySelector("cq-label")&&(i=i.querySelector("cq-label"))),i&&(this.clickedItem={name:i.textContent.trim(),isSwitch:n,ms:+new Date})}launchColorPicker(){this.setActiveState(!0)}renderLegend(){var t=this.context.stx;function i(t,i){return function(n){n.stopPropagation(),setTimeout((function(){i.permanent||e.Studies.removeStudy(t.context.stx,i),t.node[0].hasAttribute("cq-marker")&&t.context.stx.modalEnd(),t.renderLegend()}),0)}}function n(e,i){return function(n){var s=t.layout.studies[i];if(!s.permanent&&s.editFunction){n.stopPropagation(),e.uiManager.closeMenu();var o=e.context.getAdvertised("StudyEdit"),a={stx:t,sd:s,inputs:s.inputs,outputs:s.outputs,parameters:s.parameters};o.editPanel(a)}else t.dispatch("notification","studynoteditable")}}this.template.nextAll().remove();var s=this.hasAttribute("cq-overlays-only"),o=this.hasAttribute("cq-panel-only"),a=this.hasAttribute("cq-custom-removal-only"),r=this.hasAttribute("cq-signal-studies-only"),c=this.node.attr("cq-marker-label"),l=!1,h=null,d=this.node.parents(".stx-holder")[0];d&&(h=d.panel.name);var u=this.closest("cq-context");if(u&&u.hasAttribute("ciq-native-mobile")&&(l=!0),e.Studies)for(var p in t.layout.studies){var m=t.layout.studies[p];if(!m.customLegend&&((!a||m.study.customRemoval)&&(!o||m.panel==h)&&(!s||m.overlay||m.underlay)&&(d&&"chart"!==h||!e.xor(r,m.signalData)))){var g=e.UI.makeFromTemplate(this.template,!0),f=g.find("cq-label");f.html(m.inputs.display),f[0].setAttribute("title",m.inputs.display);var v=function(t,e){return i=>{t.toggleDisabledState(e),e.changeOccurred("layout"),i.target.parentElement.classList[t.disabled?"remove":"add"]("ciq-active")}};!m.signalData&&d&&g[0].insertAdjacentHTML("afterbegin",k(m));var b=document.createElement("span");b.className="ciq-switch",b.setAttribute("keyboard-selectable-child","true"),m.disabled||g.addClass("ciq-active"),e.safeClickTouch(b,v(m,t)),d?g[0].insertBefore(b,g[0].firstElementChild):g.append(b),this.clickedItem&&+new Date-this.clickedItem.ms<100&&this.clickedItem.name.replace(/\u200C/g,"")===m.inputs.display.replace(/\u200C/g,"")&&(this.focusItem(g[0]),this.clickedItem.isSwitch&&this.focusItem(b));var y=g.find(".ciq-close");y.length&&(m.permanent?y.hide():(y[0].setAttribute("keyboard-selectable-child","true"),e.UI.stxtap(y[0],i(this,m))));var q=g.find(".ciq-edit")[0];if(!q||!m.permanent&&m.editFunction){var x=q||g[0];e.UI.stxtap(x,l?v(m,t):n(this,p))}else q.style.visibility="hidden";e.isMobile&&(e.UI.stxtap(g.find(".ciq-legend-color")[0],(()=>{})),e.UI.stxtap(g.find("cq-label")[0],(()=>{}))),this.setPanelLegendWidth()}}if(void 0!==c&&!this.node.find("cq-marker-label").length){var C=document.createElement("cq-marker-label");C.innerText=c,this.insertBefore(C,this.firstChild)}function k(e){var i=Object.values(e.outputs);i.length;return t.defaultColor||t.getDefaultColor(),`<div class="ciq-legend-color">${i.slice(0,3).map(((e,i)=>{const n=e.color||e;return`<span style="background: ${"auto"===n?t.defaultColor:n};"></span>`})).join("")}</div>`}this.displayLegendTitle()}displayLegendTitle(){var t,e;function i(t){for(;t;){if("template"===t.nodeName.toLowerCase())return!1;t=t.parentElement}return!0}t=this,e=this.contentKeys,Array.from(t.querySelectorAll(e)).some(i)?(this.node.css("display",""),this.node.parents("div.stx-panel-legend").css("width","")):(this.node.css("display","none"),this.node.parents("div.stx-panel-legend").css("width","0px")),this.context.stx.translateUI&&this.context.stx.translateUI(this.node[0])}setContext(t){if(!this.init){var e=this;this.parentElement&&(void 0!==this.node.attr("cq-clone-to-panels")&&(e.closest("cq-context").classList.add("stx-panel-legend"),e.spawnPanelLegend(),this.addInjection("append","stackPanel",(function(t,i){e.spawnPanelLegend()}))),this.begin())}}changeContext(t){if(!this.init)return this.context=t,void this.setContext(t);this.eventListeners.forEach((t=>{this.context.stx.removeEventListener(t)})),this.eventListeners=[t.stx.addEventListener("layout",this.renderLegend.bind(this)),t.stx.addEventListener("theme",this.renderLegend.bind(this))],this.context=t,this.renderLegend()}spawnPanelLegend(){var t=this.context.stx;function i(t){return function(e){t.setActiveState()}}for(var n in t.panels)if(n!=t.chart.panel.name){var s=t.panels[n].subholder.querySelector(".stx-panel-legend");if(s){var o=s.querySelector(this.nodeName);if(!o){if(this.ownerDocument!==document){const t=document.createElement("template");t.innerHTML=this.outerHTML,document.body.append(t),o=e.UI.makeFromTemplate(t)[0],t.remove()}else o=this.cloneNode(!0);o.setAttribute("cq-marker-label",this.getAttribute("cq-clone-to-panels")),o.removeAttribute("cq-clone-to-panels"),o.removeAttribute("cq-overlays-only"),o.removeAttribute("cq-marker"),e.UI.stxtap(o,i(o));var a=o.querySelector("cq-marker-label");a&&a.remove();var r=document.createElement("cq-study-legend-fixed-wrapper");r.appendChild(o),s.appendChild(r),o.begin()}}}}setPanelLegendWidth(){if("cq-study-legend-fixed-wrapper"!==this.parentElement.tagName.toLowerCase())return;const t=this.node.parents("div.stx-panel-control")[0],e=t.querySelector(".stx-btn-panel.stx-show")||null,i=e?e.offsetLeft:null,n=t.lastChild||null,s=n?`${n.offsetLeft+n.offsetWidth}px`:null,o=e=>{t.querySelectorAll(".stx-btn-panel.stx-show").forEach((t=>t.firstChild.classList[e?"remove":"add"]("stx-ico-bg")))};i&&i<=208?(o(!0),this.nextSibling&&this.nextSibling.classList.contains("stx-btn-bg")?this.nextSibling.style=`width: ${s}`:this.insertAdjacentHTML("afterend",`<span class="stx-btn-bg" style="width: ${s};">`)):o(!1)}}e.UI.addComponentDefinition("cq-study-legend",t)}else console.error("studyLegend component requires first activating studies feature.")},ft=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}setContext(){e.Studies.Favorites?(this.addDefaultMarkup(this,this.constructor.studyBrowserMarkup),this.closest("cq-menu").classList.add("ciq-study-browser")):this.addDefaultMarkup()}}i.markup='\n\t<cq-study-legend cq-no-close>\n\t\t<cq-section-dynamic>\n\t\t\t<cq-heading>Current Studies</cq-heading>\n\t\t\t<cq-study-legend-content>\n\t\t\t\t<template cq-study-legend>\n\t\t\t\t\t<cq-item>\n\t\t\t\t\t\t<cq-label class="click-to-edit"></cq-label>\n\t\t\t\t\t\t<div class="ciq-icon ciq-close"></div>\n\t\t\t\t\t</cq-item>\n\t\t\t\t</template>\n\t\t\t</cq-study-legend-content>\n\t\t\t<cq-placeholder>\n\t\t\t\t<div stxtap="Layout.clearStudies()" class="ciq-btn sm" keyboard-selectable="true">Clear All</div>\n\t\t\t</cq-placeholder>\n\t\t</cq-section-dynamic>\n\t</cq-study-legend>\n\t<div class="scriptiq-ui">\n\t\t<cq-heading>ScriptIQ</cq-heading>\n\t\t\t<cq-item><cq-clickable cq-selector="cq-scriptiq-editor" cq-method="open">New Script</cq-clickable></cq-item>\n\t\t\t<cq-scriptiq-menu></cq-scriptiq-menu>\n\t\t<cq-separator></cq-separator>\n\t</div>\n\t<cq-heading cq-filter cq-filter-min="15">Studies</cq-heading>\n\t<cq-studies></cq-studies>\n\t',i.studyBrowserMarkup="\n\t<cq-study-browser></cq-study-browser>\n",e.UI.addComponentDefinition("cq-study-menu-manager",i)},vt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.BaseComponent{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}initialize(t){this.params=t}setColor(t){if(this.params){var e={outputs:{}};e.outputs[this.params.output]={},e.outputs[this.params.output].color=t,this.params.studyDialog.updateStudy(e)}}}e.UI.addComponentDefinition("cq-study-output",i)},bt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}initialize(t){this.params=t}setColor(t){if(this.params){var e={parameters:{}};e.parameters[this.params.parameter]=t,this.params.studyDialog.updateStudy(e)}}}e.UI.addComponentDefinition("cq-study-parameter",i)},yt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends HTMLElement{constructor(){super(),this.defaultColor=null}connectedCallback(){if(!this.attached)if(this.attached=!0,this.getAttribute("cq-static"))this.style.cursor="default";else{var t=this;e.UI.stxtap(this,(function(e){t.launchColorPicker(),e.stopPropagation()}))}}adoptedCallback(){e.UI.flattenInheritance(this,i)}getDefaultColor(){if(this.defaultColor)return this.defaultColor;var t=e.UI.getMyContext(this);return t?t.stx.defaultColor:"transparent"}setColor(t,i,n){var s=e.getBackgroundColor(this.parentNode),o=e.chooseForegroundColor(s),a=e.hsl(s);"auto"==t&&(n=!0),t||(t="transparent");var r=t;"auto"==t?r=this.getDefaultColor():0===t.indexOf("rgba(")&&(r=(r.split(",").slice(0,3).join(",")+")").replace(/rgba/,"rgb"));var c=e.hsl(r),l=e.isTransparent(t);this.style.background=this.value=r,n||Math.abs(a[2]-c[2])<.2||l?(this.style.border="solid "+o+" 1px",l&&(this.style.background="linear-gradient(to bottom right, transparent, transparent 49%, "+o+" 50%, transparent 51%, transparent)")):this.style.border="",n&&(s=e.chooseForegroundColor(r),this.style.background="linear-gradient(to bottom right, "+r+", "+r+" 49%, "+s+" 50%, "+s+")"),!1!==i&&e.UI.containerExecute(this,"setColor",t,this)}launchColorPicker(){e.UI.containerExecute(this,"launchColorPicker");var t=this.ownerDocument.querySelector("cq-color-picker");if(t){t.callback=function(t){return function(e){t.setColor(e,null)}}(this);var i=this.getAttribute("cq-overrides");i&&(i=i.split(",")),t.display({node:this,context:e.UI.getMyContext(this),overrides:i}),this.colorPicker=t}}}e.UI.addComponentDefinition("cq-swatch",i)},qt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;if(e.ThemeHelper){class t extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,t),this.constructor=t}applyChanges(){(this.context.topNode.getCharts?this.context.topNode.getCharts():[this.context.stx]).forEach((t=>{t&&(this.helper.update(t),t.changeOccurred("theme"))}))}close(){this.helper.settings=this.revert,this.applyChanges(),super.close()}open(t){this.addDefaultMarkup(),super.open(t);var i=t.themeName;this.initiatingMenu=t.initiatingMenu,this.context=t.context,this.helper=new e.ThemeHelper({stx:this.context.stx}),this.revert=e.clone(this.helper.settings);var n=this;function s(t,e,i,s){var o=n.node.find('cq-theme-piece[cq-piece="'+t+'"]');o.length&&(o[0].piece={obj:e,field:i},"color"==s&&o.find("cq-swatch")[0].setColor(e[i],!1))}var o=this.helper.settings;s("cu",o.chartTypes["Candle/Bar"].up,"color","color"),s("cd",o.chartTypes["Candle/Bar"].down,"color","color"),s("wu",o.chartTypes["Candle/Bar"].up,"wick","color"),s("wd",o.chartTypes["Candle/Bar"].down,"wick","color"),s("bu",o.chartTypes["Candle/Bar"].up,"border","color"),s("bd",o.chartTypes["Candle/Bar"].down,"border","color"),s("lc",o.chartTypes.Line,"color","color"),s("mb",o.chartTypes.Mountain,"basecolor","color"),s("mc",o.chartTypes.Mountain,"color","color"),s("bg",o.chart.Background,"color","color"),s("gl",o.chart["Grid Lines"],"color","color"),s("dd",o.chart["Grid Dividers"],"color","color"),s("at",o.chart["Axis Text"],"color","color"),i||(i="My Theme"),this.node.find("cq-action input").val(i)}save(){var t=this.node.find("cq-action input").val(),i={settings:e.clone(this.helper.settings),name:t,builtIn:null};e.UI.contextsForEach((function(){this.stx.updateListeners("theme")}),this);var n=this;this.ownerDocument.querySelectorAll("cq-themes").forEach((function(t){i.builtIn=t.currentLoadedBuiltIn,t.addCustom(i,n.initiatingMenu)})),super.close()}setValue(t,e,i){t[e]=i,this.applyChanges()}}t.markup='\n\t\t<h4 class="title">Create Custom Theme</h4>\n\t\t<cq-close></cq-close>\n\t\t<cq-scroll cq-no-maximize>\n\t\t\t<cq-section>\n\t\t\t\t<cq-placeholder>Candle Color\n\t\t\t\t\t<cq-theme-piece-container>\n\t\t\t\t\t\t<cq-theme-piece cq-piece="cu"><cq-swatch cq-overrides="Hollow"></cq-swatch></cq-theme-piece>\n\t\t\t\t\t\t<cq-theme-piece cq-piece="cd"><cq-swatch cq-overrides="Hollow"></cq-swatch></cq-theme-piece>\n\t\t\t\t\t</cq-theme-piece-container>\n\t\t\t\t</cq-placeholder>\n\t\t\t\t<cq-placeholder>Candle Wick\n\t\t\t\t\t<cq-theme-piece-container>\n\t\t\t\t\t\t<cq-theme-piece cq-piece="wu"><cq-swatch></cq-swatch></cq-theme-piece>\n\t\t\t\t\t\t<cq-theme-piece cq-piece="wd"><cq-swatch></cq-swatch></cq-theme-piece>\n\t\t\t\t\t</cq-theme-piece-container>\n\t\t\t\t</cq-placeholder>\n\t\t\t\t<cq-placeholder>Candle Border\n\t\t\t\t\t<cq-theme-piece-container>\n\t\t\t\t\t\t<cq-theme-piece cq-piece="bu"><cq-swatch cq-overrides="No Border"></cq-swatch></cq-theme-piece>\n\t\t\t\t\t\t<cq-theme-piece cq-piece="bd"><cq-swatch cq-overrides="No Border"></cq-swatch></cq-theme-piece>\n\t\t\t\t\t</cq-theme-piece-container>\n\t\t\t\t</cq-placeholder>\n\t\t\t\t<cq-separator></cq-separator>\n\t\t\t\t<cq-placeholder>Line/Bar Chart\n\t\t\t\t\t<cq-theme-piece-container>\n\t\t\t\t\t\t<cq-theme-piece cq-piece="lc"><cq-swatch></cq-swatch></cq-theme-piece>\n\t\t\t\t\t</cq-theme-piece-container>\n\t\t\t\t</cq-placeholder>\n\t\t\t\t<cq-separator></cq-separator>\n\t\t\t\t<cq-placeholder>Mountain Base\n\t\t\t\t\t<cq-theme-piece-container>\n\t\t\t\t\t\t<cq-theme-piece cq-piece="mb"><cq-swatch></cq-swatch></cq-theme-piece>\n\t\t\t\t\t</cq-theme-piece-container>\n\t\t\t\t</cq-placeholder>\n\t\t\t\t<cq-placeholder>Mountain Peak\n\t\t\t\t<cq-theme-piece-container>\n\t\t\t\t\t<cq-theme-piece cq-piece="mc"><cq-swatch></cq-swatch></cq-theme-piece>\n\t\t\t\t</cq-theme-piece-container>\n\t\t\t\t</cq-placeholder>\n\t\t\t</cq-section>\n\t\t\t<cq-section>\n\t\t\t\t<cq-placeholder>Background\n\t\t\t\t\t<cq-theme-piece-container>\n\t\t\t\t\t\t<cq-theme-piece cq-piece="bg"><cq-swatch></cq-swatch></cq-theme-piece>\n\t\t\t\t\t</cq-theme-piece-container>\n\t\t\t\t</cq-placeholder>\n\t\t\t\t<cq-placeholder>Grid Lines\n\t\t\t\t\t<cq-theme-piece-container>\n\t\t\t\t\t\t<cq-theme-piece cq-piece="gl"><cq-swatch></cq-swatch></cq-theme-piece>\n\t\t\t\t\t</cq-theme-piece-container>\n\t\t\t\t</cq-placeholder>\n\t\t\t\t<cq-placeholder>Date Dividers\n\t\t\t\t\t<cq-theme-piece-container>\n\t\t\t\t\t\t<cq-theme-piece cq-piece="dd"><cq-swatch></cq-swatch></cq-theme-piece>\n\t\t\t\t\t</cq-theme-piece-container>\n\t\t\t\t</cq-placeholder>\n\t\t\t\t<cq-placeholder>Axis Text\n\t\t\t\t\t<cq-theme-piece-container>\n\t\t\t\t\t\t<cq-theme-piece cq-piece="at"><cq-swatch></cq-swatch></cq-theme-piece>\n\t\t\t\t\t</cq-theme-piece-container>\n\t\t\t\t</cq-placeholder>\n\t\t\t</cq-section>\n\t\t\t<cq-action>\n\t\t\t\t<input><div stxtap="save()" class="ciq-btn">Save</div>\n\t\t\t</cq-action>\n\t\t</cq-scroll>\n\t',e.UI.addComponentDefinition("cq-theme-dialog",t)}else console.error("themeDialog component requires first activating theme feature.")},xt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.BaseComponent{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}setBoolean(t){e.UI.containerExecute(this,"setValue",this.piece.obj,this.piece.field,t)}setColor(t){"Hollow"!=t&&"No Border"!=t||(t="transparent",this.node.find("cq-swatch")[0].setColor("transparent",!1)),e.UI.containerExecute(this,"setValue",this.piece.obj,this.piece.field,t)}}e.UI.addComponentDefinition("cq-theme-piece",i)},Ct=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{connectedCallback(){this.attached||super.connectedCallback()}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}setContext({config:t}){if(!t)return;const{chartId:e,themes:{builtInThemes:i,defaultTheme:n}}=t,s=t.themes.nameValueStore||t.nameValueStore;this.initialize({builtInThemes:i,defaultTheme:n,nameValueStore:s,id:e})}addCustom(t,e){this.params.customThemes[t.name]=t,this.currentThemeSettings=t&&t.settings||t,e===this&&(this.currentTheme=t.name),this.configureMenu(),this.persist()}configureMenu(){function t(t,e){return function(i){t.loadBuiltIn(e),t.params.callback&&t.params.callback({theme:t.currentTheme}),t.persist("current")}}function i(t,e){return function(i){t.loadCustom(e),t.params.callback&&t.params.callback({theme:t.currentTheme}),t.persist("current")}}var n,s;this.builtInMenu.children(":not(template)").remove(),this.customMenu.children(":not(template)").remove();var o=this.params.builtInThemes;for(var a in o)n=o[a],(s=e.UI.makeFromTemplate(this.builtInTemplate)).text(n),this.makeTap(s[0],t(this,a)),this.builtInMenu.append(s);if(this.context.stx.translateUI&&this.context.stx.translateUI(this.builtInMenu[0]),this.customMenu.length&&this.customTemplate.length){var r=this.params.customThemes;for(var c in r)n=c,(s=e.UI.makeFromTemplate(this.customTemplate)).find("cq-label").text(n),this.makeTap(s.find("cq-item")[0],i(this,c)),s[0].close=function(t,e){return function(){t.removeTheme(e)}}(this,c),this.customMenu.append(s)}}initialize(t){if(this.initialized)return;this.initialized=!0,this.addDefaultMarkup(),this.selectTemplates(this),this.params={},t&&(this.params=t);e.ensureDefaults(this.params,{customThemes:{},builtInThemes:{},nameValueStore:e.NameValueStore&&new e.NameValueStore}),this.params.id&&(this.id="themes_"+this.params.id);let i=this,{nameValueStore:n}=this.params;n?("function"==typeof n&&(n=this.params.nameValueStore=new n),n.get("CIQ.Themes.prototype.custom",((t,e)=>{!t&&e&&(i.params.customThemes=e),n.get(i.id+"CIQ.Themes.prototype.current",((t,e)=>{!t&&e&&e.theme?i.loadTheme(e.theme):i.loadTheme(i.params.defaultTheme),i.configureMenu()}))}))):this.loadTheme(i.params.defaultTheme)}loadBuiltIn(t){this.currentLoadedBuiltIn&&this.removeThemeClass(this.currentLoadedBuiltIn),this.addThemeClass(t),this.currentLoadedBuiltIn=this.currentTheme=t,this.reinitializeChart()}loadCustom(t){this.currentLoadedBuiltIn&&this.removeThemeClass(this.currentLoadedBuiltIn);var e=this.params.customThemes[t];e.builtIn&&this.addThemeClass(e.builtIn),this.currentLoadedBuiltIn=e.builtIn,this.currentTheme=e.name,this.reinitializeChart(e)}loadTheme(t){this.params.customThemes[t]?this.loadCustom(t):this.params.builtInThemes[t]?this.loadBuiltIn(t):this.loadBuiltIn(this.params.defaultTheme)}get contextContainers(){const t=this.context.topNode;return[t].concat(Array.from(t.querySelectorAll("cq-context")))}addThemeClass(t){this.contextContainers.forEach((e=>e.classList.add(t))),this.context.topNode.setCurrentThemeClass=(e,i)=>{e.classList.add(t),i.setThemeSettings(this.currentThemeSettings)}}removeThemeClass(t){this.contextContainers.forEach((e=>e.classList.remove(t)))}newTheme(){const{context:t}=this;t.config?this.channelWrite(t.config.channels.dialog,{type:"theme",params:{context:t,initiatingMenu:this}},t.stx):document.querySelector("cq-theme-dialog").open({context:this.context,initiatingMenu:this})}persist(t){this.params.nameValueStore&&(t&&"current"!=t||this.params.nameValueStore.set(this.id+"CIQ.Themes.prototype.current",{theme:this.currentTheme}),t&&"custom"!=t||this.params.nameValueStore.set("CIQ.Themes.prototype.custom",this.params.customThemes))}removeTheme(t){var e=!1;this.ownerDocument.querySelectorAll("cq-themes").forEach((function(i){delete i.params.customThemes[t],i.configureMenu(),e||(i.persist(),e=!0)}))}selectTemplates(){this.builtInMenu||(this.builtInMenu=this.node.find("cq-themes-builtin"),this.builtInTemplate=this.builtInMenu.find("template"),this.customMenu=this.node.find("cq-themes-custom"),this.customTemplate=this.customMenu.find("template"))}reinitializeChart(t){const e=this.context.topNode.getCharts,{styles:i}=this.context.topNode;i?Object.values(i).forEach((t=>{for(let e in t)delete t[e]})):this.context.topNode.styles={};const n=e?this.context.topNode.getCharts():[this.context.stx];this.currentThemeSettings=t&&t.settings||t,n.forEach((e=>{e&&e.setThemeSettings&&e.setThemeSettings(t?t.settings:null)}))}}i.markup='\n\t\t<cq-themes-builtin cq-no-close>\n\t\t\t<template>\n\t\t\t\t<cq-item></cq-item>\n\t\t\t</template>\n\t\t</cq-themes-builtin>\n\t\t<cq-themes-custom cq-no-close>\n\t\t\t<template>\n\t\t\t\t<cq-theme-custom>\n\t\t\t\t\t<cq-item>\n\t\t\t\t\t\t<cq-label></cq-label>\n\t\t\t\t\t\t<cq-close keyboard-selectable-child="true"></cq-close>\n\t\t\t\t\t</cq-item>\n\t\t\t\t</cq-theme-custom>\n\t\t\t</template>\n\t\t</cq-themes-custom>\n\t\t<cq-item stxtap="newTheme()"><cq-plus></cq-plus>New Theme</cq-item>\n\t',e.UI.addComponentDefinition("cq-themes",i)},kt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;if(e.timeZoneMap){class t extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,t),this.constructor=t}open(t){this.addDefaultMarkup(),super.open(t);var i=this.node;this.context=t.context;var n=this.context.stx;function s(t){return function(i){var s=e.timeZoneMap[t];e.ChartEngine.defaultDisplayTimeZone=s,n.setTimeZone(n.dataZone,s),n.chart.symbol&&n.draw(),d()}}var o=i.find("ul, .ciq-ul"),a=i.find(".ciq-btn");for(var r in this.template||(this.template=o.find("li.timezoneTemplate")[0].cloneNode(!0)),o.empty(),e.timeZoneMap){var c=r,l=n.translateIf(c),h=this.template.cloneNode(!0);h.style.display="block",h.innerHTML=l,e.safeClickTouch(h,s(c)),o.append(h)}function d(){var t=i.find(".currentUserTimeZone");if(n.displayZone){var s=n.displayZone;for(var o in e.timeZoneMap)e.timeZoneMap[o]===n.displayZone&&(s=o);t.text(n.translateIf("Current Timezone is")+" "+n.translateIf(s)),a.show()}else t.text(n.translateIf("Your timezone is your current location")),a.hide()}d()}removeTimezone(){e.ChartEngine.defaultDisplayTimeZone=null;var t=this.context.stx;t.displayZone=null,t.setTimeZone(),t.displayInitialized&&t.draw(),this.close()}}t.markup='\n\t\t<h4 class="title">Choose Timezone</h4>\n\t\t<cq-close></cq-close>\n\n\t\t<p>To set your timezone use the location button below, or scroll through the following list...</p>\n\t\t<p class="currentUserTimeZone"></p>\n\t\t<div class="detect">\n\t\t\t<div class="ciq-btn" stxtap="removeTimezone()">Use My Current Location</div>\n\t\t</div>\n\t\t<div class="timezoneDialogWrapper" style="max-height:360px; overflow: hidden;">\n\t\t\t<cq-scroll cq-no-maximize class="ciq-ul" style="height:360px;">\n\t\t\t\t<li class="timezoneTemplate" style="display:none;cursor:pointer;"></li>\n\t\t\t</cq-scroll>\n\t\t</div>\n\t\t<div class="instruct">(Scroll for more options)</div>\n\t',e.UI.addComponentDefinition("cq-timezone-dialog",t)}else console.error("timezoneDialog component requires first activating timezone feature.")},It=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{constructor(){super(),this.params={member:null,obj:null,action:"class",value:"active",toggles:[],classes:{},callbacks:[]}}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}disconnectedCallback(){this.disconnectObservable(),super.disconnectedCallback()}disconnectObservable(){const{params:{member:t,obj:i},listener:n}=this;t&&i&&n&&e.UI.unobserveProperty(t,i,n)}begin(){const t=this;this.params.member&&(this.listener=function(e){t.updateFromBinding(t.params)},e.UI.observeProperty(t.params.member,t.params.obj,this.listener)),this.tapInitialized||(e.UI.stxtap(this,(function(){var e=t.params.toggles,i=t.params.obj;if(e.length>1){for(var n=0;n<e.length;n++){var s=e[n];if(t.currentValue==s){n<e.length-1?t.set(e[n+1]):t.set(e[0]);break}}n==e.length&&t.set(e[0])}else t.currentValue?t.set(!1):t.set(!0);const{stx:o}=this.context;o.draw(),i===o.layout&&o.changeOccurred("layout"),i===o.preferences&&o.changeOccurred("preferences")})),this.tapInitialized=!0)}registerCallback(t,e){!1!==e&&(e=!0),this.params.callbacks.push(t),e&&t.call(this,this.currentValue)}set(t){if(this.isInfoToggle)return this.parentElement.set(t);if(this.params.member){if(this.context&&this.context.topNode.getCharts&&this.hasAttribute("cq-multichart-distribute")){let e=this.context.topNode.getCharts(),i=null;this.params.obj===this.context.stx.layout&&(i="layout"),this.params.obj===this.context.stx.preferences&&(i="preferences"),i&&e.forEach((e=>{e[i][this.params.member]=t,e!==this.context.stx&&e.changeOccurred(i)}))}this.params.obj[this.params.member]=t}else{this.currentValue=t;for(var e=0;e<this.params.callbacks.length;e++)this.params.callbacks[e].call(this,this.currentValue)}this.updateClass()}setContext({config:t}){this.currentValue|=!1,this.params.obj=this.context.stx.layout;var e=this.node.attr("cq-member");if("headsUp"==e&&this.wrapInInfoToggle(),t&&t.channels&&t.channels[e]&&(e=t.channels[e]),e&&-1!==e.indexOf(".")){var i=e.split(".");this.params.obj=this.context.stx[i[0]],void 0===this.params.obj&&(this.context.stx[i[0]]=this.params.obj={}),e=i[1]}e&&(this.params.member=e);var n=this.node.attr("cq-action");n&&(this.params.action=n);var s=this.node.attr("cq-value");s&&(this.params.value=s);var o=this.node.attr("cq-toggles");o&&(this.params.toggles=o.split(","));for(var a=0;a<this.params.toggles.length;a++){var r=(o=this.params.toggles)[a];"null"===r?o[a]=null:"true"===r||"false"===r?o[a]="true"===r:isNaN(Number(r))||(o[a]=Number(r))}var c=this.node.attr("cq-toggle-classes");if(c){var l=c.split(/, |,/);this.params.removeClasses=c.split(/, | |,/).filter((t=>t)),this.params.classes=this.params.toggles.reduce((function(t,e,i){return t[e]=l[i].split(/ /),t}),{})}if(e&&void 0===this.params.obj[e]){const t=!(!o||!o.length)&&o[o.length-1];this.params.obj[e]=t}this.begin()}changeContext(t){this.disconnectObservable(),this.context=t,this.setContext(t)}updateFromBinding(t){if(this.currentValue=this.isInfoToggle?this.parentElement.getCurrentValue(t):t.obj[t.member],this.params.callbacks.length)for(var e=0;e<this.params.callbacks.length;e++)this.params.callbacks[e].call(this,this.currentValue);else"class"==this.params.action&&(this.currentValue?this.node.addClass(this.params.value):this.node.removeClass(this.params.value));this.updateClass(),"crosshair"==t.member&&!1===this.currentValue&&this.context.stx.doDisplayCrosshairs()}updateClass(){const{removeClasses:t,classes:e}=this.params;if(t&&void 0!==this.currentValue&&(this.classList.remove(...t),e[this.currentValue][0])){let t=e[this.currentValue];this.classList.add(...t)}}wrapInInfoToggle(){if(!this.closest("cq-info-toggle, cq-info-toggle-dropdown")){var t=document.createElement("cq-info-toggle");this.parentNode.replaceChild(t,this),t.appendChild(this)}}}e.UI.addComponentDefinition("cq-toggle",i)},wt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;if(e.Drawing){class t extends e.UI.ContextTag{connectedCallback(){this.attached||(super.connectedCallback(),this.params={toolSelection:this.node.find("*[cq-current-tool]"),lineSelection:this.node.find("*[cq-line-style]"),fontSizeSelection:this.node.find("*[cq-font-size]"),fontFamilySelection:this.node.find("*[cq-font-family]"),fontStyleToggle:this.node.find("cq-annotation-italic"),fontWeightToggle:this.node.find("cq-annotation-bold"),axisLabelToggle:this.node.find("cq-axis-label .ciq-checkbox"),fillColor:this.node.find("cq-fill-color").not("cq-cvp-controller"),lineColor:this.node.find("cq-line-color").not("cq-cvp-controller"),cvpControllers:this.node.find("cq-cvp-controller")},this.params.cvpControllers.prop("toolbar",this),this.noToolSelectedText="")}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,t)}clearDrawings(){this.context.stx.clearDrawings(null,!1)}crosshairs(t){var i=e.UI.$(t.node),n=this.context.stx;this.params.toolSelection.html(i.html()),n.changeVectorType(null),n.layout.crosshair=!0,n.doDisplayCrosshairs(),n.findHighlights(!1,!0),n.changeOccurred("layout"),n.draw(),n.updateChartAccessories(),this.node.find("*[cq-section]").removeClass("ciq-active"),this.emit()}defaultElements(t){var e=[];for(var i in t)"color"==i?e.push("cq-line-color"):"fillColor"==i?e.push("cq-fill-color"):"pattern"==i||"lineWidth"==i?e.push("cq-line-style"):"axisLabel"==i?e.push("cq-axis-label"):"font"==i?e.push("cq-annotation"):"parameters"==i&&e.push("cq-clickable");return e}dirty(t){this.node.find("*[cq-toolbar-dirty]")[!1===t?"removeClass":"addClass"]("ciq-active")}emit(){var t=new Event("change",{bubbles:!0,cancelable:!0});this.dirty(),this.dispatchEvent(t)}getFillColor(t){var i=e.UI.$(t.node),n=this.context.stx.currentVectorParameters.fillColor;"transparent"!=n&&"auto"!=n||(n=""),i.css({background:n});var s=e.getBackgroundColor(this.parentNode);if(n&&Math.abs(e.hsl(s)[2]-e.hsl(n)[2])<.2){var o=e.chooseForegroundColor(s);i.css({border:"solid "+o+" 1px"})}else i.css({border:""})}getLineColor(t){var i=e.UI.$(t.node),n=this.context.stx.currentVectorParameters.currentColor;"transparent"!=n&&"auto"!=n||(n=""),i.css({background:n});var s=e.getBackgroundColor(this.parentNode);if(!n||Math.abs(e.hsl(s)[2]-e.hsl(n)[2])<.2){var o=e.chooseForegroundColor(s);i.css({border:"solid "+o+" 1px"}),n||i.css({background:"linear-gradient(to bottom right, "+o+", "+o+" 49%, "+s+" 50%, "+s+")"})}else i.css({border:""})}noTool(){var t=this.context.stx;t.changeVectorType(""),t.layout.crosshair&&(t.layout.crosshair=!1,t.changeOccurred("layout"),t.doDisplayCrosshairs()),this.params.toolSelection.text(this.noToolSelectedText),this.params.toolSelection.attr("cq-current-tool",""),this.node.find("*[cq-section]").removeClass("ciq-active"),this.emit()}pickFillColor(t){var i=e.UI.$(t.node),n=this.ownerDocument.querySelector("cq-color-picker");if(n){var s=this;n.callback=function(t){s.context.stx.currentVectorParameters.fillColor=t,s.getFillColor({node:i}),s.emit()},n.display({node:i,context:this.context})}else console.log("DrawingToolbar.prototype.pickFillColor: no ColorPicker available")}pickLineColor(t){var i=e.UI.$(t.node),n=this.ownerDocument.querySelector("cq-color-picker");if(n){var s=this;n.callback=function(t){s.context.stx.currentVectorParameters.currentColor=t,s.getLineColor({node:i}),s.emit()};var o=i.attr("cq-overrides");o&&(o=o.split(",")),n.display({node:i,context:this.context,overrides:o})}else console.log("DrawingToolbar.prototype.pickLineColor: no ColorPicker available")}restoreDefaultConfig(t,i){var n=this.context.stx;e.Drawing.restoreDefaultConfig(n,n.currentVectorParameters.vectorType,i),this.node.find("*[cq-toolbar-action='restore']").removeClass("ciq-active"),this.sync(),this.dirty(!1)}saveConfig(){var t=this.context.stx;e.Drawing.saveConfig(t,t.currentVectorParameters.vectorType),this.node.find("*[cq-toolbar-action='restore']").addClass("ciq-active"),this.sync(),this.dirty(!1)}setFibs(t,e){var i=this.context.stx.currentVectorParameters.fibonacci;if(i){for(var n=0;n<i.fibs.length;n++)i.fibs[n].parameters.lineWidth=t,i.fibs[n].parameters.pattern=e;i.timezone.parameters.lineWidth=t,i.timezone.parameters.pattern=e}}setFontFamily(t,e){var i=this.context.stx;i.currentVectorParameters.annotation&&(i.currentVectorParameters.annotation.font.family="Default"==e?null:e),this.params.fontFamilySelection.text(e),this.emit()}setFontSize(t,e){var i=this.context.stx;i.currentVectorParameters.annotation&&(i.currentVectorParameters.annotation.font.size=e),this.params.fontSizeSelection.text(e),this.emit()}setContext(t){this.noToolSelectedText=this.params.toolSelection.text(),this.sync(),this.dirty(!1);var e=this;this.eventListeners.push(t.stx.addEventListener("theme",(function(t){var i=e.node.find("*[cq-toolbar-dirty]").hasClass("ciq-active");e.sync(),i||e.dirty(!1)})))}setLine(t,e,i){var n=this.context.stx;n.currentVectorParameters.lineWidth=e,n.currentVectorParameters.pattern=i,this.setFibs(e,i),this.currentLineSelectedClass&&this.params.lineSelection.removeClass(this.currentLineSelectedClass),this.currentLineSelectedClass="ciq-"+i+"-"+parseInt(e,10),"none"==i?this.currentLineSelectedClass=null:this.params.lineSelection.addClass(this.currentLineSelectedClass),this.emit()}sync(t){var i=this.context.stx;t?i.currentVectorParameters=e.extend(i.currentVectorParameters||{},t):t=i.currentVectorParameters;var n=this.params;this.setLine(null,t.lineWidth,t.pattern);var s=i.canvasStyle("stx_annotation"),o=t.annotation&&t.annotation.font,a=o&&o.size||s.fontSize;this.setFontSize(null,a);var r=o&&o.family||s.fontFamily;this.setFontFamily(null,r);var c=o&&o.style||s.fontStyle;n.fontStyleToggle["italic"===c?"addClass":"removeClass"]("ciq-active");var l=o&&o.weight||s.fontWeight;n.fontWeightToggle["bold"===l||l>=700?"addClass":"removeClass"]("ciq-active"),n.axisLabelToggle[t.axisLabel?"addClass":"removeClass"]("ciq-active"),this.getFillColor({node:n.fillColor}),this.getLineColor({node:n.lineColor}),n.cvpControllers.each((function(){this.sync(t)}))}toggleAxisLabel(t){var i=this.context.stx,n=e.UI.$(t.node);!0===i.currentVectorParameters.axisLabel?(i.currentVectorParameters.axisLabel=!1,n.removeClass("ciq-active")):(i.currentVectorParameters.axisLabel=!0,n.addClass("ciq-active")),this.emit()}toggleFontStyle(t,i){var n=this.context.stx,s=e.UI.$(t.node);"italic"==i?"italic"==n.currentVectorParameters.annotation.font.style?(n.currentVectorParameters.annotation.font.style=null,s.removeClass("ciq-active")):(n.currentVectorParameters.annotation.font.style="italic",s.addClass("ciq-active")):"bold"==i&&("bold"==n.currentVectorParameters.annotation.font.weight?(n.currentVectorParameters.annotation.font.weight=null,s.removeClass("ciq-active")):(n.currentVectorParameters.annotation.font.weight="bold",s.addClass("ciq-active"))),this.emit()}toggleMagnet(t){var i=e.UI.$(t.node),n=this.context.stx;n.preferences.magnet?(i.removeClass("active"),n.preferences.magnet=!1):(i.addClass("active"),n.preferences.magnet=!0),e.clearCanvas(n.chart.tempCanvas,n)}tool(t,i){var n=e.UI.$(t.node);if(i||(i=n.getAttribute("cq-tool")),i){var s=this.context.stx;s.clearMeasure(),s.changeVectorType(i),this.params.toolSelection.html(n.html()),this.params.toolSelection.attr("cq-current-tool",i),this.node.find("*[cq-section]").removeClass("ciq-active");var o=!this.node.find("*[cq-toolbar-dirty]").hasClass("ciq-active"),a=e.Drawing.getDrawingParameters(s,i);if(a){this.node.find("*[cq-toolbar-action='save']").addClass("ciq-active");var r=s.preferences.drawings;r&&r[i]&&(this.node.find("*[cq-toolbar-action='restore']").addClass("ciq-active"),o=!0),"fibtimezone"===i&&delete a.parameters;var c=this.params.lineSelection.parent().find(".ciq-none");c.hide();for(var l=this.defaultElements(a),h=0;h<l.length;h++)this.node.find(l[h]).addClass("ciq-active"),"cq-fill-color"==l[h]&&c.show();if(l=e.Drawing[i].prototype.$controls)for(h=0;h<l.length;h++)this.node.find(l[h]).addClass("ciq-active")}this.sync(),o&&this.dirty(!1)}}}e.UI.addComponentDefinition("cq-toolbar",t)}else console.error("toolbar component requires first activating drawing feature.")},St=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{constructor(){super(),this.redoButton=null,this.undostack=[],this.redostack=[],this.contexts=[]}connectedCallback(){if(!this.attached){super.connectedCallback();var t=this;e.UI.stxtap(this,(function(){t.undo()}))}}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}disconnectedCallback(){this.removeClaim(this),super.disconnectedCallback()}clear(t){this.setButtonStyle()}handleEvent(t,e,i){this.undostack.push({context:t,drawings:i.before}),this.redostack=[],this.setButtonStyle()}keyStroke(t,e,i,n){return"z"==e&&(n.ctrl||n.cmd)?(n.shift?this.redo():this.undo(),!0):"y"==e&&(n.ctrl||n.cmd)?(this.redo(),!0):void 0}manageContext(t){this.addClaim(this);var e=this;this.eventListeners.push(t.stx.addEventListener("undoStamp",(function(i){e.handleEvent(t,"undoStamp",i)}))),this.contexts.push(t)}redo(){var t=this.redostack.pop();if(t){var e=t.context;this.undostack.push({context:e,drawings:e.stx.exportDrawings()});var i=t.drawings;e.stx.abortDrawings(!0),e.stx.importDrawings(i),e.stx.changeOccurred("vector"),e.stx.draw()}this.setButtonStyle()}setButtonStyle(){this.undostack.length?this.node.attr("cq-active","true"):this.node.removeAttr("cq-active"),this.redoButton&&(this.redostack.length?this.redoButton.setAttribute("cq-active","true"):this.redoButton.removeAttribute("cq-active"))}setContext(t){let e=[this.context];if(this.context.topNode.getCharts){e=this.context.topNode.getCharts().map((t=>t.uiContext))}e.forEach((t=>{this.manageContext(t)}));var i=this;this.addInjection("append","initializeChart",(function(){i.undostack=[],i.redostack=[],i.clear()}))}undo(){for(var t=!1,e=0;e<this.contexts.length;e++)this.contexts[e].stx.activeDrawing&&(this.contexts[e].stx.undo(),t=!0);if(!t){var i=this.undostack.pop();if(i){var n=i.context;this.redostack.push({context:n,drawings:n.stx.exportDrawings()});var s=i.drawings;n.stx.abortDrawings(!0),n.stx.importDrawings(s),n.stx.changeOccurred("vector"),n.stx.draw()}this.setButtonStyle()}}}e.UI.addComponentDefinition("cq-undo",i)},Et=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}open(t){this.addDefaultMarkup(),this.querySelector("input").value="",super.open(t)}save(){const t=this.node.find("input").val();if(!t)return;let i=!1;this.updateContext();const n=this.context.stx.exportLayout();this.ownerDocument.querySelectorAll("cq-views").forEach((function(s){const o=s.params.viewObj;let a;for(var r=0;r<o.views.length&&(a=o.views[r],t!=e.first(a));r++);r==o.views.length&&(a={},a[t]={},o.views.push(a)),a[t]=n,delete a[t].candleWidth,s.renderMenu(),i||(i=!0,s.params.nameValueStore&&s.params.nameValueStore.set("stx-views",o.views))})),this.close()}updateContext(){const{topNode:t}=this.context;let e=t.querySelector("cq-context-wrapper.active cq-context");e||t.multiChartContainer&&(e=t.multiChartContainer.querySelector("cq-context-wrapper.active cq-context")),e&&(this.context=e.CIQ.UI.context)}}i.markup='\n\t\t<h4>Save View</h4>\n\t\t<div stxtap="close()" class="ciq-icon ciq-close"></div>\n\t\t<div style="text-align:center;margin-top:10px;">\n\t\t<i>Enter name of view:</i>\n\t\t<p>\n\t\t\t<input spellcheck="false" autocomplete="off" autocorrect="off" autocapitalize="none" maxlength="40" placeholder="Name"><br>\n\t\t</p>\n\t\t<span class="ciq-btn" stxtap="save()">Save</span>\n\t\t</div>\n\t',e.UI.addComponentDefinition("cq-view-dialog",i)},Tt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{initialize(t){this.params=Object.assign({},t);const{config:i}=this.context;let{nameValueStore:n}=i;e.ensureDefaults(this.params,{viewObj:{views:[]},nameValueStore:n&&new n||e.NameValueStore&&new e.NameValueStore,template:"template[cq-view]"}),this.params.template=this.querySelector(this.params.template);var s=this;this.params.nameValueStore&&this.params.nameValueStore.get("stx-views",(function(t,e){!t&&e&&(s.params.viewObj.views=e),s.params.cb&&s.params.cb.call(s),s.renderMenu()}))}connectedCallback(){super.connectedCallback()}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}setContext({config:t}){this.addDefaultMarkup(),t&&t.menuViewConfig&&this.initialize(t.menuViewConfig)}renderMenu(){var t=this.node,i=this;function n(t){return function(e){e.stopPropagation();var n=!1;i.ownerDocument.querySelectorAll("cq-views").forEach((function(e){e.params.viewObj.views.splice(t,1),n||(e.params.nameValueStore&&e.params.nameValueStore.set("stx-views",i.params.viewObj.views),n=!0),e.renderMenu()}))}}function s(t){return function(n){n.stopPropagation(),i.uiManager.closeMenu(),i.context.loader&&i.context.loader.show();var s=e.first(i.params.viewObj.views[t]);setTimeout((function(){var e=i.context.stx;e.importLayout(i.params.viewObj.views[t][s],{managePeriodicity:!0,preserveTicksAndCandleWidth:!0,cb:function(){e.changeOccurred("layout"),i.context.loader&&i.context.loader.hide()}})}),10)}}t.find("cq-views-content cq-item").remove();for(var o=0;o<this.params.viewObj.views.length;o++){var a=e.first(i.params.viewObj.views[o]);if("recent"!=a){var r=e.UI.makeFromTemplate(this.params.template),c=r.find("cq-label"),l=r.find("div");c.length&&(c.addClass("view-name-"+a),c.text(a)),l.length&&e.UI.stxtap(l[0],n(o)),this.makeTap(r[0],s(o)),t.find("cq-views-content").append(r)}}var h=t.find("cq-view-save");if(h){const{context:t}=this,i=this;this.makeTap(h.find("cq-item")[0],(function(n){t.config?i.channelWrite(t.config.channels.dialog,{type:"view",params:{context:t}}):i.ownerDocument.querySelector("cq-view-dialog").open({context:t});const s=e.UI.getUIManager(this),o=t.topNode.querySelector(".ciq-views");s&&o&&s.closeMenu(o)}))}this.params.renderCB&&this.params.renderCB(t)}}i.markup='\n\t\t<cq-heading>Saved Views</cq-heading>\n\t\t<cq-views-content>\n\t\t\t<template cq-view>\n\t\t\t\t<cq-item>\n\t\t\t\t\t<cq-label></cq-label>\n\t\t\t\t\t<div class="ciq-icon ciq-close" keyboard-selectable-child="true"></div>\n\t\t\t\t</cq-item>\n\t\t\t</template>\n\t\t</cq-views-content>\n\t\t<cq-separator cq-partial></cq-separator>\n\t\t<cq-view-save>\n\t\t\t<cq-item><cq-plus></cq-plus>Save View</cq-item>\n\t\t</cq-view-save>\n\t',e.UI.addComponentDefinition("cq-views",i)},Ut=t=>{const e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.DialogContentTag{adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i),this.constructor=i}open(t){this.addDefaultMarkup(),super.open(t),t&&(this.opener=t.caller);const{currentVectorParameters:e}=this.context.stx;e.volumeprofile||(e.volumeprofile={});const i=e.volumeProfile,n=this.querySelector('div[fieldname="Price Buckets"] input');n.value=i.priceBuckets,n.changeHandler&&n.removeEventListener("change",n.changeHandler),n.changeHandler=({target:t})=>{const e=parseInt(t.value);if(isNaN(e))return;i.priceBuckets=e;const n=new Event("change",{bubbles:!0,cancelable:!0});this.opener.dispatchEvent(n)},n.addEventListener("change",n.changeHandler)}}i.markup='\n\t<h4 class="title">Volume Profile Settings</h4>\n\t<cq-scroll cq-no-maximize>\n\t\t<div class="ciq-drawing-dialog-setting" fieldname="Price Buckets">\n\t\t\t<div class="ciq-heading">Price Buckets</div>\n\t\t\t<div class="stx-data">\n\t\t\t\t<input type="number" min="1" step="1">\n\t\t\t</div>\n\t\t</div\n\t</cq-scroll>\n\t<div class="ciq-dialog-cntrls">\n\t\t<div class="ciq-btn" stxtap="close()">Done</div>\n\t</div>\n',e.UI.addComponentDefinition("cq-volumeprofile-settings-dialog",i)},Pt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;class i extends e.UI.ContextTag{static get observedAttributes(){return["corrective","decoration","impulse","show-lines","template"]}static templates(){return{"Grand Supercycle":{impulse:["I","II","III","IV","V"],corrective:["a","b","c"],decoration:"enclosed"},Supercycle:{impulse:["I","II","III","IV","V"],corrective:["a","b","c"],decoration:"parentheses"},Cycle:{impulse:["I","II","III","IV","V"],corrective:["a","b","c"],decoration:null},Primary:{impulse:["1","2","3","4","5"],corrective:["A","B","C"],decoration:"enclosed"},Intermediate:{impulse:["1","2","3","4","5"],corrective:["A","B","C"],decoration:"parentheses"},Minor:{impulse:["1","2","3","4","5"],corrective:["A","B","C"],decoration:null},Minute:{impulse:["i","ii","iii","iv","v"],corrective:["a","b","c"],decoration:"enclosed"},Minuette:{impulse:["i","ii","iii","iv","v"],corrective:["a","b","c"],decoration:"parentheses"},"Sub-Minuette":{impulse:["i","ii","iii","iv","v"],corrective:["a","b","c"],decoration:null}}}handlePropertyChange(t,e,i){if(!this.stx)return;let n,s=this.stx.currentVectorParameters,o=s.waveParameters||{};switch(t){case"template":let t=this.templates[i];t&&(n={decoration:t.decoration});break;case"impulse":n={impulse:i&&JSON.parse(i)};break;case"corrective":n={corrective:i&&JSON.parse(i)};break;case"decoration":n={decoration:i};break;case"show-lines":n={showLines:i}}s.waveParameters=Object.assign(o,n)}constructor(){super(),this.templates=i.templates()}connectedCallback(){if(!this.attached){this.template="Grand Supercycle";var t=this.ownerDocument.querySelector('template[cq-wave-parameters], template[cq-wave-parameters="true"]');e.UI.makeFromTemplate(t,this),this.templateHeader=this.querySelector(".ciq-active-template"),this.impulseHeader=this.querySelector(".ciq-active-impulse"),this.correctiveHeader=this.querySelector(".ciq-active-corrective"),this.decorators={blank:this.querySelector(".ciq-btn:nth-of-type(1n)"),parentheses:this.querySelector(".ciq-btn:nth-of-type(2n)"),enclosed:this.querySelector(".ciq-btn:nth-of-type(3n)")},this.lineToggleCheckbox=this.querySelector("span.ciq-checkbox"),super.connectedCallback()}}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,i)}activate(){const{stx:t}=this;t&&(this.cvp=t.currentVectorParameters,this.cvp.waveParameters||(this.template="Grand Supercycle"),this.update(null,"template",this.template))}setContext(){this.stx=this.context.stx}toggleLines(){let t=this.lineToggleCheckbox,e=this["show-lines"];this["show-lines"]=!e,e?t.classList.remove("ciq-active"):t.classList.add("ciq-active")}update(t,i,n){if("template"===i){this.template=n,this.templateHeader.innerHTML=n;let t=this.templates[this.template];if(t){this.impulse=JSON.stringify(t.impulse),this.impulseHeader.innerHTML=t.impulse.join(" "),this.corrective=JSON.stringify(t.corrective),this.correctiveHeader.innerHTML=t.corrective.join(" ");for(let t in this.decorators)this.decorators[t].classList.remove("ciq-active");let i=t.decoration||"blank";this.decorators[i].classList.add("ciq-active"),this.decoration=i,this["show-lines"]=!0,this.lineToggleCheckbox.classList.add("ciq-active"),this.cvp.waveParameters=e.clone(t),this.cvp.waveParameters.showLines=!0}else this.cvp.waveParameters={corrective:this.corrective,impulse:this.impulse,decoration:this.decoration,showLines:this["show-lines"]}}else{if("decoration"===i){for(let t in this.decorators)this.decorators[t].classList.remove("ciq-active");t.node.classList.add("ciq-active"),this.decoration=t.node.getAttribute("decoration")}else if("impulse"===i||"corrective"===i){let t=n?n.split(","):n;this[i]=t,this[i+"Header"].innerHTML=t?t.join(" "):"- - -"}this.templateHeader.innerHTML=this.template="Custom"}}}e.UI.addComponentDefinition("cq-wave-parameters",i)},zt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;const i=e.UI._webcomponents.list["cq-dialog"];if(i){class t extends i.classDefinition{constructor(){super(),this.params={colorMap:[["#ffffff","#e1e1e1","#cccccc","#b7b7b7","#a0a0a5","#898989","#707070","#626262","#555555","#464646","#363636","#262626","#1d1d1d","#000000"],["#f4977c","#f7ac84","#fbc58d","#fff69e","#c4de9e","#85c99e","#7fcdc7","#75d0f4","#81a8d7","#8594c8","#8983bc","#a187bd","#bb8dbe","#f29bc1"],["#ef6c53","#f38d5b","#f8ae63","#fff371","#acd277","#43b77a","#2ebbb3","#00bff0","#4a8dc8","#5875b7","#625da6","#8561a7","#a665a7","#ee6fa9"],["#ea1d2c","#ee652e","#f4932f","#fff126","#8ec648","#00a553","#00a99c","#00afed","#0073ba","#0056a4","#323390","#66308f","#912a8e","#e9088c"],["#9b0b16","#9e4117","#a16118","#c6b920","#5a852d","#007238","#00746a","#0077a1","#004c7f","#003570","#1d1762","#441261","#62095f","#9c005d"],["#770001","#792e03","#7b4906","#817a0b","#41661e","#005827","#005951","#003b5c","#001d40","#000e35","#04002c","#19002b","#2c002a","#580028"]]}}connectedCallback(){this.attached||(super.connectedCallback(),this.build())}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,t),this.constructor=t}build(){this.addDefaultMarkup();var t=this.node,e=t.attr("cq-colors");if(e){e=e.split(",");var i=Math.ceil(Math.sqrt(e.length));this.params.colorMap=[];for(var n=0,s=[],o=0;o<e.length;o++)n>=i&&(n=0,this.params.colorMap.push(s),s=[]),s.push(e[o]),n++;this.params.colorMap.push(s)}this.cqOverrides=t.find("cq-overrides"),this.template=this.cqOverrides.find("template"),this.initialize()}display(t){var i=e.UI.$(t.node)[0],n=i.getBoundingClientRect();this.node.css({top:"0px",left:"0px"});var s=this.parentNode.getBoundingClientRect(),o=e.elementDimensions(i,{border:!0}),a=n.left-s.left+o.width+10,r=n.top-s.top+15;this.cqOverrides.children(":not(template)").remove();var c=t.context||this.context||e.UI.getMyContext(this);this.uiManager=c.uiManager||e.UI.getUIManager(this);var l=function(t,e){return function(){t.pickColor(e)}},h=0;if(t.overrides&&this.template.length){for(var d,u=0;u<t.overrides.length;u++){var p=t.overrides[u];d=e.UI.makeFromTemplate(this.template,!0),c.stx&&(p=c.stx.translateIf(p)),d.text(p),e.UI.stxtap(d[0],l(this,"none"==p?"transparent":p))}h=e.elementDimensions(d[0]).height}var m=e.elementDimensions(this,{border:!0}),g=this.ownerDocument||document,f=e.guaranteedSize(g).width,v=m.width||o.width*this.colors.children()[0].children.length;a+v>f&&(a=f-v-20);var b=e.guaranteedSize(g).height,y=m.height||o.height*this.colors.children().length+h;r+y>b&&(r=b-y-30),this.node.css({left:a+"px",top:r+"px"}),this.classList.contains("stxMenuActive")?c.e&&c.e.stopPropagation():this.open({context:c}),this.keyboardNavigation&&this.keyboardNavigation.highlightAlign()}initialize(){function t(t,e){return function(){t.pickColor(e)}}this.colors=this.node.find("cq-colors"),this.colors.length||(this.colors=this.node),this.colors.empty();for(var i=0;i<this.params.colorMap.length;i++){var n=this.params.colorMap[i],s=document.createElement("ul");this.colors[0].appendChild(s);for(var o=0;o<n.length;o++){var a=document.createElement("li");s.appendChild(a);var r=document.createElement("span");a.appendChild(r),r.style.backgroundColor=n[o],e.UI.stxtap(r,t(this,n[o]))}}this.rowLength=this.params.colorMap[0].length||0}keyStroke(t,e,i){if(t&&t.tabActiveModals[0]!==this)return;const n=this.querySelectorAll("cq-colors span, .ciq-btn");if("Escape"===e||"Esc"===e);else if("ArrowRight"===e)this.focusNextItem(n);else if("ArrowLeft"===e)this.focusNextItem(n,!0);else if("ArrowDown"===e)this.focusNextRow(n);else if("ArrowUp"===e)this.focusNextRow(n,{reverse:!0});else if("Enter"==e){const t=this.findFocused(n);this.clickItem(t[0],i)}}focusNextRow(t,i){const{reverse:n}=i||{},s=this.findFocused(t);let o=-1;if(s.length)for(o=0;o<t.length&&t[o]!==s[0];o++);if(n){do{if(o-=this.rowLength,o<0)break}while(!e.trulyVisible(t[o]))}else do{if(o+=this.rowLength,o>=t.length){o=t.length-1;break}}while(!e.trulyVisible(t[o]));return o>-1&&o<t.length&&t[o]!==s[0]&&(this.removeFocused(t),this.focusItem(t[o]),!0)}pickColor(t){this.callback&&this.callback(t),this.close()}resize(){}setColors(t){this.params.colorMap=t,this.initialize()}}t.markup='\n\t\t<cq-colors></cq-colors>\n\t\t<cq-overrides>\n\t\t\t<template>\n\t\t\t\t<div class="ciq-btn"></div>\n\t\t\t</template>\n\t\t</cq-overrides>\n\t',e.UI.addComponentDefinition("cq-color-picker",t)}else console.error("colorPicker component requires first activating dialog component.")},Lt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;const i=e.UI._webcomponents.list["cq-palette"];if(i)if(e.Drawing){class t extends i.classDefinition{constructor(){super(),this.mode="",this.callbacks=[],this.toolSettings={favList:[],toolGroup:""},this.toolGroups=[],this.groupedTools={},this.toolShortcuts={}}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,t),this.constructor=t}disconnectedCallback(){this.removeClaim(this),super.disconnectedCallback()}setupKeyboardActivation(t){if(void 0!==this.getAttribute("cq-keystroke-claim")){let t=this.context.topNode.querySelectorAll("*[cq-tool][cq-tool-shortcut]");for(let e=0;e<t.length;e++){let i=t[e].getAttribute("cq-tool-shortcut");if(/^[A-Za-z0-9]{1}$/g.test(i)){this.toolShortcuts[i.toUpperCase()]={toolName:t[e].getAttribute("cq-tool"),node:t[e]};let n=t[e].querySelector("label"),s=document.createElement("span");s.classList.add("shortcut"),s.innerHTML=" (Alt+"+i.toUpperCase()+")",n.appendChild(s)}else console.warn("cq-tool-shortcut attribute must be a single letter: "+i+" ignored.")}this.addClaim(this)}}keyStroke(t,e,i,n){if(!i.altKey||i.ctrlKey||i.shiftKey){if("Escape"===i.key){let t=this.context.topNode.querySelector('*[cq-tool="notool"]');t&&this.noTool({node:t})}}else{e=i.code.replace(/^(Key|Digit|Numpad)/,"");let t=this.toolShortcuts[e.toUpperCase()];if(t){const e=this.channels?this.channels.drawing:"channel.drawing";this.channelWrite(e,!0),this.tool({node:t.node},t.toolName)}}}handleMessage(t,e){switch(t){case"changeToolSettings":this.activateTool(e.activator,e.toolName);break;case"toggleDrawingPalette":this.togglePalette();break;case"hideDrawingPalette":case"dockWillResize":this.hidePalette();break;case"dockDidResize":this.resetScroller();break;case"context":"stop"===e&&(this.toolContextMenu.style.display="none")}}loadToolSettings(){if(this.store){let t=this;this.store.get("CIQ.DrawingToolSettings",(function(e,i){!e&&i&&i.favList&&(t.toolSettings=Object.assign(t.toolSettings,i))}))}}storeToolSettings(){this.store&&this.store.set("CIQ.DrawingToolSettings",JSON.stringify(this.toolSettings))}setContext(t){const{config:i,stx:n}=t;if(i){const{channels:t={},drawingToolGrouping:n=[],nameValueStore:s}=i,{groupedTools:o}=this;i.drawingTools&&(i.drawingTools=i.drawingTools.filter((({tool:t})=>e.Drawing[t]))).forEach((t=>{let e=t.group;o[e]=o[e]?[...o[e],t]:[t]})),this.toolGroups=n||[],this.store=s&&new s||e.NameValueStore&&new e.NameValueStore,this.addDefaultMarkup(this,this.getMarkup(i)),this.channels={drawing:t.drawing||"channel.drawing"}}this.init(),this.loadToolSettings(),this.params={toolGroupSelection:this.node.find("*[cq-tool-group-selection]")},this.setFavorites(),this.setMode("grid"),this.setEvenOdd(),this.toolContextMenu=this.createContextMenu(),this.addEventListener("contextmenu",function(t){const e=t.target.hasAttribute("cq-tool-group")?t.target:t.target.parentElement;if(t.preventDefault(),null!==e&&null!==e.getAttribute("cq-tool-group")){let i=e.getBoundingClientRect(),n=this.getBoundingClientRect();this.showToolContextMenu(e.getAttribute("cq-tool"),t.clientY+i.height-n.top,t.clientX-n.left)}}.bind(this)),this.setupKeyboardActivation(),this.pairUndoRedo(),this.toolSettings.toolGroup&&this.setToolGroup({node:this.querySelector('cq-item[cq-tool-group="'+this.toolSettings.toolGroup+'"]')},this.toolSettings.toolGroup),this.channels&&(this.channelSubscribe(this.channels.drawing||"channel.drawing",(t=>{const i=n.currentVectorParameters.vectorType;if(t)this.resetScroller(),i||n.changeVectorType(this.priorVectorType||""),this.setActiveTool(i||"notool");else{const{multiChartContainer:t}=this.container.topNode;t&&e.getFromNS(this,"context.config.soloActive.onDraw")?Array.from(t.querySelectorAll("cq-drawing-palette")).forEach((t=>{t.priorVectorType=i})):this.priorVectorType=i,n.changeVectorType(null)}})),this.channelSubscribe(this.channels.breakpoint||"channel.breakpoint",(t=>{"break-sm"===t&&this.setMode("list")})))}pairUndoRedo(){const t=this.qs("cq-redo",this),e=this.qs("cq-undo",this);t.pairUp(e)}changeView(t,e){this.setMode(e);for(var i=0;i<this.callbacks.length;i++)this.callbacks[i].call(this,this.mode)}createContextMenu(){let t=document.createElement("div");t.className="menu-item",t.innerHTML="Add/Remove Favorite",t.addEventListener("mousedown",function(t){t.stopPropagation(),t.button<2&&(this.toggleFavorite(t.currentTarget.parentElement.getAttribute("context-tool")),this.paletteDock.stopContext(this))}.bind(this)),t.addEventListener("pointerdown",(t=>t.stopPropagation()));let e=document.createElement("div");return e.appendChild(t),e.className="tool-context-menu",this.node.append(e),e}registerCallback(t){this.callbacks.push(t)}resetScroller(){const t=this.querySelector(".tool-group cq-scroll");if(!t)return!1;this.setEvenOdd(),t.refresh()}setActiveTool(t){const e=this.querySelector(`cq-item[cq-tool=${t}]`);e&&this.tool({node:e})}setActiveButton(t){this.node.find(".ciq-tool.active").removeClass("active"),t&&t.classList.add("active"),e.trulyVisible(this.ownerDocument.querySelector(".ciq-mobile-palette-toggle"))||this.togglePalette()}setMode(t){t="list"===t?t:"grid",this.mode=t,this.classList.remove("list","grid"),this.classList.add(this.mode),this.sortToolButtons(),this.resetScroller(),this.paletteDock.handleResize({resizeChart:!0})}setEvenOdd(){const t=this.querySelectorAll(".tool-group cq-scroll .drawing-tools-group");t.length&&t.forEach((t=>{const i=t.querySelectorAll("cq-item");let n=!1;for(let t=0;t<i.length;t++)e.trulyVisible(i[t])&&(i[t].classList[n?"add":"remove"]("odd"),n=!n)}))}setFavorites(t=!0){for(var e=this.querySelectorAll(".tool-group [cq-tool]"),i=0;i<e.length;i++){var n=e[i];if(null===n.querySelector(".fav-marker")){let t=document.createElement("div");t.className="fav-marker",t.addEventListener("click",this.handleFavoriteClick.bind(this)),t.addEventListener("touchstart",this.handleFavoriteClick.bind(this),{capture:!0,passive:!1}),t.addEventListener("pointerdown",(t=>t.stopPropagation())),n.appendChild(t)}n.getAttribute("cq-tool-group").indexOf("favorite")>=0&&n.setAttribute("cq-tool-group",n.getAttribute("cq-tool-group").replace("favorite","")),this.toolSettings.favList.indexOf(n.getAttribute("cq-tool"))>=0&&n.setAttribute("cq-tool-group",n.getAttribute("cq-tool-group")+" favorite")}this.sortToolButtons();const{multiChartContainer:s}=this.context.topNode;t&&s&&s.getCharts().forEach((t=>{const e=t.uiContext.topNode;if(!e.closest("cq-context-wrapper")||e===this.context.topNode)return;const i=e.querySelector("cq-drawing-palette");setTimeout((()=>{i.loadToolSettings(),i.setFavorites(!1)}))}))}sortToolButtons(){const t=this.querySelector(".tool-group cq-scroll"),i=t.querySelector(".ps__rail-x, .ps__rail-y"),{groupedTools:n,toolGroups:s,toolSettings:o}=this,{favList:a}=o,r=this.classList.contains("grid")?"grid":"list",c=e=>{i?t.insertBefore(e,i):t.appendChild(e)},l=(t,e)=>{const i=document.createElement("div");return i.setAttribute("class",`drawing-tools-group ${e}`),t.forEach((t=>{const n=t.tool||t;if("favorites"!==e&&a.includes(n))return;const s=this.querySelector(".tool-group [cq-tool="+n+"]");s&&i.appendChild(s)})),i.insertAdjacentHTML("beforeend","<cq-separator></cq-separator>"),i},h=(t,e)=>{const i=this.querySelector(".tool-group [cq-tool="+t.tool+"]"),n=i.getAttribute("cq-tool-group").includes("favorite");i&&(e?n:!n)&&c(i)};if("grid"===r){a.length&&c(l(a,"favorites")),s.forEach((t=>{const e=t.toLowerCase(),i=n[e];if(i){const t=l(i,e);c(t)}}));for(const t in n)if(!s.includes(e.capitalize(t))){const e=l(n[t],t);c(e)}}if("list"===r){for(let t of this.context.config.drawingTools)h(t,!0);for(let t of this.context.config.drawingTools)h(t,!1)}t.querySelectorAll("div.drawing-tools-group").forEach((t=>{t.children.length<=1&&t.remove()}))}handleFavoriteClick(t){t.stopPropagation(),t.preventDefault(),this.toggleFavorite(t.target.parentElement.getAttribute("cq-tool")),this.hidePalette()}addFavorite(t){this.toolSettings.favList.indexOf(t)<0&&(this.toolSettings.favList.push(t),this.storeToolSettings(),this.setFavorites())}showToolContextMenu(t,e,i){this.toolContextMenu.style.display="block",this.toolContextMenu.style.top=e+"px",this.toolContextMenu.style.left=i+"px",this.toolContextMenu.setAttribute("context-tool",t),this.paletteDock.startContext(this)}toggleFavorite(t){let e=this.toolSettings.favList.indexOf(t);e>=0?this.toolSettings.favList.splice(e,1):this.toolSettings.favList.push(t),this.storeToolSettings(),this.setFavorites(),this.setEvenOdd()}setToolGroup(t,e){this.toolSettings.toolGroup=e,this.querySelector(".tool-group").setAttribute("tool-group-filter",this.toolSettings.toolGroup),this.querySelector(".tool-group cq-scroll").top(),this.setEvenOdd();for(var i=0;i<this.callbacks.length;i++)this.callbacks[i].call(this,this.mode);this.showPalette(),this.params.toolGroupSelection.html(t.node.innerHTML),this.storeToolSettings()}togglePalette(){this.classList.toggle("palette-hide")}hidePalette(){this.classList.add("palette-hide")}showPalette(){this.classList.remove("palette-hide")}activateTool(t,e){let i=null;i=!t.node&&e?this.querySelector("[cq-tool="+e+"]"):t.node,this.setActiveButton(i);let n=[this.context.stx];n[0].uiContext.topNode.getCharts&&(n=n[0].uiContext.topNode.getCharts()),n.forEach((t=>{t.clearMeasure(),t.changeVectorType("notool"==e?"":e)}))}noTool(t,e){this.tool(t,"notool")}tool(t,e){if(e||(e=t.node.getAttribute("cq-tool")),e){var i=t.node.querySelector("label").innerHTML;this.activateTool(t,e),this.sendMessage&&this.sendMessage("changeTool",{activator:t,toolName:e,toolLabel:i})}}clearDrawings(){this.sendMessage&&this.sendMessage("clearDrawings")}restoreDefaultConfig(t,e){this.sendMessage&&this.sendMessage("restoreDefaultConfig",{activator:t,all:e})}getMarkup(t){const e=t.getMenu("drawingTools",!0).join(""),i=t.drawingToolGrouping.filter((e=>["All","Favorites"].includes(e)||t.drawingTools.some((({group:t})=>t===e.toLowerCase())))).map((t=>`<cq-item\n\t\t\t\t\tstxtap="setToolGroup('${t.toLowerCase()}')"\n\t\t\t\t\tcq-tool-group="${t.toLowerCase()}">${t}\n\t\t\t\t</cq-item>`)).join("");return this.constructor.markup.replace("{{tools}}",e).replace("{{toolGrouping}}",i)}}t.markup='\n\t<div class="palette-container">\n\t\t<div class="drag-strip"></div>\n\t\t\t<div class="mini-widget-group">\n\t\t\t\t\t<cq-item class="ciq-mini-widget" cq-view="list" stxtap="changeView(\'list\')"><span class="icon"></span><label>List View</label></cq-item>\n\t\t\t\t\t<cq-item class="ciq-mini-widget" cq-view="grid" stxtap="changeView(\'grid\')"><span class="icon"></span><label>Grid View</label></cq-item>\n\t\t\t\t\t<cq-item class="ciq-mini-widget" cq-view="detach" stxtap="detach()"><span class="icon"></span><label>Detach</label></cq-item>\n\t\t\t\t\t<cq-item class="ciq-mini-widget" cq-view="attach" stxtap="dock()"><span class="icon"></span><label>Attach</label></cq-item>\n\t\t\t</div>\n\t\t\t<cq-separator></cq-separator>\n\t\t\t<div class="primary-tool-group">\n\t\t\t\t<cq-item class="ciq-tool active" cq-tool="notool" stxtap="tool()"><cq-help help-id="drawing_palette_notool"></cq-help><span class="icon pointer"></span><label>No Tool</label></cq-item>\n\t\t\t\t<cq-item class="ciq-tool" cq-tool="measure" stxtap="tool()"><cq-help help-id="drawing_palette_measure"></cq-help><span class="icon measure"></span><label>Measure</label></cq-item>\n\t\t\t\t<cq-undo class="ciq-tool"><cq-help help-id="drawing_palette_undo"></cq-help><span class="icon undo"></span><label>Undo</label></cq-undo>\n\t\t\t\t<cq-redo class="ciq-tool"><cq-help help-id="drawing_palette_redo"></cq-help><span class="icon redo"></span><label>Redo</label></cq-redo>\n\t\t\t\t<cq-menu class="ciq-select">\n\t\t\t\t\t<cq-help help-id="drawing_palette_tool_categories"></cq-help>\n\t\t\t\t\t<span cq-tool-group-selection>All</span>\n\t\t\t\t\t<cq-menu-dropdown class="ciq-tool-group-selection">\n\t\t\t\t\t\t{{toolGrouping}}\n\t\t\t\t\t</cq-menu-dropdown>\n\t\t\t\t</cq-menu>\n\t\t\t</div>\n\t\t\t<cq-separator></cq-separator>\n\t\t\t<div class="tool-group" tool-group-filter="all">\n\t\t\t\t<cq-scroll cq-no-resize>\n\t\t\t\t\t{{tools}}\n\t\t\t\t</cq-scroll>\n\t\t\t\t<cq-separator></cq-separator>\n\t\t\t\t<div class="mini-widget-group mini-widget-foot">\n\t\t\t\t\t<cq-toggle class="ciq-mini-widget ciq-magnet" cq-member="preferences.magnet" cq-toggles="true,75,false" cq-toggle-classes="active strong,active," cq-multichart-distribute="true"><span class="icon magnet"></span><label>Magnet</label></cq-toggle>\n\t\t\t\t\t<cq-item class="ciq-mini-widget" stxtap="clearDrawings()"><span class="icon clear"></span><label>Clear All Drawings</label></cq-item>\n\t\t\t\t\t<cq-item class="ciq-mini-widget" stxtap="restoreDefaultConfig(true)"><span class="icon restore"></span><label>Restore Default Parameters</label></cq-item>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t<div class="resize-strip"></div>\n\t</div>\n\t',e.UI.addComponentDefinition("cq-drawing-palette",t)}else console.error("drawingPalette component requires first activating drawing feature.");else console.error("drawingPalette component requires first activating palette component.")},At=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;const i=e.UI._webcomponents.list["cq-palette"];if(i)if(e.Drawing){class t extends i.classDefinition{connectedCallback(){this.attached||(super.connectedCallback(),e.UI.stxtap(this,(function(t){t.stopPropagation()})))}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,t),this.constructor=t}setContext(t){this.addDefaultMarkup(),this.init(),this.params={lineSelection:this.node.find("*[cq-line-style]"),fontSizeSelection:this.node.find("*[cq-font-size]"),fontFamilySelection:this.node.find("*[cq-font-family]"),fontStyleToggle:this.node.find("cq-annotation-italic"),fontWeightToggle:this.node.find("cq-annotation-bold"),fontOptions:this.node.find("cq-annotation"),axisLabelToggle:this.node.find("cq-axis-label .ciq-checkbox"),spanPanelsToggle:this.node.find("cq-span-panels .ciq-checkbox"),showCalloutToggle:this.node.find("cq-show-callout .ciq-checkbox"),fillColor:this.node.find("cq-fill-color").not("cq-cvp-controller"),lineColor:this.node.find("cq-line-color").not("cq-cvp-controller"),cvpControllers:this.node.find("cq-cvp-controller"),waveParameters:this.node.find("cq-wave-parameters")},this.params.cvpControllers.prop("toolbar",this),this.sync(),this.dirty(!1);var i=this;e.UI.contextsForEach((function(){this.stx.setDrawingContainer&&this.stx.setDrawingContainer(i)})),t.stx.addEventListener("theme",(function(t){var e=i.node.find("*[cq-toolbar-dirty]").hasClass("ciq-active");i.sync(),e||i.dirty(!1)}))}handleMessage(t,e){switch(t){case"changeTool":this.setActiveToolLabel(e.toolLabel),this.toolSettings(e.activator,e.toolName);break;case"clearDrawings":this.clearDrawings();break;case"restoreDefaultConfig":this.restoreDefaultConfig(e.activator,e.all)}}clearDrawings(){const t=this.context.topNode.querySelectorAll("cq-context-wrapper");t.length?t.forEach((t=>{if(t.classList.contains("active")){t.querySelector("cq-context").context.stx.clearDrawings(null,!1)}})):this.context.stx.clearDrawings(null,!1)}crosshairs(t){var e=this.context.stx;e.changeVectorType(null),e.layout.crosshair=!0,e.doDisplayCrosshairs(),e.findHighlights(!1,!0),e.changeOccurred("layout"),e.draw(),e.updateChartAccessories(),this.node.find("*[cq-section]").removeClass("ciq-active"),this.emit()}tool(t,e){this.toolSettings(t,e),this.setActiveToolLabel(e),this.sendMessage("changeToolSettings",{activator:t,toolName:e})}toolSettings(t,i){var n=this.context.stx;this.node.find("*[cq-section]").removeClass("ciq-active");var s=!this.node.find("*[cq-toolbar-dirty]").hasClass("ciq-active"),o=e.Drawing.getDrawingParameters(n,i);if(o){this.node.find("*[cq-toolbar-action='save']").addClass("ciq-active");var a=n.preferences.drawings;a&&a[i]&&(this.node.find("*[cq-toolbar-action='restore']").addClass("ciq-active"),s=!0),"fibtimezone"===i&&delete o.parameters;var r=this.params.lineSelection.parent().find(".ciq-none");r.hide();for(var c=this.defaultElements(o,i),l=0;l<c.length;l++)this.node.find(c[l]).addClass("ciq-active"),"cq-fill-color"==c[l]&&r.show();if(c=e.Drawing[i].prototype.$controls)for(l=0;l<c.length;l++)this.node.find(c[l]).addClass("ciq-active");"trendline"!==i||n.currentVectorParameters.showCallout||["fontOptions","fillColor"].forEach((t=>this.params[t].removeClass("ciq-active")))}"notool"===i?(n.changeVectorType(""),this.hide="true"):this.hide="false",this.paletteDock.handleResize(),this.sync(),s&&this.dirty(!1)}defaultElements(t,e){var i=[];for(var n in t)if("color"==n)i.push("cq-line-color");else if("fillColor"==n)i.push("cq-fill-color");else if("pattern"==n||"lineWidth"==n)i.push("cq-line-style");else if("axisLabel"==n)i.push("cq-axis-label");else if("spanPanels"==n)i.push("cq-span-panels");else if("showCallout"==n)i.push("cq-show-callout");else if("font"==n)i.push("cq-annotation");else if("parameters"==n)switch(e){case"volumeprofile":i.push("cq-clickable[cq-volumeprofile-settings]");break;case"measurementline":i.push("cq-clickable[cq-measurementline-settings]");break;default:i.push("cq-clickable[cq-fib-settings]")}return i}dirty(t){this.node.find("*[cq-toolbar-dirty]")[!1===t?"removeClass":"addClass"]("ciq-active")}emit(){var t=new Event("change",{bubbles:!0,cancelable:!0});this.dirty(),this.dispatchEvent(t)}getFillColor(t){var i=e.UI.$(t.node),n=["color-auto","color-transparent"],s=this.context.stx.currentVectorParameters.fillColor;if(i.removeClass(n),n.includes("color-"+s))return i.removeAttr("style"),void i.addClass("color-"+s);i.css({background:s});var o=e.getBackgroundColor(this.parentNode);if(s&&Math.abs(e.hsl(o)[2]-e.hsl(s)[2])<.2){var a=e.chooseForegroundColor(o);i.css({border:"solid "+a+" 1px"})}else i.css({border:""})}getLineColor(t){var i=e.UI.$(t.node),n=["color-auto","color-transparent"],s=this.context.stx.currentVectorParameters.currentColor;if(i.removeClass(n),n.includes("color-"+s))return i.removeAttr("style"),void i.addClass("color-"+s);i.css({background:s});var o=e.getBackgroundColor(this.parentNode);if(!s||Math.abs(e.hsl(o)[2]-e.hsl(s)[2])<.2){var a=e.chooseForegroundColor(o);i.css({border:"solid "+a+" 1px"})}else i.css({border:""})}pickFillColor(t){var i=e.UI.$(t.node),n=this.ownerDocument.querySelector("cq-color-picker");if(n){var s=this;n.callback=function(t){s.context.stx.currentVectorParameters.fillColor=t,s.getFillColor({node:i}),s.emit()};var o=i.attr("cq-overrides");o&&(o=o.split(",")),n.display({node:i,overrides:o,context:s.context})}else console.log("DrawingToolbar.prototype.pickFillColor: no ColorPicker available")}pickLineColor(t){var i=e.UI.$(t.node),n=this.ownerDocument.querySelector("cq-color-picker");if(n){var s=this;n.callback=function(t){s.context.stx.currentVectorParameters.currentColor=t,s.getLineColor({node:i}),s.emit()};var o=i.attr("cq-overrides");o&&(o=o.split(",")),n.display({node:i,overrides:o,context:s.context})}else console.log("DrawingToolbar.prototype.pickLineColor: no ColorPicker available")}restoreDefaultConfig(t,i){var n=this.context.stx;e.Drawing.restoreDefaultConfig(n,n.currentVectorParameters.vectorType,i),this.node.find("*[cq-toolbar-action='restore']").removeClass("ciq-active"),this.sync(),this.dirty(!1)}saveConfig(){var t=this.context.stx;e.Drawing.saveConfig(t,t.currentVectorParameters.vectorType),this.node.find("*[cq-toolbar-action='restore']").addClass("ciq-active"),this.sync(),this.dirty(!1)}setFibs(t,e){var i=this.context.stx.currentVectorParameters.fibonacci;if(i){for(var n=0;n<i.fibs.length;n++)i.fibs[n].parameters.lineWidth=t,i.fibs[n].parameters.pattern=e;i.timezone.parameters.lineWidth=t,i.timezone.parameters.pattern=e}}setFontFamily(t,e){var i=this.context.stx;i.currentVectorParameters.annotation&&(i.currentVectorParameters.annotation.font.family="Default"==e?null:e),this.params.fontFamilySelection.text(e),this.emit()}setFontSize(t,e){var i=this.context.stx;i.currentVectorParameters.annotation&&(i.currentVectorParameters.annotation.font.size=e),this.params.fontSizeSelection.text(e),this.emit()}setLine(t,e,i){var n=this.context.stx;n.currentVectorParameters.lineWidth=e,n.currentVectorParameters.pattern=i,this.setFibs(e,i),this.currentLineSelectedClass&&this.params.lineSelection.removeClass(this.currentLineSelectedClass),this.currentLineSelectedClass="ciq-"+i+"-"+parseInt(e,10),"none"==i?this.currentLineSelectedClass=null:this.params.lineSelection.addClass(this.currentLineSelectedClass),this.emit()}setActiveToolLabel(t){"No Tool"===t?t="":"freeform"===t?t="Doodle":t+=":",this.querySelector(".ciq-active-tool-label").innerHTML=t,this.querySelector(".ciq-mobile-palette-toggle span").innerHTML=t||"Select Tool"}sync(t){var i=this.context.stx;t?i.currentVectorParameters=e.extend(i.currentVectorParameters||{},t):t=i.currentVectorParameters;var n=this.params;this.setLine(null,t.lineWidth,t.pattern);var s=i.canvasStyle("stx_annotation"),o=t.annotation&&t.annotation.font,a=o&&o.size||s.fontSize;this.setFontSize(null,a);var r=o&&o.family||s.fontFamily;this.setFontFamily(null,r);var c=o&&o.style||s.fontStyle;n.fontStyleToggle["italic"===c?"addClass":"removeClass"]("ciq-active");var l=o&&o.weight||s.fontWeight;n.fontWeightToggle["bold"===l||l>=700?"addClass":"removeClass"]("ciq-active"),n.axisLabelToggle[t.axisLabel?"addClass":"removeClass"]("ciq-active"),n.showCalloutToggle[t.showCallout?"addClass":"removeClass"]("ciq-active"),n.spanPanelsToggle[t.spanPanels?"addClass":"removeClass"]("ciq-active"),this.getFillColor({node:n.fillColor}),this.getLineColor({node:n.lineColor}),n.cvpControllers.each((function(){this.sync(t)}));var h=n.waveParameters;h&&h[0]&&h[0].activate()}toggleCheckbox(t,i){const n=e.UI.$(t.node),s=this.context.stx.currentVectorParameters;s[i]=!s[i],n[s[i]?"addClass":"removeClass"]("ciq-active"),"showCallout"===i&&["fontOptions","fillColor"].forEach((t=>this.params[t][s[i]?"addClass":"removeClass"]("ciq-active"))),this.emit()}toggleFontStyle(t,i){var n=this.context.stx,s=e.UI.$(t.node);"italic"==i?"italic"==n.currentVectorParameters.annotation.font.style?(n.currentVectorParameters.annotation.font.style=null,s.removeClass("ciq-active")):(n.currentVectorParameters.annotation.font.style="italic",s.addClass("ciq-active")):"bold"==i&&("bold"==n.currentVectorParameters.annotation.font.weight?(n.currentVectorParameters.annotation.font.weight=null,s.removeClass("ciq-active")):(n.currentVectorParameters.annotation.font.weight="bold",s.addClass("ciq-active"))),this.emit()}toggleMagnet(t){var i=e.UI.$(t.node),n=this.context.stx;n.preferences.magnet?(i.removeClass("active"),n.preferences.magnet=!1):(i.addClass("active"),n.preferences.magnet=!0),e.UI.contextsForEach((function(){this.stx.preferences.magnet=n.preferences.magnet,this.stx.chart.tempCanvas&&e.clearCanvas(this.stx.chart.tempCanvas,this.stx)}))}togglePalette(){this.sendMessage("toggleDrawingPalette")}}t.markup='\n\t<div class="palette-container">\n\t\t<div class="drag-strip"></div>\n\t\t\t<div class="drawing-settings-wrapper">\n\t\t\t\t\t<div class="mini-widget-group">\n\t\t\t\t\t\t<cq-item class="ciq-mini-widget" cq-view="detach" stxtap="detach()"><span class="icon"></span><label>Detach</label></cq-item>\n\t\t\t\t\t\t<cq-item class="ciq-mini-widget" cq-view="attach" stxtap="dock()"><span class="icon"></span><label>Attach</label></cq-item>\n\t\t\t\t\t</div>\n\t\t\t\t<cq-clickable class="ciq-select ciq-mobile-palette-toggle" stxtap="togglePalette()"><span>Select Tool</span></cq-clickable>\n\t\t\t\t<cq-toolbar-settings>\n\t\t\t\t\t<div class="ciq-active-tool-label ciq-heading"></div>\n\t\t\t\t\t<cq-fill-color cq-section cq-overrides="none" class="ciq-color" stxbind="getFillColor()" stxtap="pickFillColor()">\n\t\t\t\t\t\t<span></span>\n\t\t\t\t\t</cq-fill-color>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<cq-line-color cq-section cq-overrides="auto" class="ciq-color" stxbind="getLineColor()" stxtap="pickLineColor()"><span></span></cq-line-color>\n\t\t\t\t\t\t<cq-line-style cq-section>\n\t\t\t\t\t\t\t<cq-menu class="ciq-select">\n\t\t\t\t\t\t\t\t<span cq-line-style class="ciq-line ciq-selected"></span>\n\t\t\t\t\t\t\t\t<cq-menu-dropdown class="ciq-line-style-menu">\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setLine(1,\'solid\')"><span class="ciq-line-style-option ciq-solid-1"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setLine(3,\'solid\')"><span class="ciq-line-style-option ciq-solid-3"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setLine(5,\'solid\')"><span class="ciq-line-style-option ciq-solid-5"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setLine(1,\'dotted\')"><span class="ciq-line-style-option ciq-dotted-1"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setLine(3,\'dotted\')"><span class="ciq-line-style-option ciq-dotted-3"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setLine(5,\'dotted\')"><span class="ciq-line-style-option ciq-dotted-5"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setLine(1,\'dashed\')"><span class="ciq-line-style-option ciq-dashed-1"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setLine(3,\'dashed\')"><span class="ciq-line-style-option ciq-dashed-3"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setLine(5,\'dashed\')"><span class="ciq-line-style-option ciq-dashed-5"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setLine(0,\'none\')" class="ciq-none">None</cq-item>\n\t\t\t\t\t\t\t\t</cq-menu-dropdown>\n\t\t\t\t\t\t\t</cq-menu>\n\t\t\t\t\t\t</cq-line-style>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<cq-cvp-controller cq-section cq-cvp-header="1"></cq-cvp-controller>\n\t\t\t\t\t<cq-cvp-controller cq-section cq-cvp-header="2"></cq-cvp-controller>\n\t\t\t\t\t<cq-cvp-controller cq-section cq-cvp-header="3"></cq-cvp-controller>\n\n\t\t\t\t\t<template cq-cvp-controller>\n\t\t\t\t\t\t<div cq-section>\n\t\t\t\t\t\t\t<div class="ciq-heading">Dev 1</div>\n\t\t\t\t\t\t\t<span stxtap="toggleActive()" class="ciq-checkbox">\n\t\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<cq-line-color cq-section cq-overrides="auto" class="ciq-color" stxbind="getColor()" stxtap="pickColor()">\n\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t</cq-line-color>\n\t\t\t\t\t\t<cq-line-style cq-section>\n\t\t\t\t\t\t\t<cq-menu class="ciq-select">\n\t\t\t\t\t\t\t\t<span cq-cvp-line-style class="ciq-line ciq-selected"></span>\n\t\t\t\t\t\t\t\t<cq-menu-dropdown class="ciq-line-style-menu">\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setStyle(1, \'solid\')"><span class="ciq-line-style-option ciq-solid-1"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setStyle(3, \'solid\')"><span class="ciq-line-style-option ciq-solid-3"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setStyle(5, \'solid\')"><span class="ciq-line-style-option ciq-solid-5"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setStyle(1, \'dotted\')"><span class="ciq-line-style-option ciq-dotted-1"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setStyle(3, \'dotted\')"><span class="ciq-line-style-option ciq-dotted-3"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setStyle(5, \'dotted\')"><span class="ciq-line-style-option ciq-dotted-5"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setStyle(1, \'dashed\')"><span class="ciq-line-style-option ciq-dashed-1"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setStyle(3, \'dashed\')"><span class="ciq-line-style-option ciq-dashed-3"></span></cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="setStyle(5, \'dashed\')"><span class="ciq-line-style-option ciq-dashed-5"></span></cq-item>\n\t\t\t\t\t\t\t\t</cq-menu-dropdown>\n\t\t\t\t\t\t\t</cq-menu>\n\t\t\t\t\t\t</cq-line-style>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<cq-axis-label cq-section>\n\t\t\t\t\t\t<div class="ciq-heading">Axis Label:</div>\n\t\t\t\t\t\t<span stxtap="toggleCheckbox(\'axisLabel\')" class="ciq-checkbox ciq-active"><span></span></span>\n\t\t\t\t\t</cq-axis-label>\n\n\t\t\t\t\t<cq-span-panels cq-section>\n\t\t\t\t\t\t<div class="ciq-heading">Span Panels:</div>\n\t\t\t\t\t\t<span stxtap="toggleCheckbox(\'spanPanels\')" class="ciq-checkbox ciq-active"><span></span></span>\n\t\t\t\t\t</cq-span-panels>\n\t\n\t\t\t\t\t<cq-show-callout cq-section>\n\t\t\t\t\t\t<div class="ciq-heading">Show Callout:</div>\n\t\t\t\t\t\t<span stxtap="toggleCheckbox(\'showCallout\')" class="ciq-checkbox"><span></span></span>\n\t\t\t\t\t</cq-show-callout>\n\t\n\t\t\t\t\t<cq-annotation cq-section>\n\t\t\t\t\t\t<cq-annotation-italic stxtap="toggleFontStyle(\'italic\')" class="ciq-btn" style="font-style:italic;">I</cq-annotation-italic>\n\t\t\t\t\t\t<cq-annotation-bold stxtap="toggleFontStyle(\'bold\')" class="ciq-btn" style="font-weight:bold;">B</cq-annotation-bold>\n\t\t\t\t\t\t<cq-menu class="ciq-select">\n\t\t\t\t\t\t\t<span cq-font-size>12px</span>\n\t\t\t\t\t\t\t<cq-menu-dropdown class="ciq-font-size">\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'8px\')">8</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'10px\')">10</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'12px\')">12</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'13px\')">13</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'14px\')">14</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'16px\')">16</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'20px\')">20</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'28px\')">28</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'36px\')">36</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'48px\')">48</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontSize(\'64px\')">64</cq-item>\n\t\t\t\t\t\t\t</cq-menu-dropdown>\n\t\t\t\t\t\t</cq-menu>\n\t\t\t\t\t\t<cq-menu class="ciq-select">\n\t\t\t\t\t\t\t<span cq-font-family>Default</span>\n\t\t\t\t\t\t\t<cq-menu-dropdown class="ciq-font-family">\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontFamily(\'Default\')">Default</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontFamily(\'Helvetica\')">Helvetica</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontFamily(\'Courier\')">Courier</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontFamily(\'Garamond\')">Garamond</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontFamily(\'Palatino\')">Palatino</cq-item>\n\t\t\t\t\t\t\t\t<cq-item stxtap="setFontFamily(\'Times New Roman\')">Times New Roman</cq-item>\n\t\t\t\t\t\t\t</cq-menu-dropdown>\n\t\t\t\t\t\t</cq-menu>\n\t\t\t\t\t</cq-annotation>\n\t\t\t\t\t<cq-clickable cq-fib-settings cq-selector="cq-fib-settings-dialog" cq-method="open" cq-section>\n\t\t\t\t\t\t<span class="ciq-icon-btn cq-icon-gear">\n\t\t\t\t\t\t\t<cq-tooltip>Settings</cq-tooltip>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</cq-clickable>\n\t\t\t\t\t<cq-clickable cq-volumeprofile-settings cq-selector="cq-volumeprofile-settings-dialog" cq-method="open" cq-section>\n\t\t\t\t\t\t<span class="ciq-icon-btn cq-icon-gear">\n\t\t\t\t\t\t\t<cq-tooltip>Settings</cq-tooltip>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</cq-clickable>\n\t\t\t\t\t<cq-clickable cq-measurementline-settings cq-selector="cq-measurementline-settings-dialog" cq-method="open" cq-section>\n\t\t\t\t\t\t<span class="ciq-icon-btn cq-icon-gear">\n\t\t\t\t\t\t\t<cq-tooltip>Settings</cq-tooltip>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</cq-clickable>\n\t\t\t\t\t<div class="ciq-drawing-edit-only" cq-section>\n\t\t\t\t\t\t<div cq-toolbar-action="done_edit" stxtap="DrawingEdit.endEdit(\'close\')" cq-section><cq-tooltip>Done Editing</cq-tooltip></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<br cq-section cq-wave-parameters>\x3c!-- This break is not displayed by default but uses  the .ciq-active class to be displayed and push cq-wave-parameters onto a new line in the toolbar --\x3e\n\t\t\t\t\t<cq-wave-parameters cq-section></cq-wave-parameters>\n\t\t\t\t\t<template cq-wave-parameters>\n\t\t\t\t\t\t<div class="ciq-wave-template" cq-section>\n\t\t\t\t\t\t\t<div class="ciq-heading">WAVE TEMPLATE</div>\n\t\t\t\t\t\t\t<cq-menu class="ciq-select">\n\t\t\t\t\t\t\t\t<span class="ciq-active-template">WAVE TEMPLATE</span>\n\t\t\t\t\t\t\t\t<cq-menu-dropdown>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'template\',\'Grand Supercycle\')">Grand Supercycle</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'template\',\'Supercycle\')">Supercycle</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'template\',\'Cycle\')">Cycle</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'template\',\'Primary\')">Primary</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'template\',\'Intermediate\')">Intermediate</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'template\',\'Minor\')">Minor</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'template\',\'Minute\')">Minute</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'template\',\'Minuette\')">Minuette</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'template\',\'Sub-Minuette\')">Sub-Minuette</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'template\',\'Custom\')">Custom</cq-item>\n\t\t\t\t\t\t\t\t</cq-menu-dropdown>\n\t\t\t\t\t\t\t</cq-menu>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ciq-wave-impulse" cq-section>\n\t\t\t\t\t\t\t<div class="ciq-heading">IMPULSE</div>\n\t\t\t\t\t\t\t<cq-menu  class="ciq-select">\n\t\t\t\t\t\t\t\t<span class="ciq-active-impulse">IMPULSE</span>\n\t\t\t\t\t\t\t\t<cq-menu-dropdown>\n\t\t\t\t\t\t\t\t\t<cq-item stxTap="update(\'impulse\',null)">- - -</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'impulse\',\'I,II,III,IV,V\')">I II III IV V</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'impulse\',\'i,ii,iii,iv,v\')">i ii iii iv v</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'impulse\',\'1,2,3,4,5\')">1 2 3 4 5</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'impulse\',\'A,B,C,D,E\')">A B C D E</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'impulse\',\'a,b,c,d,e\')">a b c d e</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'impulse\',\'W,X,Y,X,Z\')">W X Y X Z</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'impulse\',\'w,x,y,x,z\')">w x y x z</cq-item>\n\t\t\t\t\t\t\t\t</cq-menu-dropdown>\n\t\t\t\t\t\t\t</cq-menu>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ciq-wave-corrective" cq-section>\n\t\t\t\t\t\t\t<div class="ciq-heading">CORRECTIVE</div>\n\t\t\t\t\t\t\t<cq-menu class="ciq-select">\n\t\t\t\t\t\t\t\t<span class="ciq-active-corrective">CORRECTIVE</span>\n\t\t\t\t\t\t\t\t<cq-menu-dropdown>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'corrective\',null)">- - -</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'corrective\',\'A,B,C\')">A B C</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'corrective\',\'a,b,c\')">a b c</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'corrective\',\'W,X,Y\')">W X Y</cq-item>\n\t\t\t\t\t\t\t\t\t<cq-item stxtap="update(\'corrective\',\'w,x,y\')">w x y</cq-item>\n\t\t\t\t\t\t\t\t</cq-menu-dropdown>\n\t\t\t\t\t\t\t</cq-menu>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span class="ciq-icon-btn ciq-btn" decoration="none" stxtap="update(\'decoration\',null)" cq-section>\n\t\t\t\t\t\t\t<cq-tooltip>None</cq-tooltip>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class="ciq-icon-btn ciq-btn" decoration="parentheses" stxtap="update(\'decoration\',\'parentheses\')" cq-section>\n\t\t\t\t\t\t\t<cq-tooltip>Parentheses</cq-tooltip>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class="ciq-icon-btn ciq-btn" decoration="enclosed" stxtap="update(\'decoration\',\'enclosed\')" cq-section>\n\t\t\t\t\t\t\t<cq-tooltip>Enclosed</cq-tooltip>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<div class="ciq-heading ciq-show-lines"  cq-section>\n\t\t\t\t\t\t\tShow Lines: <span stxtap="toggleLines()" class="ciq-checkbox ciq-active"><span></span></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<div class="ciq-drawing-edit-hidden" cq-section>\n\t\t\t\t\t\t<div cq-toolbar-action="save" stxtap="saveConfig()" cq-section><div cq-toolbar-dirty></div><cq-tooltip>Save Config</cq-tooltip></div>\n\t\t\t\t\t\t<div cq-toolbar-action="restore" stxtap="restoreDefaultConfig()" cq-section><cq-tooltip>Restore Config</cq-tooltip></div>\n\t\t\t\t\t</div>\n\t\t\t\t</cq-toolbar-settings>\n\t\t\t\t<cq-measure><span class="mMeasure"></span></cq-measure>\n\t\t\t</div>\n\t\t<div class="resize-strip"></div>\n\t</div>\n\t',e.UI.addComponentDefinition("cq-drawing-settings",t)}else console.error("drawingSettings component requires first activating drawing feature.");else console.error("drawingSettings component requires first activating palette component.")},Dt=t=>{var e="undefined"!=typeof _CIQ?_CIQ:t.CIQ;const i=e.UI._webcomponents.list["cq-scroll"];if(i){class t extends i.classDefinition{constructor(){super(),this.noMaximize=!0}connectedCallback(){super.connectedCallback()}adoptedCallback(){super.adoptedCallback(),e.UI.flattenInheritance(this,t)}disablekeyboardNavigation(){this.keyboardNavigation&&this.keyboardNavigation.setKeyControlElement()}}e.UI.addComponentDefinition("cq-menu-dropdown",t)}else console.error("menuDropdown component requires first activating scroll component.")};n.Pz}}]);